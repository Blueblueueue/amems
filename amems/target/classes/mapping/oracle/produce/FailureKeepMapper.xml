<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.eray.thjw.produce.dao.FailureKeepMapper" >
  <resultMap id="BaseResultMap" type="com.eray.thjw.produce.po.FailureKeep" >
    <id column="ID" 			property="id" jdbcType="VARCHAR" />
    <result column="DPRTCODE"	property="dprtcode"  jdbcType="VARCHAR" />
    <result column="WHDWID" 	property="whdwid" 	 jdbcType="VARCHAR" />
    <result column="WHRID" 		property="whrid" 	 jdbcType="VARCHAR" />
    <result column="WHSJ" 		property="whsj" 	 jdbcType="TIMESTAMP" />
    <result column="ZT" 		property="zt" 	  	 jdbcType="DECIMAL" />
    <result column="ZCBLBS" 	property="zcblbs" 	 jdbcType="DECIMAL" />
    <result column="BLDH" 		property="bldh" 	 jdbcType="VARCHAR" />
    <result column="FJZCH" 		property="fjzch" 	 jdbcType="VARCHAR" />
    <result column="ZJH" 		property="zjh" 	 	 jdbcType="VARCHAR" />
    <result column="HZ" 		property="hz" 	 	 jdbcType="VARCHAR" />
    <result column="BS145"	 	property="bs145" 	 jdbcType="DECIMAL" />
    <result column="BLLY"	 	property="blly" 	 jdbcType="DECIMAL" />
    <result column="BLLYID" 	property="bllyid" 	 jdbcType="VARCHAR" />
    <result column="BLLX" 		property="bllx" 	 jdbcType="VARCHAR" />
    <result column="BLLXSM" 	property="bllxsm" 	 jdbcType="VARCHAR" />
    <result column="SXGS_RS" 	property="sxgsRs" 	 jdbcType="DECIMAL" />
    <result column="SXGS_XS" 	property="sxgsXs" 	 jdbcType="DECIMAL" />
    <result column="BLYJ" 		property="blyj" 	 jdbcType="VARCHAR" />
    <result column="GZMS" 		property="gzms" 	 jdbcType="VARCHAR" />
    <result column="BLYY" 		property="blyy" 	 jdbcType="VARCHAR" />
    <result column="LSCS" 		property="lscs" 	 jdbcType="VARCHAR" />
    <result column="MBS" 		property="mbs" 		 jdbcType="DECIMAL" />
    <result column="MSM" 		property="msm" 		 jdbcType="VARCHAR" />
    <result column="OBS" 		property="obs" 	 	 jdbcType="DECIMAL" />
    <result column="OSM" 		property="osm" 		 jdbcType="VARCHAR" />
    <result column="YXXZBS"		property="yxxzbs" 	 jdbcType="DECIMAL" />
    <result column="YXXZSM" 	property="yxxzsm" 	 jdbcType="VARCHAR" />
    <result column="SC_SQRBMID" property="scSqrbmid" jdbcType="VARCHAR" />
    <result column="SC_SQRID" 	property="scSqrid" 	 jdbcType="VARCHAR" />
    <result column="SC_SQRZZH" 	property="scSqrzzh"  jdbcType="VARCHAR" />
    <result column="SC_SQRQ" 	property="scSqrq" 	 jdbcType="TIMESTAMP" />
    <result column="SC_BLQX" 	property="scBlqx" 	 jdbcType="TIMESTAMP" />
    <result column="SC_PZRBMID" property="scPzrbmid" jdbcType="VARCHAR" />
    <result column="SC_PZRID" 	property="scPzrid" 	 jdbcType="VARCHAR" />
    <result column="SC_PZRQ" 	property="scPzrq" 	 jdbcType="TIMESTAMP" />
    <result column="SC_PZYJ" 	property="scPzyj" 	 jdbcType="VARCHAR" />
    <result column="SC_PZCZSJ" 	property="scPzczsj"  jdbcType="TIMESTAMP" />
    <result column="ZC_SQRBMID" property="zcSqrbmid" jdbcType="VARCHAR" />
    <result column="ZC_SQRID" 	property="zcSqrid" 	 jdbcType="VARCHAR" />
    <result column="ZC_SQRQ" 	property="zcSqrq" 	 jdbcType="TIMESTAMP" />
    <result column="ZC_BLQX" 	property="zcBlqx" 	 jdbcType="TIMESTAMP" />
    <result column="ZC_BLYY" 	property="zcBlyy" 	 jdbcType="VARCHAR" />
    <result column="ZC_PZRBMID" property="zcPzrbmid" jdbcType="VARCHAR" />
    <result column="ZC_PZRID" 	property="zcPzrid" 	 jdbcType="VARCHAR" />
    <result column="ZC_PZRQ" 	property="zcPzrq" 	 jdbcType="TIMESTAMP" />
    <result column="JFPZYJ" 	property="jfpzyj" 	 jdbcType="VARCHAR" />
    <result column="JFPZR" 		property="jfpzr" 	 jdbcType="VARCHAR" />
    <result column="JFPZRQ" 	property="jfpzrq" 	 jdbcType="TIMESTAMP" />
    <result column="GBRBMID" 	property="gbrbmid" 	 jdbcType="VARCHAR" />
    <result column="GBRID" 		property="gbrid" 	 jdbcType="VARCHAR" />
    <result column="GBCZSJ" 	property="gbczsj" 	 jdbcType="TIMESTAMP" />
    <result column="GBYY" 		property="gbyy" 	 jdbcType="VARCHAR" />
    <result column="GZZ" 		property="gzz" 	 	 jdbcType="VARCHAR" />
    <result column="GZRQ" 		property="gzrq" 	 jdbcType="TIMESTAMP" />
    <result column="JCZ" 		property="jcz" 	 	 jdbcType="VARCHAR" />
    <result column="JCRQ" 		property="jcrq" 	 jdbcType="TIMESTAMP" />
    <result column="GDID" 		property="gdid" 	 jdbcType="VARCHAR" />
    <result column="SCSQR"     	property="paramsMap.scSqr"    jdbcType="VARCHAR" />
    <result column="SCPZR"     	property="paramsMap.scPzr"    jdbcType="VARCHAR" />
    <result column="ZCSQR"     	property="paramsMap.zcSqr"    jdbcType="VARCHAR" />
    <result column="ZCPZR"     	property="paramsMap.zcPzr"    jdbcType="VARCHAR" />
    <result column="GBR"     	property="paramsMap.gbr"      jdbcType="VARCHAR" />
    <result column="SYTS"     	property="paramsMap.syts"     jdbcType="VARCHAR" />
    <result column="BLLYNAME"   property="paramsMap.bllyName" jdbcType="VARCHAR" />
    <result column="GDBH"   property="paramsMap.gdbh"  jdbcType="VARCHAR" />
    <result column="GDZT"   property="paramsMap.gdzt"  jdbcType="VARCHAR" />
    
    <result column="BJH" 	property="bjh" 	 jdbcType="VARCHAR" />
    <result column="XLH" 	property="xlh" 	 jdbcType="VARCHAR" />
    <result column="FXSJ" 	property="fxsj"  jdbcType="DECIMAL" />
    <result column="FXXH" 	property="fxxh"  jdbcType="DECIMAL" />
    
    
    <result column="IS_WARNING" 	property="isWarning"  jdbcType="VARCHAR" />
    <result column="SJSYSTRS" 	property="sjsyStrs"  jdbcType="VARCHAR" />
    <result column="SCSTRS" 	property="scStrs"  jdbcType="VARCHAR" />
    <result column="ZCSTRS" 	property="zcStrs"  jdbcType="VARCHAR" />
    
  </resultMap>
  <resultMap id="ResultMap" extends="BaseResultMap" type="com.eray.thjw.produce.po.FailureKeep">
	    <!--fixChapter 章节号 -->
 		<association property="fixChapter" javaType="com.eray.thjw.po.FixChapter">
	       <id     column="ZJH_ZJH"      property="zjh"      jdbcType="VARCHAR" />
		   <result column="ZJH_DPRTCODE" property="dprtcode" jdbcType="VARCHAR" />
		   <result column="ZJH_ZWMS"     property="zwms"     jdbcType="VARCHAR" />
		   <result column="ZJH_YWMS"     property="ywms"     jdbcType="VARCHAR" />
     	</association>  
	    <!--whr 维护人 -->
 		<association property="whr" javaType="com.eray.thjw.po.User">  
	        <id column="WHR_ID" property="id"/>  
	        <result column="WHR_USERUSER" property="username"/>  
	        <result column="WHR_REALNAME" property="realname"/>  
	    </association>  
	    <!--dprt 机构代码  -->
 		<association property="dprt" javaType="com.eray.thjw.po.Department">
	        <id     column="dprt_dprtcode"    property="id"/>
	        <result column="dprt_dprtname" 	  property="dprtname"/>
     	</association>  
     	<!-- 故障保留-监控 -->
     	<collection property="monitors" ofType="com.eray.thjw.produce.po.FailureKeepJK">
	        <id column="JK_ID" property="id" jdbcType="VARCHAR" />
		    <result column="JK_JKLBH" property="jklbh" jdbcType="VARCHAR" />
		    <result column="JK_JKFLBH" property="jkflbh" jdbcType="VARCHAR" />
		    <result column="JK_JKZ" property="jkz" jdbcType="VARCHAR" />
		    <result column="JK_JD" property="jd" jdbcType="DECIMAL" />
		    <result column="JK_JKBS" property="jkbs" jdbcType="DECIMAL" />
	   	</collection>
  </resultMap>
  <sql id="Base_Column_List" >
    ID, DPRTCODE, WHDWID, WHRID, WHSJ, ZT, ZCBLBS, BLDH, FJZCH, ZJH, HZ, BS145,BLLY, BLLYID, 
    BLLX, BLLXSM, SXGS_RS, SXGS_XS, BLYJ, GZMS, BLYY, LSCS, MBS, MSM, OBS, OSM, YXXZBS, 
    YXXZSM, SC_SQRBMID, SC_SQRID, SC_SQRZZH, SC_SQRQ, SC_BLQX, SC_PZRBMID, SC_PZRID, 
    SC_PZRQ, SC_PZYJ, SC_PZCZSJ, ZC_SQRBMID, ZC_SQRID, ZC_SQRQ, ZC_BLQX, ZC_BLYY, ZC_PZRBMID, 
    ZC_PZRID, ZC_PZRQ, JFPZYJ, JFPZR, JFPZRQ, GBRBMID, GBRID, GBCZSJ, GBYY, GZZ, GZRQ, 
    JCZ, JCRQ, GDID,BJH,XLH,FXSJ,FXXH
  </sql>
  <!--故障保留分页查询 Start-->
  <select id="queryAllPageList"  resultMap="ResultMap">
	SELECT  B1.ID, B1.DPRTCODE, B1.WHDWID, B1.WHRID, B1.WHSJ, B1.ZT, B1.ZCBLBS, B1.BLDH, B1.FJZCH, B1.ZJH, B1.HZ,B1.BS145, B1.BLLY, B1.BLLYID, 
		    B1.BLLX, B1.BLLXSM, B1.SXGS_RS, B1.SXGS_XS, B1.BLYJ, B1.GZMS, B1.BLYY, B1.LSCS, B1.MBS, B1.MSM, B1.OBS, B1.OSM, B1.YXXZBS, 
		    B1.YXXZSM, B1.SC_SQRBMID, B1.SC_SQRID, B1.SC_SQRZZH, B1.SC_SQRQ, B1.SC_BLQX, B1.SC_PZRBMID, B1.SC_PZRID, 
        	(CASE 
	             WHEN (B1.ZC_BLQX IS  NULL) 
	             THEN  CEIL(B1.SC_BLQX  - SYSDATE) 
	             ELSE  CEIL(B1.ZC_BLQX  - SYSDATE) 
             END
            ) SYTS,
		    B2.USERNAME || ' ' || B2.REALNAME AS SCSQR,
		    B1.SC_PZRQ, B1.SC_PZYJ, B1.SC_PZCZSJ, B1.ZC_SQRBMID, B1.ZC_SQRID, B1.ZC_SQRQ, B1.ZC_BLQX, B1.ZC_BLYY, B1.ZC_PZRBMID, 
		    B1.ZC_PZRID, B1.ZC_PZRQ, B1.JFPZYJ, B1.JFPZR, B1.JFPZRQ, B1.GBRBMID, B1.GBRID, B1.GBCZSJ, B1.GBYY, B1.GZZ, B1.GZRQ,B1.JCZ, B1.JCRQ, B1.GDID,
		    B4.USERNAME || ' ' || B4.REALNAME AS WHR_ID,
       	    B5.DPRTNAME AS DPRT_DPRTNAME,	
       	    B6.ZJH || ' ' ||B6.YWMS AS ZJH_ZJH,
		    B7.USERNAME || ' ' || B7.REALNAME AS GBR,
		    (CASE WHEN (B1.BS145 = 1) THEN BB1.GDBH ELSE BB2.GDBH END) GDBH,
		    (CASE WHEN (B1.BS145 = 1) THEN BB1.ZT ELSE BB2.ZT END) GDZT,
		    B1.BJH,B1.XLH,B1.FXSJ,B1.FXXH,
		    T7.IS_WARNING AS IS_WARNING, --警告
	        T7.JHSJSJ AS SJSYSTRS, --实际剩余期限
	        T8.JHSJSJ AS SCSTRS, --首次期限
	        T9.JHSJSJ AS ZCSTRS --再次期限
	     	FROM B_S2_013 B1
	        LEFT JOIN T_USER B2 ON B2.ID=B1.SC_SQRID
	        LEFT JOIN T_USER B4 ON B1.WHRID=B4.ID
			LEFT JOIN T_DEPARTMENT B5 ON B1.DPRTCODE=B5.ID
		 	LEFT JOIN D_005 B6 ON B1.ZJH =B6.ZJH AND B1.DPRTCODE=B6.DPRTCODE
	        LEFT JOIN T_USER B7 ON B7.ID=B1.GBRID
		 	LEFT JOIN B_S2_014 BB1 ON BB1.ID=B1.GDID
	        LEFT JOIN B_S2_008 BB2 ON BB2.ID=B1.GDID
	        
	        
	         LEFT JOIN (SELECT T6.GZBLID, MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.JHZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ    JHZ,
                                    S201301.MAINID GZBLID
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JD = 1
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T8
    ON T8.GZBLID = B1.ID
  LEFT JOIN (SELECT T6.GZBLID, MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.JHZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ    JHZ,
                                    S201301.MAINID GZBLID
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JD = 2
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T9
    ON T9.GZBLID = B1.ID
  LEFT JOIN (SELECT T6.GZBLID,
                    MAX(IS_WARNING) IS_WARNING,
                    MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            CASE
                              WHEN T4.LX = 2 THEN
                               CASE
                                 WHEN T4.SYZ &lt;= T4.FZ THEN
                                  1
                                 ELSE
                                  0
                               END
                              ELSE
                               CASE
                                 WHEN T4.JKLBH = '1_10' THEN
                                  CASE
                                    WHEN T4.SYZ &lt;= 0 THEN
                                     1
                                    ELSE
                                     0
                                  END
                                 ELSE
                                  CASE
                                    WHEN T4.SYZ &lt;=
                                         CEIL(COALESCE(T4.JHZ * 1, 0) *
                                              (COALESCE(T4.FZ, 0) / 100)) THEN
                                     1
                                    ELSE
                                     0
                                  END
                               END
                            END IS_WARNING,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.SJZ || '#_#' ||
                                      T4.SYZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ JHZ,
                                    S201301.MAINID GZBLID,
                                    CASE
                                      WHEN S201301.JKLBH = '1_10' THEN
                                       TO_CHAR(SYSDATE, 'yyyy-mm-dd')
                                      ELSE
                                       (COALESCE(S2911.LJZ, 0) +
                                       COALESCE(S2911.CSZ, 0)) || ''
                                    END SJZ,
                                    CASE
                                      WHEN S201301.JKLBH = '1_10' THEN
                                       TO_DATE(S201301.JKZ, 'yyyy-mm-dd') -
                                       TO_DATE(TO_CHAR(SYSDATE, 'yyyy-mm-dd'),
                                               'yyyy-mm-dd')
                                      ELSE
                                       CAST(S201301.JKZ AS INTEGER) -
                                       (COALESCE(S2911.LJZ, 0) +
                                        COALESCE(S2911.CSZ, 0))
                                    END * 1 SYZ,
                                    THRESHOLD.FZ,
                                    THRESHOLD.LX
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JKBS = 1
                               LEFT JOIN B_S2_911 S2911
                                 ON S2911.DPRTCODE = S2013.DPRTCODE
                                AND S2911.FJZCH = S2013.FJZCH
                                AND S2911.JKLBH = S201301.JKLBH
                                AND S2911.WZ = 11
                               LEFT JOIN T_THRESHOLD_AIR THRESHOLD
                                 ON THRESHOLD.DPRTCODE = S2013.DPRTCODE
                                AND THRESHOLD.FJZCH = S2013.FJZCH
                                AND THRESHOLD.JKLBH = S201301.JKLBH
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T7
    ON T7.GZBLID = B1.ID
	        
			<include refid="BaseResulParam"></include>
	    	<choose>
				 <when test='pagination.sort == "auto"'>
				    	 ORDER BY T7.IS_WARNING
				 </when>
			     <otherwise>
					     ORDER BY ${pagination.sort} ${pagination.order}
			     </otherwise>
		    </choose>
  </select>
  <!--故障保留分页查询 End-->
  
   <!--故障保留监控分页查询 Start-->
  <select id="queryMonitorAllPageList"  resultMap="ResultMap">
	SELECT  B1.ID, B1.DPRTCODE, B1.WHDWID, B1.WHRID, B1.WHSJ, B1.ZT, B1.ZCBLBS, B1.BLDH, B1.FJZCH, B1.ZJH, B1.HZ,B1.BS145, B1.BLLY, B1.BLLYID, 
		    B1.BLLX, B1.BLLXSM, B1.SXGS_RS, B1.SXGS_XS, B1.BLYJ, B1.GZMS, B1.BLYY, B1.LSCS, B1.MBS, B1.MSM, B1.OBS, B1.OSM, B1.YXXZBS, 
		    B1.YXXZSM, B1.SC_SQRBMID, B1.SC_SQRID, B1.SC_SQRZZH, B1.SC_SQRQ, B1.SC_BLQX, B1.SC_PZRBMID, B1.SC_PZRID, 
        	(CASE 
            	 WHEN (B1.ZC_BLQX IS  NULL) 
	             THEN  CEIL(B1.SC_BLQX  - SYSDATE) 
	             ELSE  CEIL(B1.ZC_BLQX  - SYSDATE) 
             END
            ) SYTS,
		    B2.USERNAME || ' ' || B2.REALNAME AS SCSQR,
		    B1.SC_PZRQ, B1.SC_PZYJ, B1.SC_PZCZSJ, B1.ZC_SQRBMID, B1.ZC_SQRID, B1.ZC_SQRQ, B1.ZC_BLQX, B1.ZC_BLYY, B1.ZC_PZRBMID, 
		    B1.ZC_PZRID, B1.ZC_PZRQ, B1.JFPZYJ, B1.JFPZR, B1.JFPZRQ, B1.GBRBMID, B1.GBRID, B1.GBCZSJ, B1.GBYY, B1.GZZ, B1.GZRQ,B1.JCZ, B1.JCRQ, B1.GDID,
		    B4.USERNAME || ' ' || B4.REALNAME AS WHR_ID,
       	    B5.DPRTNAME AS DPRT_DPRTNAME,	
       	    B6.ZJH || ' ' ||B6.YWMS AS ZJH_ZJH,
		    B7.USERNAME || ' ' || B7.REALNAME AS GBR,
		    (CASE 
			    WHEN (B1.BS145 = 1) 
			    THEN BB1.GDBH 
			    ELSE BB2.GDBH 
		    END
		    ) GDBH,
		    (CASE 
		    	WHEN (B1.BS145 = 1) 
		    	THEN BB1.ZT 
		    	ELSE BB2.ZT 
		    END
		    ) GDZT,
		    B1.BJH,B1.XLH,B1.FXSJ,B1.FXXH,
	        T7.IS_WARNING AS IS_WARNING, --警告
	        T7.JHSJSJ AS SJSYSTRS, --实际剩余期限
	        T8.JHSJSJ AS SCSTRS, --首次期限
	        T9.JHSJSJ AS ZCSTRS --再次期限
	     	FROM B_S2_013 B1
	        LEFT JOIN T_USER B2 ON B2.ID=B1.SC_SQRID
	        LEFT JOIN T_USER B4 ON B1.WHRID=B4.ID
			LEFT JOIN T_DEPARTMENT B5 ON B1.DPRTCODE=B5.ID
		 	LEFT JOIN D_005 B6 ON B1.ZJH =B6.ZJH AND B1.DPRTCODE=B6.DPRTCODE
	        LEFT JOIN T_USER B7 ON B7.ID=B1.GBRID
		 	LEFT JOIN B_S2_014 BB1 ON BB1.ID=B1.GDID
	        LEFT JOIN B_S2_008 BB2 ON BB2.ID=B1.GDID
	        
	        
	        LEFT JOIN (SELECT T6.GZBLID, MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.JHZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ    JHZ,
                                    S201301.MAINID GZBLID
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JD = 1
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T8
    ON T8.GZBLID = B1.ID
  LEFT JOIN (SELECT T6.GZBLID, MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.JHZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ    JHZ,
                                    S201301.MAINID GZBLID
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JD = 2
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T9
    ON T9.GZBLID = B1.ID
  LEFT JOIN (SELECT T6.GZBLID,
                    MAX(IS_WARNING) IS_WARNING,
                    MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            CASE
                              WHEN T4.LX = 2 THEN
                               CASE
                                 WHEN T4.SYZ &lt;= T4.FZ THEN
                                  1
                                 ELSE
                                  0
                               END
                              ELSE
                               CASE
                                 WHEN T4.JKLBH = '1_10' THEN
                                  CASE
                                    WHEN T4.SYZ &lt;= 0 THEN
                                     1
                                    ELSE
                                     0
                                  END
                                 ELSE
                                  CASE
                                    WHEN T4.SYZ &lt;=
                                         CEIL(COALESCE(T4.JHZ * 1, 0) *
                                              (COALESCE(T4.FZ, 0) / 100)) THEN
                                     1
                                    ELSE
                                     0
                                  END
                               END
                            END IS_WARNING,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.SJZ || '#_#' ||
                                      T4.SYZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ JHZ,
                                    S201301.MAINID GZBLID,
                                    CASE
                                      WHEN S201301.JKLBH = '1_10' THEN
                                       TO_CHAR(SYSDATE, 'yyyy-mm-dd')
                                      ELSE
                                       (COALESCE(S2911.LJZ, 0) +
                                       COALESCE(S2911.CSZ, 0)) || ''
                                    END SJZ,
                                    CASE
                                      WHEN S201301.JKLBH = '1_10' THEN
                                       TO_DATE(S201301.JKZ, 'yyyy-mm-dd') -
                                       TO_DATE(TO_CHAR(SYSDATE, 'yyyy-mm-dd'),
                                               'yyyy-mm-dd')
                                      ELSE
                                       CAST(S201301.JKZ AS INTEGER) -
                                       (COALESCE(S2911.LJZ, 0) +
                                        COALESCE(S2911.CSZ, 0))
                                    END * 1 SYZ,
                                    THRESHOLD.FZ,
                                    THRESHOLD.LX
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JKBS = 1
                               LEFT JOIN B_S2_911 S2911
                                 ON S2911.DPRTCODE = S2013.DPRTCODE
                                AND S2911.FJZCH = S2013.FJZCH
                                AND S2911.JKLBH = S201301.JKLBH
                                AND S2911.WZ = 11
                               LEFT JOIN T_THRESHOLD_AIR THRESHOLD
                                 ON THRESHOLD.DPRTCODE = S2013.DPRTCODE
                                AND THRESHOLD.FJZCH = S2013.FJZCH
                                AND THRESHOLD.JKLBH = S201301.JKLBH
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T7
    ON T7.GZBLID = B1.ID
	        
			<include refid="BaseResulParam"></include> AND B1.ZT NOT IN 1
	    	<choose>
				 <when test='pagination.sort == "auto"'>
				    	 ORDER BY WHSJ
				 </when>
			     <otherwise>
					     ORDER BY ${pagination.sort} ${pagination.order}
			     </otherwise>
		    </choose>
  </select>
  <!-- 搜索参数 -->
  <sql id="BaseResulParam">
	   		 WHERE 1=1  
	    <if test="fjzch != null and fjzch != ''">
             AND B1.FJZCH = #{fjzch, jdbcType=VARCHAR}
        </if>
	    <if test="zjh != null and zjh != ''">
             AND B1.ZJH = #{zjh, jdbcType=VARCHAR}
        </if>
        <if test="paramsMap.ztList != null and paramsMap.ztList != '' ">
             AND  B1.ZT IN (${paramsMap.ztList})  
        </if>
	    <if test="paramsMap != null and paramsMap.sqBeginDate != null and paramsMap.sqBeginDate != ''">
		     AND (B1.SC_SQRQ &gt;= TO_DATE(#{paramsMap.sqBeginDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		     OR	  B1.ZC_SQRQ &gt;= TO_DATE(#{paramsMap.sqBeginDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		     	 )
		</if>
		<if test="paramsMap != null and paramsMap.sqEndDate != null and paramsMap.sqEndDate != ''">
		     AND (B1.SC_SQRQ &lt;= TO_DATE(#{paramsMap.sqEndDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		     OR   B1.ZC_SQRQ &lt;= TO_DATE(#{paramsMap.sqEndDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')	
		     	 )	
		</if>
		 <if test="paramsMap != null and paramsMap.qxBeginDate != null and paramsMap.qxBeginDate != ''">
			 AND (CASE
		         WHEN B1.ZC_BLQX IS NULL THEN
		         B1.SC_BLQX
		         ELSE
		         B1.ZC_BLQX
		     END) &gt;= TO_DATE(#{paramsMap.qxBeginDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		</if>
		 <if test="paramsMap != null and paramsMap.qxEndDate != null and paramsMap.qxEndDate != ''">
			 AND (CASE
		         WHEN B1.ZC_BLQX IS NULL THEN
		         B1.SC_BLQX
		         ELSE
		         B1.ZC_BLQX
		     END)  &lt;= TO_DATE(#{paramsMap.qxEndDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		</if>
        <if test="dprtcode != null and dprtcode != ''">
             AND B1.DPRTCODE =  #{dprtcode, jdbcType=VARCHAR}
        </if>
        <if test="keyword != null and keyword != ''">
		     AND (
		     	UPPER(B1.BLDH) LIKE UPPER('%'||#{keyword}||'%')
		     	 )              <!-- 左右匹配 查询关键字 -->
		</if>
	    <if test="id != null and id != '' " >   
            AND  B1.ID  = #{id, jdbcType=VARCHAR}
        </if>
        <!-- 前台条件：飞机，机型，sql需要全部的范围，以及带上当前记录的机构码 -->
        <choose>                                                                 
	    	<when test='paramsMap.userType!=null and paramsMap.userType == "admin"'>                       
	    
	    	</when>
	    	<when test='paramsMap.userType != "admin" and paramsMap.userId != null and paramsMap.userId !=""'>  
	    		 AND exists 
	    		( select t.dprtcode, t.fjzch, t.fjjx,max(t.xlh) xlh
		         	 from (
		          		SELECT  DPRTCODE,FJZCH,XLH,FJJX from V_ROLE_JX 
		                 where USER_ID = #{paramsMap.userId,jdbcType=VARCHAR} 
		                union all
		                select d010.dprtcode, d010.fjzch, d010.xlh,d010.fjjx
		                  from d_010 d010
		                 where d010.zt = 1) t where t.dprtcode=DPRTCODE
		        		 group by t.dprtcode, t.fjzch,t.fjjx
	    		)
	    	</when>
   		 </choose>
  </sql>
  <!--根据故障保留id查询故障保留信息 Start-->
  <select id="getInfoById"  resultMap="ResultMap" >
		SELECT B1.ID, B1.DPRTCODE, B1.WHDWID, B1.WHRID, B1.WHSJ, B1.ZT, B1.ZCBLBS, B1.BLDH, B1.FJZCH, B1.ZJH, B1.HZ,B1.BS145, B1.BLLY, B1.BLLYID, 
        B1.BLLX, B1.BLLXSM, B1.SXGS_RS, B1.SXGS_XS, B1.BLYJ, B1.GZMS, B1.BLYY, B1.LSCS, B1.MBS, B1.MSM, B1.OBS, B1.OSM, B1.YXXZBS, 
        B1.YXXZSM, B1.SC_SQRBMID, B1.SC_SQRID, B1.SC_SQRZZH, B1.SC_SQRQ, B1.SC_BLQX, B1.SC_PZRBMID, B1.SC_PZRID, 
        B1.BJH,B1.XLH,B1.FXSJ,B1.FXXH,
        (CASE 
            WHEN (B1.ZC_BLQX IS  NULL) 
            THEN  CEIL(B1.SC_BLQX  - SYSDATE) 
            ELSE  CEIL(B1.ZC_BLQX  - SYSDATE) 
            END
        ) SYTS,
        B1.SC_PZRQ, B1.SC_PZYJ, B1.SC_PZCZSJ, B1.ZC_SQRBMID, B1.ZC_SQRID, B1.ZC_SQRQ, B1.ZC_BLQX, B1.ZC_BLYY, B1.ZC_PZRBMID, 
        B1.ZC_PZRID, B1.ZC_PZRQ, B1.JFPZYJ, B1.JFPZR, B1.JFPZRQ, B1.GBRBMID, B1.GBRID, B1.GBCZSJ, B1.GBYY, B1.GZZ, B1.GZRQ,B1.JCZ, B1.JCRQ, B1.GDID,
        B2.USERNAME || ' ' || B2.REALNAME AS SCSQR,
        B3.USERNAME || ' ' || B3.REALNAME AS SCPZR,
        B4.USERNAME || ' ' || B4.REALNAME AS WHR_ID,
        B5.DPRTNAME AS DPRT_DPRTNAME,  
        B6.ZJH || ' ' ||B6.YWMS AS ZJH_ZJH,
        B8.USERNAME || ' ' || B8.REALNAME AS ZCSQR,
        B9.USERNAME || ' ' || B9.REALNAME AS ZCPZR,
        ( CASE
          WHEN B1.blly='1' 
          THEN (SELECT fxjlbh FROM b_s2_006 BB1 WHERE BB1.ID=B1.BLLYID)
          WHEN  B1.blly='2' 
          THEN 
	          (CASE 
		           WHEN (B1.BS145 = 1) 
		           THEN (SELECT GDBH FROM B_S2_014 BB1 WHERE BB1.ID=B1.BLLYID )
		           WHEN (B1.BS145 = 0)  
		           THEN( SELECT GDBH FROM B_S2_008 BB1 WHERE BB1.ID=B1.BLLYID)
		       END)
         END
         ) as  BLLYNAME,
         B1.BJH,B1.XLH,B1.FXSJ,B1.FXXH
         FROM B_S2_013 B1
         LEFT JOIN T_USER B2 ON B2.ID=B1.SC_SQRID
         LEFT JOIN T_USER B3 ON B3.ID=B1.SC_PZRID
         LEFT JOIN T_USER B4 ON B1.WHRID=B4.ID
       	 LEFT JOIN T_DEPARTMENT B5 ON B1.DPRTCODE=B5.ID
       	 LEFT JOIN D_005 B6 ON B1.ZJH =B6.ZJH AND B1.DPRTCODE=B6.DPRTCODE
         LEFT JOIN T_USER B8 ON B8.ID=B1.ZC_SQRID
         LEFT JOIN T_USER B9 ON B9.ID=B1.ZC_PZRID
		 WHERE  B1.ID  = #{id, jdbcType=VARCHAR}
  </select>
  <!--根据故障保留id查询故障保留信息 End-->
  <!-- 根据查询条件查询故障保留数量 -->
  <select id="queryCount" parameterType="com.eray.thjw.produce.po.FailureKeep" resultType="java.lang.Integer">
	SELECT COUNT(1) FROM B_S2_013 
    WHERE BLDH     = #{ bldh,     jdbcType = VARCHAR }
  	AND   DPRTCODE = #{ dprtcode, jdbcType = VARCHAR }
  </select>
  <!--根据故障保留id查询当前的故障保留状态-->
  <select id="getCurrentZt4Validation" parameterType="String" resultType="int">
	select zt from B_S2_013 where id=#{id, jdbcType=VARCHAR}
  </select>
  <!--根据故障保留id查询当前的故障保留再次保留标识-->
  <select id="getCurrentZcblbs4Validation" parameterType="String" resultType="int">
	select zcblbs from B_S2_013 where id=#{id, jdbcType=VARCHAR}
  </select>
  <!--飞行记录本查询故障保留单-->
  <select id="queryListByFLB" parameterType="com.eray.thjw.produce.po.FlightSheet" resultMap="ResultMap">
  	select 
  	  B1.ID, B1.DPRTCODE, B1.WHDWID, B1.WHRID, B1.WHSJ, B1.ZT, B1.ZCBLBS, B1.BLDH, B1.FJZCH, B1.ZJH, B1.HZ,B1.BS145, B1.BLLY, B1.BLLYID, 
		    B1.BLLX, B1.BLLXSM, B1.SXGS_RS, B1.SXGS_XS, B1.BLYJ, B1.GZMS, B1.BLYY, B1.LSCS, B1.MBS, B1.MSM, B1.OBS, B1.OSM, B1.YXXZBS, 
		    B1.YXXZSM, B1.SC_SQRBMID, B1.SC_SQRID, B1.SC_SQRZZH, B1.SC_SQRQ, B1.SC_BLQX, B1.SC_PZRBMID, B1.SC_PZRID,B1.JCRQ, B1.ZC_BLYY,
		    T8.JHSJSJ AS SCSTRS
	  from b_s2_013 b1 
	  LEFT JOIN (SELECT T6.GZBLID, MAX(T6.JHSJSJ) JHSJSJ
               FROM (SELECT T4.GZBLID,
                            WM_CONCAT(T4.JKLBH || '#_#' || T4.JHZ) OVER(PARTITION BY T4.GZBLID ORDER BY T4.GZBLID) JHSJSJ
                       FROM (SELECT S201301.JKLBH,
                                    S201301.JKZ    JHZ,
                                    S201301.MAINID GZBLID
                               FROM B_S2_01301 S201301
                               JOIN B_S2_013 S2013
                                 ON S201301.MAINID = S2013.ID
                                AND S201301.JKBS = 1
                              WHERE 1 = 1) T4
                      WHERE 1 = 1) T6
              GROUP BY T6.GZBLID) T8
    ON T8.GZBLID = B1.ID
	 where fjzch = #{fjzch,jdbcType=VARCHAR} and dprtcode = #{dprtcode,jdbcType=VARCHAR}
	   and trunc(sc_sqrq) &lt;= trunc(#{fxrq,jdbcType=TIMESTAMP})
	   and case when jcrq is null then to_date('9999-12-31','yyyy-mm-dd') else trunc(jcrq) end &gt;= trunc(#{fxrq,jdbcType=TIMESTAMP})
	   and zt in (4, 10)
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from B_S2_013
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from B_S2_013
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.eray.thjw.produce.po.FailureKeep" >
    insert into B_S2_013 (ID, DPRTCODE, WHDWID, 
      WHRID, WHSJ, ZT, 
      ZCBLBS, BLDH, FJZCH, 
      ZJH, HZ, BS145,BLLY, BLLYID, 
      BLLX, BLLXSM, SXGS_RS, 
      SXGS_XS, BLYJ, GZMS, 
      BLYY, LSCS, MBS, MSM, 
      OBS, OSM, YXXZBS, YXXZSM, 
      SC_SQRBMID, SC_SQRID, SC_SQRZZH, 
      SC_SQRQ, SC_PZRBMID, 
      SC_PZRID, SC_PZRQ, SC_PZYJ, 
      SC_PZCZSJ, ZC_SQRBMID, ZC_SQRID, 
      ZC_SQRQ, ZC_BLYY, 
      ZC_PZRBMID, ZC_PZRID, ZC_PZRQ, 
      JFPZYJ, JFPZR, JFPZRQ, 
      GBRBMID, GBRID, GBCZSJ, 
      GBYY, GZZ, GZRQ, 
      JCZ, JCRQ, GDID,BJH,XLH,FXSJ,FXXH)
    values (#{id,jdbcType=VARCHAR}, #{dprtcode,jdbcType=VARCHAR}, #{whdwid,jdbcType=VARCHAR}, 
      #{whrid,jdbcType=VARCHAR}, #{whsj,jdbcType=TIMESTAMP}, #{zt,jdbcType=DECIMAL}, 
      #{zcblbs,jdbcType=DECIMAL}, #{bldh,jdbcType=VARCHAR}, #{fjzch,jdbcType=VARCHAR}, 
      #{zjh,jdbcType=VARCHAR}, #{hz,jdbcType=VARCHAR}, #{bs145,jdbcType=DECIMAL},#{blly,jdbcType=DECIMAL}, #{bllyid,jdbcType=VARCHAR}, 
      #{bllx,jdbcType=VARCHAR}, #{bllxsm,jdbcType=VARCHAR}, #{sxgsRs,jdbcType=DECIMAL}, 
      #{sxgsXs,jdbcType=DECIMAL}, #{blyj,jdbcType=VARCHAR}, #{gzms,jdbcType=VARCHAR}, 
      #{blyy,jdbcType=VARCHAR}, #{lscs,jdbcType=VARCHAR}, #{mbs,jdbcType=DECIMAL}, #{msm,jdbcType=VARCHAR}, 
      #{obs,jdbcType=DECIMAL}, #{osm,jdbcType=VARCHAR}, #{yxxzbs,jdbcType=DECIMAL}, #{yxxzsm,jdbcType=VARCHAR}, 
      #{scSqrbmid,jdbcType=VARCHAR}, #{scSqrid,jdbcType=VARCHAR}, #{scSqrzzh,jdbcType=VARCHAR}, 
      #{scSqrq,jdbcType=TIMESTAMP}, #{scPzrbmid,jdbcType=VARCHAR}, 
      #{scPzrid,jdbcType=VARCHAR}, #{scPzrq,jdbcType=TIMESTAMP}, #{scPzyj,jdbcType=VARCHAR}, 
      #{scPzczsj,jdbcType=TIMESTAMP}, #{zcSqrbmid,jdbcType=VARCHAR}, #{zcSqrid,jdbcType=VARCHAR}, 
      #{zcSqrq,jdbcType=TIMESTAMP}, #{zcBlyy,jdbcType=VARCHAR}, 
      #{zcPzrbmid,jdbcType=VARCHAR}, #{zcPzrid,jdbcType=VARCHAR}, #{zcPzrq,jdbcType=TIMESTAMP}, 
      #{jfpzyj,jdbcType=VARCHAR}, #{jfpzr,jdbcType=VARCHAR}, #{jfpzrq,jdbcType=TIMESTAMP}, 
      #{gbrbmid,jdbcType=VARCHAR}, #{gbrid,jdbcType=VARCHAR}, #{gbczsj,jdbcType=TIMESTAMP}, 
      #{gbyy,jdbcType=VARCHAR}, #{gzz,jdbcType=VARCHAR}, #{gzrq,jdbcType=TIMESTAMP}, 
      #{jcz,jdbcType=VARCHAR}, #{jcrq,jdbcType=TIMESTAMP}, #{gdid,jdbcType=VARCHAR},
      #{bjh,jdbcType=VARCHAR},#{xlh,jdbcType=VARCHAR},#{fxsj,jdbcType=DECIMAL},#{fxxh,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.eray.thjw.produce.po.FailureKeep" >
    insert into B_S2_013
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="dprtcode != null" >
        DPRTCODE,
      </if>
      <if test="whdwid != null" >
        WHDWID,
      </if>
      <if test="whrid != null" >
        WHRID,
        WHSJ,
      </if>
      <if test="zt != null" >
        ZT,
      </if>
      <if test="zcblbs != null" >
        ZCBLBS,
      </if>
      <if test="bldh != null" >
        BLDH,
      </if>
      <if test="fjzch != null" >
        FJZCH,
      </if>
      <if test="zjh != null" >
        ZJH,
      </if>
      <if test="hz != null" >
        HZ,
      </if>
      <if test="bs145 != null" >
        BS145,
      </if>
      <if test="blly != null" >
        BLLY,
      </if>
      <if test="bllyid != null" >
        BLLYID,
      </if>
      <if test="bllx != null" >
        BLLX,
      </if>
      <if test="bllxsm != null" >
        BLLXSM,
      </if>
      <if test="sxgsRs != null" >
        SXGS_RS,
      </if>
      <if test="sxgsXs != null" >
        SXGS_XS,
      </if>
      <if test="blyj != null" >
        BLYJ,
      </if>
      <if test="gzms != null" >
        GZMS,
      </if>
      <if test="blyy != null" >
        BLYY,
      </if>
      <if test="lscs != null" >
        LSCS,
      </if>
      <if test="mbs != null" >
        MBS,
      </if>
      <if test="msm != null" >
        MSM,
      </if>
      <if test="obs != null" >
        OBS,
      </if>
      <if test="osm != null" >
        OSM,
      </if>
      <if test="yxxzbs != null" >
        YXXZBS,
      </if>
      <if test="yxxzsm != null" >
        YXXZSM,
      </if>
      <if test="scSqrbmid != null" >
        SC_SQRBMID,
      </if>
      <if test="scSqrid != null" >
        SC_SQRID,
      </if>
      <if test="scSqrzzh != null" >
        SC_SQRZZH,
      </if>
      <if test="scSqrq != null" >
        SC_SQRQ,
      </if>
      <if test="scPzrbmid != null" >
        SC_PZRBMID,
      </if>
      <if test="scPzrid != null" >
        SC_PZRID,
      </if>
      <if test="scPzrq != null" >
        SC_PZRQ,
      </if>
      <if test="scPzyj != null" >
        SC_PZYJ,
      </if>
      <if test="scPzczsj != null" >
        SC_PZCZSJ,
      </if>
      <if test="zcSqrbmid != null" >
        ZC_SQRBMID,
      </if>
      <if test="zcSqrid != null" >
        ZC_SQRID,
      </if>
      <if test="zcSqrq != null" >
        ZC_SQRQ,
      </if>
      <if test="zcBlyy != null" >
        ZC_BLYY,
      </if>
      <if test="zcPzrbmid != null" >
        ZC_PZRBMID,
      </if>
      <if test="zcPzrid != null" >
        ZC_PZRID,
      </if>
      <if test="zcPzrq != null" >
        ZC_PZRQ,
      </if>
      <if test="jfpzyj != null" >
        JFPZYJ,
      </if>
      <if test="jfpzr != null" >
        JFPZR,
      </if>
      <if test="jfpzrq != null" >
        JFPZRQ,
      </if>
      <if test="gbrbmid != null" >
        GBRBMID,
      </if>
      <if test="gbrid != null" >
        GBRID,
      </if>
      <if test="gbczsj != null" >
        GBCZSJ,
      </if>
      <if test="gbyy != null" >
        GBYY,
      </if>
      <if test="gzz != null" >
        GZZ,
      </if>
      <if test="gzrq != null" >
        GZRQ,
      </if>
      <if test="jcz != null" >
        JCZ,
      </if>
      <if test="jcrq != null" >
        JCRQ,
      </if>
      <if test="gdid != null" >
        GDID,
      </if>
       <if test="bjh != null" >
        BJH,
      </if>
       <if test="xlh != null" >
        XLH,
      </if>
       <if test="fxsj != null" >
        FXSJ,
      </if>
       <if test="fxxh != null" >
        FXXH,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="dprtcode != null" >
        #{dprtcode,jdbcType=VARCHAR},
      </if>
      <if test="whdwid != null" >
        #{whdwid,jdbcType=VARCHAR},
      </if>
      <if test="whrid != null" >
        #{whrid,jdbcType=VARCHAR},
     	sysdate,
      </if>
      <if test="zt != null" >
        #{zt,jdbcType=DECIMAL},
      </if>
      <if test="zcblbs != null" >
        #{zcblbs,jdbcType=DECIMAL},
      </if>
      <if test="bldh != null" >
        #{bldh,jdbcType=VARCHAR},
      </if>
      <if test="fjzch != null" >
        #{fjzch,jdbcType=VARCHAR},
      </if>
      <if test="zjh != null" >
        #{zjh,jdbcType=VARCHAR},
      </if>
      <if test="hz != null" >
        #{hz,jdbcType=VARCHAR},
      </if>
      <if test="bs145 != null" >
        #{bs145,jdbcType=DECIMAL},
      </if>
      <if test="blly != null" >
        #{blly,jdbcType=DECIMAL},
      </if>
      <if test="bllyid != null" >
        #{bllyid,jdbcType=VARCHAR},
      </if>
      <if test="bllx != null" >
        #{bllx,jdbcType=VARCHAR},
      </if>
      <if test="bllxsm != null" >
        #{bllxsm,jdbcType=VARCHAR},
      </if>
      <if test="sxgsRs != null" >
        #{sxgsRs,jdbcType=DECIMAL},
      </if>
      <if test="sxgsXs != null" >
        #{sxgsXs,jdbcType=DECIMAL},
      </if>
      <if test="blyj != null" >
        #{blyj,jdbcType=VARCHAR},
      </if>
      <if test="gzms != null" >
        #{gzms,jdbcType=VARCHAR},
      </if>
      <if test="blyy != null" >
        #{blyy,jdbcType=VARCHAR},
      </if>
      <if test="lscs != null" >
        #{lscs,jdbcType=VARCHAR},
      </if>
      <if test="mbs != null" >
        #{mbs,jdbcType=DECIMAL},
      </if>
      <if test="msm != null" >
        #{msm,jdbcType=VARCHAR},
      </if>
      <if test="obs != null" >
        #{obs,jdbcType=DECIMAL},
      </if>
      <if test="osm != null" >
        #{osm,jdbcType=VARCHAR},
      </if>
      <if test="yxxzbs != null" >
        #{yxxzbs,jdbcType=DECIMAL},
      </if>
      <if test="yxxzsm != null" >
        #{yxxzsm,jdbcType=VARCHAR},
      </if>
      <if test="scSqrbmid != null" >
        #{scSqrbmid,jdbcType=VARCHAR},
      </if>
      <if test="scSqrid != null" >
        #{scSqrid,jdbcType=VARCHAR},
      </if>
      <if test="scSqrzzh != null" >
        #{scSqrzzh,jdbcType=VARCHAR},
      </if>
      <if test="scSqrq != null" >
        #{scSqrq,jdbcType=TIMESTAMP},
      </if>
      <if test="scPzrbmid != null" >
        #{scPzrbmid,jdbcType=VARCHAR},
      </if>
      <if test="scPzrid != null" >
        #{scPzrid,jdbcType=VARCHAR},
      </if>
      <if test="scPzrq != null" >
        #{scPzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="scPzyj != null" >
        #{scPzyj,jdbcType=VARCHAR},
      </if>
      <if test="scPzczsj != null" >
        #{scPzczsj,jdbcType=TIMESTAMP},
      </if>
      <if test="zcSqrbmid != null" >
        #{zcSqrbmid,jdbcType=VARCHAR},
      </if>
      <if test="zcSqrid != null" >
        #{zcSqrid,jdbcType=VARCHAR},
      </if>
      <if test="zcSqrq != null" >
        #{zcSqrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zcBlyy != null" >
        #{zcBlyy,jdbcType=VARCHAR},
      </if>
      <if test="zcPzrbmid != null" >
        #{zcPzrbmid,jdbcType=VARCHAR},
      </if>
      <if test="zcPzrid != null" >
        #{zcPzrid,jdbcType=VARCHAR},
      </if>
      <if test="zcPzrq != null" >
        #{zcPzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jfpzyj != null" >
        #{jfpzyj,jdbcType=VARCHAR},
      </if>
      <if test="jfpzr != null" >
        #{jfpzr,jdbcType=VARCHAR},
      </if>
      <if test="jfpzrq != null" >
        #{jfpzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="gbrbmid != null" >
        #{gbrbmid,jdbcType=VARCHAR},
      </if>
      <if test="gbrid != null" >
        #{gbrid,jdbcType=VARCHAR},
      </if>
      <if test="gbczsj != null" >
        #{gbczsj,jdbcType=TIMESTAMP},
      </if>
      <if test="gbyy != null" >
        #{gbyy,jdbcType=VARCHAR},
      </if>
      <if test="gzz != null" >
        #{gzz,jdbcType=VARCHAR},
      </if>
      <if test="gzrq != null" >
        #{gzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jcz != null" >
        #{jcz,jdbcType=VARCHAR},
      </if>
      <if test="jcrq != null" >
        #{jcrq,jdbcType=TIMESTAMP},
      </if>
      <if test="gdid != null" >
        #{gdid,jdbcType=VARCHAR},
      </if>
      <if test="bjh != null" >
        #{bjh,jdbcType=VARCHAR},
      </if>
       <if test="xlh != null" >
        #{xlh,jdbcType=VARCHAR},
      </if>
       <if test="fxsj != null" >
        #{fxsj ,jdbcType=DECIMAL},
      </if>
       <if test="fxxh != null" >
        #{fxxh,jdbcType=DECIMAL},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.eray.thjw.produce.po.FailureKeep" >
    update B_S2_013
    <set >
      <if test="dprtcode != null" >
        DPRTCODE = #{dprtcode,jdbcType=VARCHAR},
      </if>
      <if test="whdwid != null" >
        WHDWID = #{whdwid,jdbcType=VARCHAR},
      </if>
      <if test="whrid != null" >
        WHRID = #{whrid,jdbcType=VARCHAR},
        WHSJ =sysdate,
      </if>
      <if test="zt != null" >
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
      <if test="zcblbs != null" >
        ZCBLBS = #{zcblbs,jdbcType=DECIMAL},
      </if>
      <if test="bldh != null" >
        BLDH = #{bldh,jdbcType=VARCHAR},
      </if>
      <if test="fjzch != null" >
        FJZCH = #{fjzch,jdbcType=VARCHAR},
      </if>
      <if test="zjh != null" >
        ZJH = #{zjh,jdbcType=VARCHAR},
      </if>
      <if test="hz != null" >
        HZ = #{hz,jdbcType=VARCHAR},
        SXGS_RS = #{sxgsRs,jdbcType=DECIMAL},
        SXGS_XS = #{sxgsXs,jdbcType=DECIMAL},
      </if>
      <if test="bs145 != null" >
        BS145 = #{bs145,jdbcType=DECIMAL},
      </if>
      <if test="blly != null" >
        BLLY = #{blly,jdbcType=DECIMAL},
      </if>
      <if test="bllyid != null" >
        BLLYID = #{bllyid,jdbcType=VARCHAR},
      </if>
      <if test="bllx != null" >
        BLLX = #{bllx,jdbcType=VARCHAR},
      </if>
      <if test="bllxsm != null" >
        BLLXSM = #{bllxsm,jdbcType=VARCHAR},
      </if>
      <if test="blyj != null" >
        BLYJ = #{blyj,jdbcType=VARCHAR},
      </if>
      <if test="gzms != null" >
        GZMS = #{gzms,jdbcType=VARCHAR},
      </if>
      <if test="blyy != null" >
        BLYY = #{blyy,jdbcType=VARCHAR},
      </if>
      <if test="lscs != null" >
        LSCS = #{lscs,jdbcType=VARCHAR},
      </if>
      <if test="mbs != null" >
        MBS = #{mbs,jdbcType=DECIMAL},
      </if>
      <if test="msm != null" >
        MSM = #{msm,jdbcType=VARCHAR},
      </if>
      <if test="obs != null" >
        OBS = #{obs,jdbcType=DECIMAL},
      </if>
      <if test="osm != null" >
        OSM = #{osm,jdbcType=VARCHAR},
      </if>
      <if test="yxxzbs != null" >
        YXXZBS = #{yxxzbs,jdbcType=DECIMAL},
      </if>
      <if test="yxxzsm != null" >
        YXXZSM = #{yxxzsm,jdbcType=VARCHAR},
      </if>
      <if test="scSqrbmid != null" >
        SC_SQRBMID = #{scSqrbmid,jdbcType=VARCHAR},
      </if>
      <if test="scSqrid != null" >
        SC_SQRID = #{scSqrid,jdbcType=VARCHAR},
      </if>
      <if test="scSqrzzh != null" >
        SC_SQRZZH = #{scSqrzzh,jdbcType=VARCHAR},
      </if>
      <if test="scSqrq != null" >
        SC_SQRQ = #{scSqrq,jdbcType=TIMESTAMP},
      </if>
      <if test="scPzrbmid != null" >
        SC_PZRBMID = #{scPzrbmid,jdbcType=VARCHAR},
      </if>
      <if test="scPzrid != null" >
        SC_PZRID = #{scPzrid,jdbcType=VARCHAR},
      </if>
      <if test="scPzrq != null" >
        SC_PZRQ = #{scPzrq,jdbcType=TIMESTAMP},
        SC_PZCZSJ =sysdate,
      </if>
      <if test="scPzyj != null" >
        SC_PZYJ = #{scPzyj,jdbcType=VARCHAR},
      </if>
      <if test="zcSqrbmid != null" >
        ZC_SQRBMID = #{zcSqrbmid,jdbcType=VARCHAR},
      </if>
      <if test="zcSqrid != null" >
        ZC_SQRID = #{zcSqrid,jdbcType=VARCHAR},
      </if>
      <if test="zcSqrq != null" >
        ZC_SQRQ = #{zcSqrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zcBlyy != null" >
        ZC_BLYY = #{zcBlyy,jdbcType=VARCHAR},
      </if>
      <if test="zcPzrbmid != null" >
        ZC_PZRBMID = #{zcPzrbmid,jdbcType=VARCHAR},
      </if>
      <if test="zcPzrid != null" >
        ZC_PZRID = #{zcPzrid,jdbcType=VARCHAR},
      </if>
      <if test="zcPzrq != null" >
        ZC_PZRQ = #{zcPzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jfpzyj != null" >
        JFPZYJ = #{jfpzyj,jdbcType=VARCHAR},
      </if>
      <if test="jfpzr != null" >
        JFPZR = #{jfpzr,jdbcType=VARCHAR},
      </if>
      <if test="jfpzrq != null" >
        JFPZRQ = #{jfpzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="gbrbmid != null" >
        GBRBMID = #{gbrbmid,jdbcType=VARCHAR},
      </if>
      <if test="gbrid != null" >
        GBRID = #{gbrid,jdbcType=VARCHAR},
        GBCZSJ =sysdate,
      </if>
      <if test="gbyy != null" >
        GBYY = #{gbyy,jdbcType=VARCHAR},
      </if>
      <if test="gzz != null" >
        GZZ = #{gzz,jdbcType=VARCHAR},
      </if>
      <if test="gzrq != null" >
        GZRQ = #{gzrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jcz != null" >
        JCZ = #{jcz,jdbcType=VARCHAR},
      </if>
      <if test="jcrq != null" >
        JCRQ = #{jcrq,jdbcType=TIMESTAMP},
      </if>
      <if test="gdid != null" >
        GDID = #{gdid,jdbcType=VARCHAR},
      </if>
      <if test="bjh != null" >
        BJH = #{bjh,jdbcType=VARCHAR},
      </if>
       <if test="xlh != null" >
        XLH = #{xlh,jdbcType=VARCHAR},
      </if>
       <if test="fxsj != null" >
        FXSJ = #{fxsj ,jdbcType=DECIMAL},
      </if>
       <if test="fxxh != null" >
        FXXH = #{fxxh,jdbcType=DECIMAL},
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.eray.thjw.produce.po.FailureKeep" >
    update B_S2_013
    set DPRTCODE = #{dprtcode,jdbcType=VARCHAR},
      WHDWID = #{whdwid,jdbcType=VARCHAR},
      WHRID = #{whrid,jdbcType=VARCHAR},
      WHSJ = #{whsj,jdbcType=TIMESTAMP},
      ZT = #{zt,jdbcType=DECIMAL},
      ZCBLBS = #{zcblbs,jdbcType=DECIMAL},
      BLDH = #{bldh,jdbcType=VARCHAR},
      FJZCH = #{fjzch,jdbcType=VARCHAR},
      ZJH = #{zjh,jdbcType=VARCHAR},
      HZ = #{hz,jdbcType=VARCHAR},
      BS145 = #{bs145,jdbcType=DECIMAL},
      BLLY = #{blly,jdbcType=DECIMAL},
      BLLYID = #{bllyid,jdbcType=VARCHAR},
      BLLX = #{bllx,jdbcType=VARCHAR},
      BLLXSM = #{bllxsm,jdbcType=VARCHAR},
      SXGS_RS = #{sxgsRs,jdbcType=DECIMAL},
      SXGS_XS = #{sxgsXs,jdbcType=DECIMAL},
      BLYJ = #{blyj,jdbcType=VARCHAR},
      GZMS = #{gzms,jdbcType=VARCHAR},
      BLYY = #{blyy,jdbcType=VARCHAR},
      LSCS = #{lscs,jdbcType=VARCHAR},
      MBS = #{mbs,jdbcType=DECIMAL},
      MSM = #{msm,jdbcType=VARCHAR},
      OBS = #{obs,jdbcType=DECIMAL},
      OSM = #{osm,jdbcType=VARCHAR},
      YXXZBS = #{yxxzbs,jdbcType=DECIMAL},
      YXXZSM = #{yxxzsm,jdbcType=VARCHAR},
      SC_SQRBMID = #{scSqrbmid,jdbcType=VARCHAR},
      SC_SQRID = #{scSqrid,jdbcType=VARCHAR},
      SC_SQRZZH = #{scSqrzzh,jdbcType=VARCHAR},
      SC_SQRQ = #{scSqrq,jdbcType=TIMESTAMP},
      SC_PZRBMID = #{scPzrbmid,jdbcType=VARCHAR},
      SC_PZRID = #{scPzrid,jdbcType=VARCHAR},
      SC_PZRQ = #{scPzrq,jdbcType=TIMESTAMP},
      SC_PZYJ = #{scPzyj,jdbcType=VARCHAR},
      SC_PZCZSJ = #{scPzczsj,jdbcType=TIMESTAMP},
      ZC_SQRBMID = #{zcSqrbmid,jdbcType=VARCHAR},
      ZC_SQRID = #{zcSqrid,jdbcType=VARCHAR},
      ZC_SQRQ = #{zcSqrq,jdbcType=TIMESTAMP},
      ZC_BLYY = #{zcBlyy,jdbcType=VARCHAR},
      ZC_PZRBMID = #{zcPzrbmid,jdbcType=VARCHAR},
      ZC_PZRID = #{zcPzrid,jdbcType=VARCHAR},
      ZC_PZRQ = #{zcPzrq,jdbcType=TIMESTAMP},
      JFPZYJ = #{jfpzyj,jdbcType=VARCHAR},
      JFPZR = #{jfpzr,jdbcType=VARCHAR},
      JFPZRQ = #{jfpzrq,jdbcType=TIMESTAMP},
      GBRBMID = #{gbrbmid,jdbcType=VARCHAR},
      GBRID = #{gbrid,jdbcType=VARCHAR},
      GBCZSJ = #{gbczsj,jdbcType=TIMESTAMP},
      GBYY = #{gbyy,jdbcType=VARCHAR},
      GZZ = #{gzz,jdbcType=VARCHAR},
      GZRQ = #{gzrq,jdbcType=TIMESTAMP},
      JCZ = #{jcz,jdbcType=VARCHAR},
      JCRQ = #{jcrq,jdbcType=TIMESTAMP},
      GDID = #{gdid,jdbcType=VARCHAR},
      BJH = #{bjh,jdbcType=VARCHAR},
      XLH = #{xlh,jdbcType=VARCHAR},
      FXSJ = #{fxsj ,jdbcType=DECIMAL},
      FXXH = #{fxxh,jdbcType=DECIMAL},
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 根据id查询故障保留单详情 -->
  <select id="queryDetailById" resultMap="ResultMap" parameterType="java.lang.String" >
    select 
    	b1.id, b1.dprtcode, b1.whdwid, b1.whrid, b1.whsj, b1.zt, b1.zcblbs, b1.bldh, b1.fjzch, b1.zjh,
        b1.hz, b1.bs145, b1.blly, b1.bllyid, b1.bllx, b1.bllxsm, b1.sxgs_rs, b1.sxgs_xs, b1.blyj,
        b1.gzms, b1.blyy, b1.lscs, b1.mbs, b1.msm, b1.obs, b1.osm, b1.yxxzbs, b1.yxxzsm, b1.sc_sqrbmid,
        b1.sc_sqrid, b1.sc_sqrzzh, b1.sc_sqrq, b1.sc_blqx, b1.sc_pzrbmid, b1.sc_pzrid, b1.sc_pzrq,
        b1.sc_pzyj, b1.sc_pzczsj, b1.zc_sqrbmid, b1.zc_sqrid, b1.zc_sqrq, b1.zc_blqx, b1.zc_blyy,
        b1.zc_pzrbmid, b1.zc_pzrid, b1.zc_pzrq, b1.jfpzyj, b1.jfpzr, b1.jfpzrq, b1.gbrbmid, b1.gbrid,
        b1.gbczsj, b1.gbyy, b1.gzz, b1.gzrq, b1.jcz, b1.jcrq, b1.gdid, b1.bjh, b1.xlh, b1.fxsj, b1.fxxh,
        b2.id as jk_id, b2.jklbh as jk_jklbh, b2.jkflbh as jk_jkflbh, b2.jkz as jk_jkz, b2.jd as jk_jd, 
        b2.jkbs as jk_jkbs
    from B_S2_013 b1
    left join b_s2_01301 b2 on b1.id = b2.mainid and b2.jkbs = 1
    where b1.ID = #{id,jdbcType=VARCHAR}
  </select>
</mapper>