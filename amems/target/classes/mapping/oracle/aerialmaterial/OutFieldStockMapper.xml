<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eray.thjw.aerialmaterial.dao.OutFieldStockMapper">
  <resultMap id="BaseResultMap" type="com.eray.thjw.aerialmaterial.po.OutFieldStock">
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="XGDJID" jdbcType="VARCHAR" property="xgdjid" />
    <result column="KCID" jdbcType="VARCHAR" property="kcid" />
    <result column="DPRTCODE" jdbcType="VARCHAR" property="dprtcode" />
    <result column="SJLY" jdbcType="DECIMAL" property="sjly" />
    <result column="CKLB" jdbcType="DECIMAL" property="cklb" />
    <result column="CKID" jdbcType="VARCHAR" property="ckid" />
    <result column="CKH" jdbcType="VARCHAR" property="ckh" />
    <result column="CKMC" jdbcType="VARCHAR" property="ckmc" />
    <result column="KWID" jdbcType="VARCHAR" property="kwid" />
    <result column="KWH" jdbcType="VARCHAR" property="kwh" />
    <result column="BJID" jdbcType="VARCHAR" property="bjid" />
    <result column="BJH" jdbcType="VARCHAR" property="bjh" />
    <result column="PCH" jdbcType="VARCHAR" property="pch" />
    <result column="SN" jdbcType="VARCHAR" property="sn" />
    <result column="ZWMS" jdbcType="VARCHAR" property="zwms" />
    <result column="YWMS" jdbcType="VARCHAR" property="ywms" />
    <result column="JLDW" jdbcType="VARCHAR" property="jldw" />
    <result column="KCSL" jdbcType="DECIMAL" property="kcsl" />
    <result column="DJSL" jdbcType="DECIMAL" property="djsl" />
    <result column="CGHTID" jdbcType="VARCHAR" property="cghtid" />
    <result column="HTBH_CG" jdbcType="VARCHAR" property="htbhCg" />
    <result column="SXHTID" jdbcType="VARCHAR" property="sxhtid" />
    <result column="HTBH_SX" jdbcType="VARCHAR" property="htbhSx" />
    <result column="TDDID" jdbcType="VARCHAR" property="tddid" />
    <result column="TDDH" jdbcType="VARCHAR" property="tddh" />
    <result column="RKSJ" jdbcType="TIMESTAMP" property="rksj" />
    <result column="RKBMID" jdbcType="VARCHAR" property="rkbmid" />
    <result column="RKRID" jdbcType="VARCHAR" property="rkrid" />
    <result column="SHZH" jdbcType="VARCHAR" property="shzh" />
    <result column="SHZWZ" jdbcType="VARCHAR" property="shzwz" />
    <result column="ZT" jdbcType="DECIMAL" property="zt" />
    <result column="BZ" jdbcType="VARCHAR" property="bz" />
    <result column="JYDID" jdbcType="VARCHAR" property="jydid" />
    <result column="HJSM" jdbcType="TIMESTAMP" property="hjsm" />
    <result column="SPQX" jdbcType="TIMESTAMP" property="spqx" />
    <result column="SCRQ" jdbcType="TIMESTAMP" property="scrq" />
    <result column="XH" jdbcType="VARCHAR" property="xh" />
    <result column="GG" jdbcType="VARCHAR" property="gg" />
    <result column="GRN" jdbcType="VARCHAR" property="grn" />
    <result column="ZZCS" jdbcType="VARCHAR" property="zzcs" />
    <result column="TSN" jdbcType="VARCHAR" property="tsn" />
    <result column="TSO" jdbcType="VARCHAR" property="tso" />
    <result column="cSN" jdbcType="VARCHAR" property="csn" />
    <result column="cSO" jdbcType="VARCHAR" property="cso" />
    <result column="HCLY" jdbcType="VARCHAR" property="hcly" />
    <result column="CFYQ" jdbcType="VARCHAR" property="cfyq" />
    <result column="XKZH" jdbcType="VARCHAR" property="xkzh" />
    <result column="IS_DJ" jdbcType="DECIMAL" property="isDj" />
    <result column="KZLX" jdbcType="DECIMAL" property="kzlx" />
    <result column="LLKLX" jdbcType="DECIMAL" property="llklx" />
    <result column="LLKBH" jdbcType="VARCHAR" property="llkbh" />
    <result column="BJGZJL" jdbcType="VARCHAR" property="bjgzjl" />
    <result column="BIZ" jdbcType="VARCHAR" property="biz" />
    <result column="FJZCH" jdbcType="VARCHAR" property="fjzch" />
    <result column="CQID" jdbcType="VARCHAR" property="cqid" />
    <result column="SHDMXID" jdbcType="VARCHAR" property="shdmxid" />
    <result column="kccb" jdbcType="DECIMAL" property="kccb" />
    <result column="JZ" jdbcType="DECIMAL" property="jz" />
    <result column="JZBZ" jdbcType="VARCHAR" property="jzbz" />
    <result column="UUIDDM" jdbcType="VARCHAR" property="uuiddm" />
    <result column="QCZT" jdbcType="VARCHAR" property="qczt" />
    <result column="whsj" jdbcType="TIMESTAMP" property="whsj" />
    <result column="D1HCLX" property="paramsMap.d1hclx" jdbcType="VARCHAR" />
    <result column="CQBH" property="paramsMap.cqbh" jdbcType="VARCHAR" />
     <result column="CQID" property="paramsMap.cqid" jdbcType="VARCHAR" />
    <result column="CFJZCH" property="paramsMap.cfjzch" jdbcType="VARCHAR" />
    <result column="GSMC" property="paramsMap.gsmc" jdbcType="VARCHAR" />
    <result column="hclx" property="paramsMap.hclx" jdbcType="VARCHAR" />
    <result column="min_kcl" property="paramsMap.min_kcl" jdbcType="VARCHAR" />
    <result column="max_kcl" property="paramsMap.max_kcl" jdbcType="VARCHAR" />
    <result column="xgrName" property="paramsMap.xgrName" jdbcType="VARCHAR" />
    <result column="sjrName" property="paramsMap.xgrName" jdbcType="VARCHAR" />
    <result column="gljb" property="paramsMap.gljb" jdbcType="VARCHAR" />
    <result column="cjjh" property="paramsMap.cjjh" jdbcType="VARCHAR" />
    <result column="hclx_ej" property="paramsMap.hclx_ej" jdbcType="VARCHAR" />
    
   	<association property="sjr" javaType="com.eray.thjw.po.User">  
        <id column="rkrid" property="id"/>  
        <result column="sjr_username" property="username"/>  
        <result column="sjr_realname" property="realname"/>  
    </association>  
  	<association property="xgr" javaType="com.eray.thjw.po.User">  
        <id column="whrid" property="id"/>  
        <result column="xgr_username" property="username"/>  
        <result column="xgr_realname" property="realname"/>  
    </association>  
	    
  </resultMap>
  
  <resultMap type="com.eray.thjw.aerialmaterial.po.OutFieldStock" id="OutFieldStockToMaterialMap" extends="BaseResultMap">  
       <association property="hcMainData" javaType="com.eray.thjw.aerialmaterial.po.HCMainData">  
       		<id column="HCID" property="id"/>  
	        <result column="ZJH" property="zjh" jdbcType="VARCHAR" />  
	        <result column="CJJH" property="cjjh" jdbcType="VARCHAR" />  
	        <result column="HCZWMS" property="zwms" jdbcType="VARCHAR" />  
	        <result column="HCYWMS" property="ywms" jdbcType="VARCHAR" />  
	        <result column="HCGG" property="gg" jdbcType="VARCHAR" />  
	        <result column="HCXH" property="xh" jdbcType="VARCHAR" />  
	        <result column="HCXINGH" property="xingh" jdbcType="VARCHAR" />  
	        <association property="fixChapter" javaType="com.eray.thjw.po.FixChapter">
		         <id column="FZJH" property="zjh"/>
		         <result column="FZWMS" property="zwms"/>
		         <result column="FYWMS" property="ywms"/>
		    </association>
	   </association>
   </resultMap> 
  
  <sql id="Base_Column_List">
    ID, XGDJID, KCID, DPRTCODE, SJLY, CKLB, CKID, CKH, CKMC, KWID, KWH, BJID, BJH, PCH, 
    SN, ZWMS, YWMS, JLDW, KCSL, CGHTID, HTBH_CG, SXHTID, HTBH_SX, TDDID, TDDH, RKSJ, 
    RKBMID, RKRID, SHZH, SHZWZ, ZT, BZ, JYDID, HJSM, SPQX, SCRQ, XH, GG,GRN,csn,cso, ZZCS, TSN, TSO, 
    HCLY, CFYQ,JZ,JZBZ
  </sql>
  
  <sql id="Base_Column_List1">
    t1.ID,t1.XGDJID,  t1.KCID,  t1.DPRTCODE,  t1.SJLY,  t1.CKLB,  t1.CKID,  t1.CKH,  t1.CKMC,  t1.KWID,  t1.KWH,  t1.BJID,  t1.BJH,  t1.PCH, 
     t1.SN,t1.ZWMS,  t1.YWMS, t1.JLDW,  t1.KCSL,  t1.CGHTID,  t1.HTBH_CG,  t1.SXHTID,  t1.HTBH_SX,  t1.TDDID,  t1.TDDH,  t1.RKSJ, 
     t1.RKBMID,t1.RKRID,  t1.SHZH,  t1.SHZWZ,  t1.ZT,  t1.BZ,  t1.JYDID,  t1.HJSM,  t1.SPQX,  t1.SCRQ,  t1.XH,  t1.GG,t1.GRN,t1.csn,t1.cso,  t1.ZZCS,  t1.TSN,  t1.TSO, 
     t1.HCLY,t1.CFYQ,t1.JZ,t1.JZBZ
  </sql>
  
  	<select id="queryAll" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock" resultMap="BaseResultMap">
	   select t1.ID,
       t1.XGDJID,
       t1.KCID,
       t1.DPRTCODE,
       t1.SJLY,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       t2.ZWMS,
       t2.YWMS,
       t2.JLDW,
       --(CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       t2.XINGH XH,
       t2.GG,
       --(CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       --(CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t2.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t1.qczt,
       t2.cjjh,
       t2.hclx,
       t2.hclx_ej,
       t2.gljb,
       nvl(t1.djsl,0) djsl,
       t1.fjzch,
       t3.CQBH,
       t3.FJZCH CFJZCH,
       t3.GSMC,
       t4.JZ,
       t4.JZBZ,
       t4.CBBZ biz,
       t4.CB kccb,
       xgr.username ||' '|| xgr.realname as xgrName,
       sjr.username ||' '|| sjr.realname as sjrName
  from b_h_003 t1
  left join d_008 t2
    on t1.bjid = t2.id
  left join d_026 t3
   	on t3.id = t1.cqid
  left join t_user xgr
  	on xgr.id = t1.whrid
  left join t_user sjr
  	on sjr.id = t1.rkrid
  left join b_h_032 t4 on t1.dprtcode=t4.dprtcode and COALESCE(t1.sn ,'-')=COALESCE(t4.xlh,'-') 
  						and COALESCE(t1.pch,'-')=COALESCE(t4.pch,'-') and t1.bjh=t4.bjh

 where 1=1
		<include refid="outfieldParam"></include>

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by bjh 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
	</select>
  
   <!-- 搜索参数 -->
	<sql id="outfieldParam">
         <if test="cqid != null and cqid != ''">
             and t1.cqid =  #{cqid}
         </if>
         <if test="paramsMap != null and paramsMap.hclx != null and paramsMap.hclx != ''">
            and t2.hclx in
    			 <foreach item="item" index="index" collection="paramsMap.hclx" open="(" separator="," close=")">  
         			#{item}  
    			 </foreach>  
      </if> 
       <if test="paramsMap != null and  paramsMap.hclx_ej != null and paramsMap.hclx_ej != ''">
             and t2.hclx_ej =  #{paramsMap.hclx_ej}
         </if>
        <if test="paramsMap != null and paramsMap.bj != null and paramsMap.bj != ''">
             and (UPPER(t1.bjh) like UPPER('%'||#{paramsMap.bj}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{paramsMap.bj}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{paramsMap.bj}||'%')
		     )         
         </if>
        <if test="paramsMap != null and paramsMap.pch != null and paramsMap.pch != ''">
             and (UPPER(t1.pch) like UPPER('%'||#{paramsMap.pch}||'%')
		     )         
         </if>
        <if test="paramsMap != null and paramsMap.xlh != null and paramsMap.xlh != ''">
             and (UPPER(t1.sn) like UPPER('%'||#{paramsMap.xlh}||'%')
		     )         
         </if>
        <if test="paramsMap != null and paramsMap.gg != null and paramsMap.gg != ''">
             and (UPPER(t2.xingh) like UPPER('%'||#{paramsMap.gg}||'%')
		    	or UPPER(t2.gg) like UPPER('%'||#{paramsMap.gg}||'%')
		     )         
         </if>
        <if test="paramsMap != null and paramsMap.cjjh != null and paramsMap.cjjh != ''">
             and (UPPER(t2.cjjh) like UPPER('%'||#{paramsMap.cjjh}||'%')
		     )         
         </if>
        <if test="paramsMap != null and paramsMap.zzcs != null and paramsMap.zzcs != ''">
             and (UPPER(t2.zzcs) like UPPER('%'||#{paramsMap.zzcs}||'%')
		     )         
         </if>
        <if test=" ckid != null and ckid != ''">
             and t1.ckid =  #{ckid}
         </if>
        <if test=" kwh != null and kwh != ''">
             and lower(t1.kwh) =  #{kwh}
         </if>
         <if test=" qczt != null and qczt != ''">
             and lower(t1.qczt) =  #{qczt}
         </if>
         <if test=" htbhCg != null and htbhCg != ''">
             and (UPPER(t1.HTBH_CG) like UPPER('%'||#{htbhCg}||'%')
		     ) 
         </if>
          <if test="paramsMap != null and paramsMap.wlly != null and paramsMap.wlly != ''">
             and t1.sjly =  #{paramsMap.wlly}
         </if>
        <if test="paramsMap != null and paramsMap.gljb != null and paramsMap.gljb != ''">
             and t2.gljb =  #{paramsMap.gljb}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
        <if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t1.sn) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t2.zwms) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t2.ywms) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t2.xingh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t2.gg) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t1.pch) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t2.zzcs) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(t1.grn) like UPPER('%'||#{paramsMap.keyword}||'%')
		     )             
		  </if>
		  
       <if test="id != null and id != '' " >   
            and  t1.id  = #{id,jdbcType=VARCHAR}
           </if>
	</sql>
  
  
  
   	<select id="queryAllPageList" resultMap="BaseResultMap">
	   select t1.ID,
       t1.XGDJID,
       t1.KCID,
       t1.DPRTCODE,
       t1.SJLY,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       t1.djsl
  from b_h_003 t1
  left join d_008 t2
    on t1.bjid = t2.id
 where t1.sjly = 2 and t1.zt&lt;&gt;4
		<include refid="FlightRecordParam"></include>

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by hjsm 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
	</select>
	
  <!-- 搜索参数 -->
	<sql id="FlightRecordParam">
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
		  
       <if test="id != null and id != '' " >   
            and  t1.id  = #{id,jdbcType=VARCHAR}
           </if>
	</sql>
  
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
  select t1.ID,
       t1.XGDJID,
       t1.KCID,
       t1.DPRTCODE,
       t1.SJLY,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t1.QCZT,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       t1.djsl,
       t1.uuiddm,
       t1.cqid,
       t1.shdmxid,
       t1.fjzch,
       t4.JZ,
       t4.JZBZ,
       t4.CBBZ biz,
       t4.CB kccb
  from b_h_003 t1
  left join d_008 t2
    on t1.bjid = t2.id
  left join b_h_032 t4 
    on t1.dprtcode=t4.dprtcode 
   and COALESCE(t1.sn ,'-')=COALESCE(t4.xlh,'-') 
   and COALESCE(t1.pch,'-')=COALESCE(t4.pch,'-') 
   and t1.bjh=t4.bjh
 where t1.ID = #{id,jdbcType=VARCHAR}
  </select>
  
    <select id="selectById" parameterType="java.lang.String" resultMap="BaseResultMap">
  select t1.ID,
       t1.XGDJID,
       t1.KCID,
       t1.DPRTCODE,
       t1.SJLY,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       t2.ZWMS,
       t2.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t1.qczt,
       t4.JZ,
       t4.JZBZ,
       t4.CBBZ biz,
       t4.CB kccb,
       t2.cjjh,
       t2.zzcs,
       t2.hclx,
       t2.gljb,
       t2.hclx_ej,
       nvl(t1.djsl,0),
       t3.cqbh,
       t3.id CQID,
       t2.MIN_KCL,
       t2.MAX_KCL,
       t1.whsj,
       t1.UUIDDM,
       t1.SHDMXID,
       sjr.realname sjr_realname,
       sjr.username sjr_username,
       xgr.realname xgr_realname,
       xgr.username xgr_username
  from b_h_003 t1
  left join d_008 t2
    on t1.bjid = t2.id
  left join D_026 t3 
  	on t1.cqid = t3.id
  left join b_h_032 t4 on t1.dprtcode=t4.dprtcode and COALESCE(t1.sn ,'-')=COALESCE(t4.xlh,'-') 
  						and COALESCE(t1.pch,'-')=COALESCE(t4.pch,'-') and t1.bjh=t4.bjh
  left join t_user sjr on t1.rkrid = sjr.id
  left join t_user xgr on t1.whrid = xgr.id
 where t1.ID = #{id,jdbcType=VARCHAR}
  </select>
  
    <select id="queryByKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select T1.ID,
       T1.XGDJID,
       T1.KCID,
       T1.DPRTCODE,
       T1.SJLY,
       T1.CKLB,
       T1.CKID,
       T1.CKH,
       T1.CKMC,
       T1.KWID,
       T1.KWH,
       T1.BJID,
       T1.BJH,
       T1.PCH,
       T1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       T1.KCSL,
       T1.CGHTID,
       T1.HTBH_CG,
       T1.SXHTID,
       T1.HTBH_SX,
       T1.TDDID,
       T1.TDDH,
       T1.RKSJ,
       T1.RKBMID,
       T1.RKRID,
       T1.SHZH,
       T1.SHZWZ,
       T1.ZT,
       T1.BZ,
       T1.JYDID,
       T1.HJSM,
       T1.SPQX,
       T1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       T1.GRN,
       T1.csn,
       T1.cso,
       T1.ZZCS,
       T1.TSN,
       T1.TSO,
       T1.HCLY,
       T1.CFYQ
  from B_H_003 T1 LEFT JOIN D_008 T2 ON T1.BJID = T2.ID
    where T1.XGDJID = #{id,jdbcType=VARCHAR}
  </select>
    <select id="queryByKeywc" parameterType="java.lang.String" resultMap="BaseResultMap">
    select T1.ID,
       T1.XGDJID,
       T1.KCID,
       T1.DPRTCODE,
       T1.SJLY,
       T1.CKLB,
       T1.CKID,
       T1.CKH,
       T1.CKMC,
       T1.KWID,
       T1.KWH,
       T1.BJID,
       T1.BJH,
       T1.PCH,
       T1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       T1.KCSL,
       T1.CGHTID,
       T1.HTBH_CG,
       T1.SXHTID,
       T1.HTBH_SX,
       T1.TDDID,
       T1.TDDH,
       T1.RKSJ,
       T1.RKBMID,
       T1.RKRID,
       T1.SHZH,
       T1.SHZWZ,
       T1.ZT,
       T1.BZ,
       T1.JYDID,
       T1.HJSM,
       T1.SPQX,
       T1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       T1.GRN,
       T1.csn,
       T1.cso,
       T1.ZZCS,
       T1.TSN,
       T1.TSO,
       T1.HCLY,
       T1.CFYQ,
       	t1.cqid,
       	t1.SHDMXID,
       	t1.UUIDDM
  from B_H_003 T1 LEFT JOIN D_008 T2 ON T1.BJID = T2.ID
    where T1.id = #{id,jdbcType=VARCHAR}
  </select>
    <select id="queryjydid" parameterType="java.lang.String" resultMap="BaseResultMap">
    select T1.ID,
       T1.XGDJID,
       T1.KCID,
       T1.DPRTCODE,
       T1.SJLY,
       T1.CKLB,
       T1.CKID,
       T1.CKH,
       T1.CKMC,
       T1.KWID,
       T1.KWH,
       T1.BJID,
       T1.BJH,
       T1.PCH,
       T1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       T1.KCSL,
       T1.CGHTID,
       T1.HTBH_CG,
       T1.SXHTID,
       T1.HTBH_SX,
       T1.TDDID,
       T1.TDDH,
       T1.RKSJ,
       T1.RKBMID,
       T1.RKRID,
       T1.SHZH,
       T1.SHZWZ,
       T1.ZT,
       T1.BZ,
       T1.JYDID,
       T1.HJSM,
       T1.SPQX,
       T1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       T1.GRN,
       T1.csn,
       T1.cso,
       T1.ZZCS,
       T1.TSN,
       T1.TSO,
       T1.HCLY,
       T1.CFYQ
  from B_H_003 T1 LEFT JOIN D_008 T2 ON T1.BJID = T2.ID
    where T1.jydid = #{id,jdbcType=VARCHAR}
  </select>
  
  
<!--     查询外场库存  梅志亮 -->
  <select id="queryById" parameterType="java.lang.String" resultMap="BaseResultMap">
    select T1.ID,
       T1.XGDJID,
       T1.KCID,
       T1.DPRTCODE,
       T1.SJLY,
       T1.CKLB,
       T1.CKID,
       T1.CKH,
       T1.CKMC,
       T1.KWID,
       T1.KWH,
       T1.BJID,
       T1.BJH,
       T1.PCH,
       T1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       T1.KCSL,
       T1.CGHTID,
       T1.HTBH_CG,
       T1.SXHTID,
       T1.HTBH_SX,
       T1.TDDID,
       T1.TDDH,
       T1.RKSJ,
       T1.RKBMID,
       T1.RKRID,
       T1.SHZH,
       T1.SHZWZ,
       T1.ZT,
       T1.BZ,
       T1.JYDID,
       T1.HJSM,
       T1.SPQX,
       T1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       T1.GRN,
       T1.csn,
       T1.cso,
       T1.ZZCS,
       T1.TSN,
       T1.TSO,
       T1.HCLY,
       T1.CFYQ
  from B_H_003 T1 LEFT JOIN D_008 T2 ON T1.BJID = T2.ID
    where T1.ID = #{id,jdbcType=VARCHAR}
  </select>
  
    <select id="queryByParamKey" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock" resultMap="BaseResultMap">
    select T1.ID,
       T1.XGDJID,
       T1.KCID,
       T1.DPRTCODE,
       T1.SJLY,
       T1.CKLB,
       T1.CKID,
       T1.CKH,
       T1.CKMC,
       T1.KWID,
       T1.KWH,
       T1.BJID,
       T1.BJH,
       T1.PCH,
       T1.SN,
       t1.ZWMS,
       t1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN t1.JLDW ELSE T2.JLDW END) JLDW,
       T1.KCSL,
       T1.CGHTID,
       T1.HTBH_CG,
       T1.SXHTID,
       T1.HTBH_SX,
       T1.TDDID,
       T1.TDDH,
       T1.RKSJ,
       T1.RKBMID,
       T1.RKRID,
       T1.SHZH,
       T1.SHZWZ,
       T1.ZT,
       T1.BZ,
       T1.JYDID,
       T1.HJSM,
       T1.SPQX,
       T1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN t1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN t1.GG ELSE T2.GG END) GG,
       T1.GRN,    
       T1.csn,    
       T1.cso,    
 	   T1.ZZCS,
       T1.TSN,
       T1.TSO,
       T1.HCLY,
       T1.CFYQ
  from B_H_003 T1 LEFT JOIN D_008 T2 ON T1.BJID = T2.ID
    where T1.XGDJID = #{xgdjid,jdbcType=VARCHAR} and T1.kcid=#{kcid,jdbcType=VARCHAR}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from B_H_003
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock">
    insert into B_H_003 (ID, XGDJID, KCID, 
      DPRTCODE, SJLY, CKLB, 
      CKID, CKH, CKMC, KWID, 
      KWH, BJID, BJH, PCH, 
      SN, ZWMS, YWMS, JLDW, 
      KCSL, CGHTID, HTBH_CG, 
      SXHTID, HTBH_SX, TDDID, 
      TDDH, RKSJ, RKBMID, 
      RKRID, SHZH, SHZWZ, 
      ZT, BZ, JYDID, HJSM, 
      SPQX, SCRQ, XH, 
      GG,GRN,csn,cso, ZZCS, TSN, TSO, 
      HCLY, CFYQ, KCCB, BIZ, CQID, FJZCH,whrid,whsj)
    values (#{id,jdbcType=VARCHAR}, #{xgdjid,jdbcType=VARCHAR}, #{kcid,jdbcType=VARCHAR}, 
      #{dprtcode,jdbcType=VARCHAR}, #{sjly,jdbcType=DECIMAL}, #{cklb,jdbcType=DECIMAL}, 
      #{ckid,jdbcType=VARCHAR}, #{ckh,jdbcType=VARCHAR}, #{ckmc,jdbcType=VARCHAR}, #{kwid,jdbcType=VARCHAR}, 
      #{kwh,jdbcType=VARCHAR}, #{bjid,jdbcType=VARCHAR}, #{bjh,jdbcType=VARCHAR}, #{pch,jdbcType=VARCHAR}, 
      #{sn,jdbcType=VARCHAR}, #{zwms,jdbcType=VARCHAR}, #{ywms,jdbcType=VARCHAR}, #{jldw,jdbcType=VARCHAR}, 
      #{kcsl,jdbcType=DECIMAL}, #{cghtid,jdbcType=VARCHAR}, #{htbhCg,jdbcType=VARCHAR}, 
      #{sxhtid,jdbcType=VARCHAR}, #{htbhSx,jdbcType=VARCHAR}, #{tddid,jdbcType=VARCHAR}, 
      #{tddh,jdbcType=VARCHAR}, #{rksj,jdbcType=TIMESTAMP}, #{rkbmid,jdbcType=VARCHAR}, 
      #{rkrid,jdbcType=VARCHAR}, #{shzh,jdbcType=VARCHAR}, #{shzwz,jdbcType=VARCHAR}, 
      #{zt,jdbcType=DECIMAL}, #{bz,jdbcType=VARCHAR}, #{jydid,jdbcType=VARCHAR}, #{hjsm,jdbcType=TIMESTAMP}, 
      #{spqx,jdbcType=TIMESTAMP}, #{scrq,jdbcType=TIMESTAMP}, #{xh,jdbcType=VARCHAR}, 
      #{gg,jdbcType=VARCHAR},  #{grn,jdbcType=VARCHAR}, #{csn,jdbcType=VARCHAR},#{cso,jdbcType=VARCHAR},#{zzcs,jdbcType=VARCHAR}, #{tsn,jdbcType=VARCHAR}, #{tso,jdbcType=VARCHAR}, 
      #{hcly,jdbcType=VARCHAR}, #{cfyq,jdbcType=VARCHAR}, #{kccb,jdbcType=DECIMAL},
      #{biz,jdbcType=VARCHAR}, #{cqid,jdbcType=VARCHAR}, #{fjzch,jdbcType=VARCHAR},  #{whrid,jdbcType=VARCHAR}, sysdate)
  </insert>
  <insert id="insertSelective" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock">
    insert into B_H_003
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        ID,
      </if>
      <if test="xgdjid != null">
        XGDJID,
      </if>
      <if test="kcid != null">
        KCID,
      </if>
      <if test="dprtcode != null">
        DPRTCODE,
      </if>
      <if test="sjly != null">
        SJLY,
      </if>
      <if test="cklb != null">
        CKLB,
      </if>
      <if test="ckid != null">
        CKID,
      </if>
      <if test="ckh != null">
        CKH,
      </if>
      <if test="ckmc != null">
        CKMC,
      </if>
      <if test="kwid != null">
        KWID,
      </if>
      <if test="kwh != null">
        KWH,
      </if>
      <if test="bjid != null">
        BJID,
      </if>
      <if test="bjh != null">
        BJH,
      </if>
      <if test="pch != null">
        PCH,
      </if>
      <if test="sn != null">
        SN,
      </if>
      <if test="zwms != null">
        ZWMS,
      </if>
      <if test="ywms != null">
        YWMS,
      </if>
      <if test="jldw != null">
        JLDW,
      </if>
      <if test="kcsl != null">
        KCSL,
      </if>
      <if test="cghtid != null">
        CGHTID,
      </if>
      <if test="htbhCg != null">
        HTBH_CG,
      </if>
      <if test="sxhtid != null">
        SXHTID,
      </if>
      <if test="htbhSx != null">
        HTBH_SX,
      </if>
      <if test="tddid != null">
        TDDID,
      </if>
      <if test="tddh != null">
        TDDH,
      </if>
      <if test="rksj != null">
        RKSJ,
      </if>
      <if test="rkbmid != null">
        RKBMID,
      </if>
      <if test="rkrid != null">
        RKRID,
      </if>
      <if test="shzh != null">
        SHZH,
      </if>
      <if test="shzwz != null">
        SHZWZ,
      </if>
      <if test="zt != null">
        ZT,
      </if>
      <if test="bz != null">
        BZ,
      </if>
      <if test="jydid != null">
        JYDID,
      </if>
      <if test="hjsm != null">
        HJSM,
      </if>
      <if test="spqx != null">
        SPQX,
      </if>
      <if test="scrq != null">
        SCRQ,
      </if>
      <if test="xh != null">
        XH,
      </if>
      <if test="gg != null">
        GG,
      </if>
      <if test="grn != null">
        GRN,
      </if>
      <if test="csn != null">
        csn,
      </if>
      <if test="cso != null">
        cso,
      </if>
      <if test="zzcs != null">
        ZZCS,
      </if>
      <if test="tsn != null">
        TSN,
      </if>
      <if test="tso != null">
        TSO,
      </if>
      <if test="hcly != null">
        HCLY,
      </if>
      <if test="cfyq != null">
        CFYQ,
      </if>
      <if test="xkzh != null">
        xkzh,
      </if>
      <if test="bjgzjl != null">
        bjgzjl,
      </if>
      <if test="llklx != null">
        llklx,
      </if>
      <if test="llkbh != null">
        llkbh,
      </if>
      <if test="kzlx != null">
        kzlx,
      </if>
      <if test="isDj != null">
        is_dj,
      </if>
      <if test="kccb != null">
        kccb,
      </if>
      <if test="jz != null">
        jz,
      </if>
      <if test="jzbz != null">
        jzbz,
      </if>
      <if test="whrid != null">
        whrid,
      </if>
      <if test="whsj != null">
        whsj,
      </if>
      <if test="shdmxid != null">
        shdmxid,
      </if>
      <if test="uuiddm != null">
        uuiddm,
      </if>
      <if test="cqid != null">
        cqid,
      </if>
      <if test="biz != null">
        biz,
      </if>
      <if test="qczt != null">
        qczt,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="xgdjid != null">
        #{xgdjid,jdbcType=VARCHAR},
      </if>
      <if test="kcid != null">
        #{kcid,jdbcType=VARCHAR},
      </if>
      <if test="dprtcode != null">
        #{dprtcode,jdbcType=VARCHAR},
      </if>
      <if test="sjly != null">
        #{sjly,jdbcType=DECIMAL},
      </if>
      <if test="cklb != null">
        #{cklb,jdbcType=DECIMAL},
      </if>
      <if test="ckid != null">
        #{ckid,jdbcType=VARCHAR},
      </if>
      <if test="ckh != null">
        #{ckh,jdbcType=VARCHAR},
      </if>
      <if test="ckmc != null">
        #{ckmc,jdbcType=VARCHAR},
      </if>
      <if test="kwid != null">
        #{kwid,jdbcType=VARCHAR},
      </if>
      <if test="kwh != null">
        #{kwh,jdbcType=VARCHAR},
      </if>
      <if test="bjid != null">
        #{bjid,jdbcType=VARCHAR},
      </if>
      <if test="bjh != null">
        #{bjh,jdbcType=VARCHAR},
      </if>
      <if test="pch != null">
        #{pch,jdbcType=VARCHAR},
      </if>
      <if test="sn != null">
        #{sn,jdbcType=VARCHAR},
      </if>
      <if test="zwms != null">
        #{zwms,jdbcType=VARCHAR},
      </if>
      <if test="ywms != null">
        #{ywms,jdbcType=VARCHAR},
      </if>
      <if test="jldw != null">
        #{jldw,jdbcType=VARCHAR},
      </if>
      <if test="kcsl != null">
        #{kcsl,jdbcType=DECIMAL},
      </if>
      <if test="cghtid != null">
        #{cghtid,jdbcType=VARCHAR},
      </if>
      <if test="htbhCg != null">
        #{htbhCg,jdbcType=VARCHAR},
      </if>
      <if test="sxhtid != null">
        #{sxhtid,jdbcType=VARCHAR},
      </if>
      <if test="htbhSx != null">
        #{htbhSx,jdbcType=VARCHAR},
      </if>
      <if test="tddid != null">
        #{tddid,jdbcType=VARCHAR},
      </if>
      <if test="tddh != null">
        #{tddh,jdbcType=VARCHAR},
      </if>
      <if test="rksj != null">
        #{rksj,jdbcType=TIMESTAMP},
      </if>
      <if test="rkbmid != null">
        #{rkbmid,jdbcType=VARCHAR},
      </if>
      <if test="rkrid != null">
        #{rkrid,jdbcType=VARCHAR},
      </if>
      <if test="shzh != null">
        #{shzh,jdbcType=VARCHAR},
      </if>
      <if test="shzwz != null">
        #{shzwz,jdbcType=VARCHAR},
      </if>
      <if test="zt != null">
        #{zt,jdbcType=DECIMAL},
      </if>
      <if test="bz != null">
        #{bz,jdbcType=VARCHAR},
      </if>
      <if test="jydid != null">
        #{jydid,jdbcType=VARCHAR},
      </if>
      <if test="hjsm != null">
        #{hjsm,jdbcType=TIMESTAMP},
      </if>
      <if test="spqx != null">
        #{spqx,jdbcType=TIMESTAMP},
      </if>
      <if test="scrq != null">
        #{scrq,jdbcType=TIMESTAMP},
      </if>
      <if test="xh != null">
        #{xh,jdbcType=VARCHAR},
      </if>
      <if test="gg != null">
        #{gg,jdbcType=VARCHAR},
      </if>
      <if test="grn != null">
        #{grn,jdbcType=VARCHAR},
      </if>
      <if test="csn != null">
        #{csn,jdbcType=VARCHAR},
      </if>
      <if test="cso != null">
        #{cso,jdbcType=VARCHAR},
      </if>
      <if test="zzcs != null">
        #{zzcs,jdbcType=VARCHAR},
      </if>
      <if test="tsn != null">
        #{tsn,jdbcType=VARCHAR},
      </if>
      <if test="tso != null">
        #{tso,jdbcType=VARCHAR},
      </if>
      <if test="hcly != null">
        #{hcly,jdbcType=VARCHAR},
      </if>
      <if test="cfyq != null">
        #{cfyq,jdbcType=VARCHAR},
      </if>
      <if test="xkzh != null">
        #{xkzh,jdbcType=VARCHAR},
      </if>
      <if test="bjgzjl != null">
        #{bjgzjl,jdbcType=VARCHAR},
      </if>
      <if test="llklx != null">
        #{llklx,jdbcType=VARCHAR},
      </if>
      <if test="llkbh != null">
        #{llkbh,jdbcType=VARCHAR},
      </if>
      <if test="kzlx != null">
        #{kzlx,jdbcType=VARCHAR},
      </if>
      <if test="isDj != null">
        #{isDj,jdbcType=VARCHAR},
      </if>
      <if test="kccb != null">
        #{kccb,jdbcType=DECIMAL},
      </if>
      <if test="jz != null">
        #{jz,jdbcType=DECIMAL},
      </if>
      <if test="jzbz != null">
        #{jzbz,jdbcType=VARCHAR},
      </if>
      <if test="whrid != null">
        #{whrid,jdbcType=VARCHAR},
      </if>
      <if test="whsj != null">
        #{whsj,jdbcType=TIMESTAMP},
      </if>
      <if test="shdmxid != null">
        #{shdmxid,jdbcType=VARCHAR},
      </if>
      <if test="uuiddm != null">
        #{uuiddm,jdbcType=VARCHAR},
      </if>
      <if test="cqid != null">
        #{cqid,jdbcType=VARCHAR},
      </if>
      <if test="biz != null">
        #{biz,jdbcType=VARCHAR},
      </if>
      <if test="qczt != null">
        #{qczt,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock">
    update B_H_003
    <set>
      <if test="xgdjid != null">
        XGDJID = #{xgdjid,jdbcType=VARCHAR},
      </if>
      <if test="kcid != null">
        KCID = #{kcid,jdbcType=VARCHAR},
      </if>
<!--       <if test="dprtcode != null"> -->
<!--         DPRTCODE = #{dprtcode,jdbcType=VARCHAR}, -->
<!--       </if> -->
      <if test="sjly != null">
        SJLY = #{sjly,jdbcType=DECIMAL},
      </if>
      <if test="cklb != null">
        CKLB = #{cklb,jdbcType=DECIMAL},
      </if>
      <if test="ckid != null">
        CKID = #{ckid,jdbcType=VARCHAR},
      </if>
      <if test="ckh != null">
        CKH = #{ckh,jdbcType=VARCHAR},
      </if>
      <if test="ckmc != null">
        CKMC = #{ckmc,jdbcType=VARCHAR},
      </if>
      <if test="kwid != null">
        KWID = #{kwid,jdbcType=VARCHAR},
      </if>
      <if test="kwh != null">
        KWH = #{kwh,jdbcType=VARCHAR},
      </if>
      <if test="bjid != null">
        BJID = #{bjid,jdbcType=VARCHAR},
      </if>
      <if test="bjh != null">
        BJH = #{bjh,jdbcType=VARCHAR},
      </if>
      <if test="pch != null">
        PCH = #{pch,jdbcType=VARCHAR},
      </if>
      <if test="sn != null">
        SN = #{sn,jdbcType=VARCHAR},
      </if>
      <if test="zwms != null">
        ZWMS = #{zwms,jdbcType=VARCHAR},
      </if>
      <if test="ywms != null">
        YWMS = #{ywms,jdbcType=VARCHAR},
      </if>
      <if test="jldw != null">
        JLDW = #{jldw,jdbcType=VARCHAR},
      </if>
      <if test="kcsl != null">
        KCSL = #{kcsl,jdbcType=DECIMAL},
      </if>
      <if test="cghtid != null">
        CGHTID = #{cghtid,jdbcType=VARCHAR},
      </if>
      <if test="htbhCg != null">
        HTBH_CG = #{htbhCg,jdbcType=VARCHAR},
      </if>
      <if test="sxhtid != null">
        SXHTID = #{sxhtid,jdbcType=VARCHAR},
      </if>
      <if test="htbhSx != null">
        HTBH_SX = #{htbhSx,jdbcType=VARCHAR},
      </if>
      <if test="tddid != null">
        TDDID = #{tddid,jdbcType=VARCHAR},
      </if>
      <if test="tddh != null">
        TDDH = #{tddh,jdbcType=VARCHAR},
      </if>
      <if test="rksj != null">
        RKSJ = #{rksj,jdbcType=TIMESTAMP},
      </if>
      <if test="rkbmid != null">
        RKBMID = #{rkbmid,jdbcType=VARCHAR},
      </if>
      <if test="rkrid != null">
        RKRID = #{rkrid,jdbcType=VARCHAR},
      </if>
      <if test="shzh != null">
        SHZH = #{shzh,jdbcType=VARCHAR},
      </if>
      <if test="shzwz != null">
        SHZWZ = #{shzwz,jdbcType=VARCHAR},
      </if>
      <if test="zt != null">
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
      <if test="bz != null">
        BZ = #{bz,jdbcType=VARCHAR},
      </if>
      <if test="jydid != null">
        JYDID = #{jydid,jdbcType=VARCHAR},
      </if>
      <if test="hjsm != null">
        HJSM = #{hjsm,jdbcType=TIMESTAMP},
      </if>
      <if test="spqx != null">
        SPQX = #{spqx,jdbcType=TIMESTAMP},
      </if>
      <if test="scrq != null">
        SCRQ = #{scrq,jdbcType=TIMESTAMP},
      </if>
      <if test="xh != null">
        XH = #{xh,jdbcType=VARCHAR},
      </if>
      <if test="gg != null">
        GG = #{gg,jdbcType=VARCHAR},
      </if>
      <if test="grn != null">
        GRN = #{grn,jdbcType=VARCHAR},
      </if>
      <if test="csn != null">
        csn = #{csn,jdbcType=VARCHAR},
      </if>
      <if test="cso != null">
        cso = #{cso,jdbcType=VARCHAR},
      </if>
      <if test="zzcs != null">
        ZZCS = #{zzcs,jdbcType=VARCHAR},
      </if>
      <if test="tsn != null">
        TSN = #{tsn,jdbcType=VARCHAR},
      </if>
      <if test="tso != null">
        TSO = #{tso,jdbcType=VARCHAR},
      </if>
      <if test="hcly != null">
        HCLY = #{hcly,jdbcType=VARCHAR},
      </if>
      <if test="cfyq != null">
        CFYQ = #{cfyq,jdbcType=VARCHAR},
      </if>
      <if test="xkzh != null">
        xkzh = #{xkzh,jdbcType=VARCHAR},
      </if>
      <if test="djsl != null">
        djsl = #{djsl,jdbcType=DECIMAL},
      </if>
      <if test="whsj != null">
        WHSJ = sysdate,
      </if>
      <if test="whrid != null">
        WHRID = #{whrid,jdbcType=VARCHAR},
      </if>
      <if test="kccb != null">
        KCCB = #{kccb,jdbcType=DECIMAL},
      </if>
      <if test="jz != null">
        jz = #{jz,jdbcType=DECIMAL},
      </if>
      <if test="jzbz != null">
        JZBZ = #{jzbz,jdbcType=VARCHAR},
      </if>
      <if test="biz != null">
        BIZ = #{biz,jdbcType=VARCHAR},
      </if>
      <if test="cqid != null">
        CQID = #{cqid,jdbcType=VARCHAR},
      </if>
      
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock">
    update B_H_003
    set XGDJID = #{xgdjid,jdbcType=VARCHAR},
      KCID = #{kcid,jdbcType=VARCHAR},
<!--       DPRTCODE = #{dprtcode,jdbcType=VARCHAR}, -->
      SJLY = #{sjly,jdbcType=DECIMAL},
      CKLB = #{cklb,jdbcType=DECIMAL},
      CKID = #{ckid,jdbcType=VARCHAR},
      CKH = #{ckh,jdbcType=VARCHAR},
      CKMC = #{ckmc,jdbcType=VARCHAR},
      KWID = #{kwid,jdbcType=VARCHAR},
      KWH = #{kwh,jdbcType=VARCHAR},
      BJID = #{bjid,jdbcType=VARCHAR},
      BJH = #{bjh,jdbcType=VARCHAR},
      PCH = #{pch,jdbcType=VARCHAR},
      SN = #{sn,jdbcType=VARCHAR},
      ZWMS = #{zwms,jdbcType=VARCHAR},
      YWMS = #{ywms,jdbcType=VARCHAR},
      JLDW = #{jldw,jdbcType=VARCHAR},
      KCSL = #{kcsl,jdbcType=DECIMAL},
      CGHTID = #{cghtid,jdbcType=VARCHAR},
      HTBH_CG = #{htbhCg,jdbcType=VARCHAR},
      SXHTID = #{sxhtid,jdbcType=VARCHAR},
      HTBH_SX = #{htbhSx,jdbcType=VARCHAR},
      TDDID = #{tddid,jdbcType=VARCHAR},
      TDDH = #{tddh,jdbcType=VARCHAR},
      RKSJ = #{rksj,jdbcType=TIMESTAMP},
      RKBMID = #{rkbmid,jdbcType=VARCHAR},
      RKRID = #{rkrid,jdbcType=VARCHAR},
      SHZH = #{shzh,jdbcType=VARCHAR},
      SHZWZ = #{shzwz,jdbcType=VARCHAR},
      ZT = #{zt,jdbcType=DECIMAL},
      BZ = #{bz,jdbcType=VARCHAR},
      JYDID = #{jydid,jdbcType=VARCHAR},
      HJSM = #{hjsm,jdbcType=TIMESTAMP},
      SPQX = #{spqx,jdbcType=TIMESTAMP},
      SCRQ = #{scrq,jdbcType=TIMESTAMP},
      XH = #{xh,jdbcType=VARCHAR},
      GG = #{gg,jdbcType=VARCHAR},
      GRN = #{grn,jdbcType=VARCHAR},
      csn = #{csn,jdbcType=VARCHAR},
      cso = #{cso,jdbcType=VARCHAR},
      ZZCS = #{zzcs,jdbcType=VARCHAR},
      TSN = #{tsn,jdbcType=VARCHAR},
      TSO = #{tso,jdbcType=VARCHAR},
      HCLY = #{hcly,jdbcType=VARCHAR},
      CFYQ = #{cfyq,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  
  <sql id="outFieldStockParam">
	   where 
	   1=1
         <!-- 机构id-->
	     <if test="dprtcode != null and dprtcode != ''">
            and  b1.dprtcode = #{dprtcode}
         </if>
         <if test="dprtcodes != null and dprtcodes.size > 0">
            and b1.dprtcode in 
            <foreach collection="dprtcodes" item="item" index="index" open="(" close=")" separator=",">
			#{item}
	   		</foreach>
         </if>
         <if test="dprtcodes != null and dprtcodes.size == 0">
            and 1=0
         </if>
         <if test="qczt != null and qczt != ''">
            and  b1.qczt = #{qczt}
         </if>
         <if test="notIds != null and notIds.size > 0">
            and b1.id not in 
            <foreach collection="notIds" item="item" index="index" open="(" close=")" separator=",">
			#{item}
	   		</foreach>
         </if>
         <if test="keyword != null and keyword != ''">
            and  (UPPER(b1.bjh) like UPPER('%'||#{keyword}||'%')  or
            	  UPPER(b1.sn) like UPPER('%'||#{keyword}||'%') or
            	  UPPER(b1.pch) like UPPER('%'||#{keyword}||'%') or
            	  UPPER(b1.zwms) like UPPER('%'||#{keyword}||'%') or
            	  UPPER(b1.ywms) like UPPER('%'||#{keyword}||'%')
            	)
         </if>
         <if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
            AND  (UPPER(B1.BJH) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
          	      UPPER(B1.SN) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
          	      UPPER(D1.ZWMS) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
          	      UPPER(D1.YWMS) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
          	      UPPER(D1.XINGH) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
          	      UPPER(D1.CJJH) LIKE UPPER('%'||#{paramsMap.keyword}||'%')
          	)
         </if>
         <if test="paramsMap != null and paramsMap.keywords != null and paramsMap.keywords.size > 0">
            <foreach collection="paramsMap.keywords" item="item" index="index">
            and  (UPPER(b1.bjh) like UPPER('%'||#{item}||'%')  or
            	  UPPER(b1.sn) like UPPER('%'||#{item}||'%') or
            	  UPPER(b1.pch) like UPPER('%'||#{item}||'%') or
            	  UPPER(b1.zwms) like UPPER('%'||#{item}||'%') or
            	  UPPER(b1.ywms) like UPPER('%'||#{item}||'%')
            	)
	   		</foreach>
         </if>
	</sql>
  
  <!-- 根据条件查询外场库存 -->
  <select id="queryByParam" parameterType="com.eray.thjw.aerialmaterial.po.OutFieldStock" resultMap="OutFieldStockToMaterialMap">
    SELECT B1.ID,
       B1.XGDJID,
       B1.KCID,
       B1.DPRTCODE,
       B1.SJLY,
       B1.CKLB,
       B1.CKID,
       B1.CKH,
       B1.CKMC,
       B1.KWID,
       B1.KWH,
       B1.BJID,
       B1.BJH,
       B1.PCH,
       B1.SN,
       (CASE WHEN D1.JLDW IS NULL THEN B1.JLDW ELSE D1.JLDW END) JLDW,
       B1.KCSL,
       B1.CGHTID,
       B1.HTBH_CG,
       B1.SXHTID,
       B1.HTBH_SX,
       B1.TDDID,
       B1.TDDH,
       B1.RKSJ,
       B1.RKBMID,
       B1.RKRID,
       B1.SHZH,
       B1.SHZWZ,
       B1.ZT,
       B1.BZ,
       B1.JYDID,
       B1.HJSM,
       B1.SPQX,
       B1.SCRQ,
       (CASE WHEN D1.XINGH IS NULL THEN B1.XH ELSE D1.XINGH END) XH,
       (CASE WHEN D1.GG IS NULL THEN B1.GG ELSE D1.GG END) GG,
       B1.GRN,
       B1.csn,
       B1.cso,
       B1.ZZCS,
       B1.TSN,
       B1.TSO,
       B1.HCLY,
       B1.CFYQ,
       B1.BJGZJL,
       B1.XKZH,
       B1.QCZT,
       D1.ID       HCID,
       D1.ZJH,
       D1.CJJH,
       D1.ZWMS     ZWMS,
       D1.YWMS     YWMS,
       D1.GG       HCGG,
       D1.XH       HCXH,
       D1.XINGH    HCXINGH,
       D1.HCLX D1HCLX,
       B1.LLKLX,
       B1.LLKBH,
       B1.KZLX,
       B1.IS_DJ,
       D2.ZJH      AS FZJH,
       D2.ZWMS     AS FZWMS,
       D2.YWMS     AS FYWMS
  FROM B_H_003 B1
 INNER JOIN D_008 D1
    ON B1.DPRTCODE = D1.DPRTCODE
   AND B1.BJH = D1.BJH
   AND D1.ZT = 1
  LEFT JOIN D_005 D2
    ON D1.ZJH = D2.ZJH
    AND D1.DPRTCODE = D2.DPRTCODE
    <include refid="outFieldStockParam" />
  ORDER BY B1.BJH, B1.SN, B1.PCH
  </select>
  	<update id="updateZTById" parameterType="String">
		update b_h_003 set zt=2 where id =#{id,jdbcType=VARCHAR}
	</update>
	<delete id="deleteOutFieldStockById" parameterType="String">
		delete from b_h_003 where id =#{id,jdbcType=VARCHAR}
	</delete>
	<insert id="insertOutFieldStockFromMaterialHistory" parameterType="String">
	insert into B_H_003 (ID, DPRTCODE, CKLB, SJLY,
	      CKID, CKH, CKMC, KWID, 
	      KWH, BJID, BJH, PCH, 
	      SN, ZWMS, YWMS, JLDW, 
	      KCSL, CGHTID, 
	      HTBH_CG, SXHTID, HTBH_SX, 
	      TDDID, TDDH, RKSJ, 
	      RKBMID, RKRID, XKZH, 
	      SHZH, SHZWZ, ZT, BZ, 
	      JYDID, HJSM, SPQX, 
	      SCRQ, XH, GG,GRN,csn,cso, ZZCS, 
	      TSN, TSO, HCLY, CFYQ, 
	      BJGZJL, LLKLX, LLKBH, 
	      KZLX, IS_DJ, KCCB,
	      BIZ, JZ, JZBZ, CQID, SHDMXID, UUIDDM,
	      WHRID,WHSJ,KCID,FJZCH,QCZT)
	    select KCID, DPRTCODE, CKLB, WCSJLY,
	      CKID, CKH, CKMC, KWID, 
	      KWH, BJID, BJH, PCH, 
	      SN, ZWMS, YWMS, JLDW, 
	      KCSL,  CGHTID, 
	      HTBH_CG, SXHTID, HTBH_SX, 
	      TDDID, TDDH, RKSJ, 
	      RKBMID, RKRID, XKZH, 
	      SHZH, SHZWZ, ZT, BZ, 
	      JYDID, HJSM, SPQX, 
	      SCRQ, XH, GG,GRN,csn,cso, ZZCS, 
	      TSN, TSO, HCLY, CFYQ, 
	      BJGZJL, LLKLX, LLKBH, 
	      KZLX, IS_DJ, KCCB,
	      BIZ, JZ, JZBZ, CQID, SHDMXID, UUIDDM,
	      #{0},sysdate,#{2},FJZCH,QCZT from b_h_017 where id=#{1}
	</insert>
	<select id="getOutFieldStockList" parameterType="String" resultMap="BaseResultMap">
		select ID, DPRTCODE, CKLB,CKID,CKH, CKMC, KWID,KWH, BJID, BJH,PCH,SN,KCSL, DJSL, CGHTID,
		       HTBH_CG,SXHTID, HTBH_SX, TDDID, TDDH,RKSJ,RKBMID,RKRID, SHZH,SHZWZ,ZT,BZ,JYDID,
		       HJSM,SPQX,SCRQ,ZZCS,TSN,TSO,HCLY,CFYQ,ZWMS,YWMS,XH
		       from b_h_003
		 where BJID=#{0} and dprtcode=#{1}
 		and sn is not null
	</select>
	
	<!-- 查询某一序列号、批次号件的库存 -->
	<select id="selectStockByComponent" resultMap="BaseResultMap">
		select ID, DPRTCODE, BJID, BJH, PCH, SN, KCSL, DJSL, KCCB, BIZ, CQID
		       from b_h_003
		 where KCSL > COALESCE(DJSL,0)  and dprtcode=#{dprtcode,jdbcType=VARCHAR} 
          <if test="xlh != null and xlh != ''">
			 and sn = #{xlh,jdbcType=VARCHAR} 
          </if>
		  <if test="xlh == null or xlh == ''">
			 and PCH = #{pch,jdbcType=VARCHAR}
          </if>	
		 	 and  BJH=#{bjh,jdbcType=VARCHAR}
	</select>
	<!-- 根据id更新库存数量 -->
	<update id="updateKcslById">
		update b_h_003 set kcsl = #{kcsl, jdbcType=DECIMAL} where id = #{id, jdbcType=VARCHAR}
	</update>
	<!-- 根据id增加库存数量 -->
	<update id="updateKcslAddById">
		update b_h_003 set kcsl = kcsl + #{kcsl, jdbcType=DECIMAL} where id = #{id, jdbcType=VARCHAR}
	</update>
	
	<insert id="insertFromHistory">
		insert into B_H_003 (ID, DPRTCODE, CKLB, SJLY,
		      CKID, CKH, CKMC, KWID, 
		      KWH, BJID, BJH, PCH, 
		      SN, ZWMS, YWMS, JLDW, 
		      KCSL, CGHTID, 
		      HTBH_CG, SXHTID, HTBH_SX, 
		      TDDID, TDDH, RKSJ, 
		      RKBMID, RKRID, XKZH, 
		      SHZH, SHZWZ, ZT, BZ, 
		      JYDID, HJSM, SPQX, 
		      SCRQ, XH, GG,GRN,csn,cso, ZZCS, 
		      TSN, TSO, HCLY, CFYQ, 
		      BJGZJL, LLKLX, LLKBH, 
		      KZLX, IS_DJ, KCCB,WHRID,WHSJ)
		    select KCID, DPRTCODE, CKLB, 2,
		      CKID, CKH, CKMC, KWID, 
		      KWH, BJID, BJH, PCH, 
		      SN, ZWMS, YWMS, JLDW, 
		      #{kcsl, jdbcType=DECIMAL},  CGHTID, 
		      HTBH_CG, SXHTID, HTBH_SX, 
		      TDDID, TDDH, RKSJ, 
		      RKBMID, RKRID, XKZH, 
		      SHZH, SHZWZ, 2, BZ, 
		      JYDID, HJSM, SPQX, 
		      SCRQ, XH, GG,GRN,csn,cso, ZZCS, 
		      TSN, TSO, HCLY, CFYQ, 
		      BJGZJL, LLKLX, LLKBH, 
		      KZLX, IS_DJ, KCCB,#{userId, jdbcType=VARCHAR },sysdate from b_h_017 where id=#{id, jdbcType=VARCHAR}
	</insert>
</mapper>