<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.eray.thjw.aerialmaterial.dao.StockMapper" >
  <resultMap id="BaseResultMap" type="com.eray.thjw.aerialmaterial.po.Stock" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="DPRTCODE" property="dprtcode" jdbcType="VARCHAR" />
    <result column="CKLB" property="cklb" jdbcType="INTEGER" />
    <result column="CKID" property="ckid" jdbcType="VARCHAR" />
    <result column="CKH" property="ckh" jdbcType="VARCHAR" />
    <result column="CKMC" property="ckmc" jdbcType="VARCHAR" />
    <result column="KWID" property="kwid" jdbcType="VARCHAR" />
    <result column="KWH" property="kwh" jdbcType="VARCHAR" />
     <result column="WHSJ" property="whsj" jdbcType="TIMESTAMP" />
    <result column="WHRID" property="whrid" jdbcType="VARCHAR" />
    <result column="BJID" property="bjid" jdbcType="VARCHAR" />
    <result column="BJH" property="bjh" jdbcType="VARCHAR" />
    <result column="PCH" property="pch" jdbcType="VARCHAR" />
    <result column="SN" property="sn" jdbcType="VARCHAR" />
    <result column="ZWMS" property="zwms" jdbcType="VARCHAR" />
    <result column="YWMS" property="ywms" jdbcType="VARCHAR" />
    <result column="JLDW" property="jldw" jdbcType="VARCHAR" />
    <result column="KCSL" property="kcsl" jdbcType="DECIMAL" />
    <result column="DJSL" property="djsl" jdbcType="DECIMAL" />
    <result column="CGHTID" property="cghtid" jdbcType="VARCHAR" />
    <result column="HTBH_CG" property="htbhCg" jdbcType="VARCHAR" />
    <result column="SXHTID" property="sxhtid" jdbcType="VARCHAR" />
    <result column="HTBH_SX" property="htbhSx" jdbcType="VARCHAR" />
    <result column="TDDID" property="tddid" jdbcType="VARCHAR" />
    <result column="TDDH" property="tddh" jdbcType="VARCHAR" />
    <result column="RKSJ" property="rksj" jdbcType="TIMESTAMP" />
    <result column="RKBMID" property="rkbmid" jdbcType="VARCHAR" />
    <result column="RKRID" property="rkrid" jdbcType="VARCHAR" />
    <result column="XKZH" property="xkzh" jdbcType="VARCHAR" />
    <result column="SHZH" property="shzh" jdbcType="VARCHAR" />
    <result column="SHZWZ" property="shzwz" jdbcType="VARCHAR" />
    <result column="ZT" property="zt" jdbcType="INTEGER" />
    <result column="BZ" property="bz" jdbcType="VARCHAR" />
    <result column="JYDID" property="jydid" jdbcType="VARCHAR" />
    <result column="HJSM" property="hjsm" jdbcType="TIMESTAMP" />
    <result column="SPQX" property="spqx" jdbcType="TIMESTAMP" />
    <result column="SCRQ" property="scrq" jdbcType="TIMESTAMP" />
    <result column="XH" property="xh" jdbcType="VARCHAR" />
    <result column="GG" property="gg" jdbcType="VARCHAR" />
    <result column="ZZCS" property="zzcs" jdbcType="VARCHAR" />
    <result column="TSN" property="tsn" jdbcType="VARCHAR" />
    <result column="TSO" property="tso" jdbcType="VARCHAR" />
    <result column="CSN" property="csn" jdbcType="VARCHAR" />
    <result column="CSO" property="cso" jdbcType="VARCHAR" />
    <result column="HCLY" property="hcly" jdbcType="VARCHAR" />
    <result column="CFYQ" property="cfyq" jdbcType="VARCHAR" />
    <result column="bjgzjl" property="bjgzjl" jdbcType="VARCHAR" />
    <result column="llklx" property="llklx" jdbcType="VARCHAR" />
    <result column="llkbh" property="llkbh" jdbcType="VARCHAR" />
    <result column="kzlx" property="kzlx" jdbcType="VARCHAR" />
    <result column="is_dj" property="isDj" jdbcType="VARCHAR" />
    <result column="kccb" property="kccb" jdbcType="DECIMAL" />
    <result column="biz" property="biz" jdbcType="VARCHAR" />
    <result column="jz" property="jz" jdbcType="DECIMAL" />
    <result column="jzbz" property="jzbz" jdbcType="VARCHAR" />
    <result column="grn" property="grn" jdbcType="VARCHAR" />
    <result column="cqid" property="cqid" jdbcType="VARCHAR" />
    <result column="shdmxid" property="shdmxid" jdbcType="VARCHAR" />
    <result column="uuiddm" property="uuiddm" jdbcType="VARCHAR" />
    
    <result column="cjjh" property="cjjh" jdbcType="VARCHAR" />
    <result column="hclx" property="hclx" jdbcType="VARCHAR" />
    <result column="hclx_ej" property="hclxEj" jdbcType="VARCHAR" />
    <result column="gljb" property="gljb" jdbcType="VARCHAR" />
    <result column="syts" property="syts" jdbcType="VARCHAR" />
    <result column="sytss" property="sytss" jdbcType="VARCHAR" />
    <result column="cangkuzt" property="cangkuzt" jdbcType="VARCHAR" />
     <result column="kcly" property="kcly" jdbcType="VARCHAR" />
     <result column="qczt" property="qczt" jdbcType="VARCHAR" />
     <result column="dxtdsl" property="paramsMap.dxtdsl" jdbcType="DECIMAL" />
     <result column="tdjczs" property="paramsMap.tdjczs" jdbcType="DECIMAL" />
     <result column="KYSL" property="paramsMap.kysl" jdbcType="VARCHAR" /><!-- 可用数量-->
     <result column="cqbh" property="paramsMap.cqbh" jdbcType="VARCHAR" /><!-- 产权编号-->
    <result column="CFJZCH" property="paramsMap.cfjzch" jdbcType="VARCHAR" />
    <result column="GSMC" property="paramsMap.gsmc" jdbcType="VARCHAR" />
    <result column="hclx" property="paramsMap.hclx" jdbcType="VARCHAR" />
     <association property="rkr_user" javaType="com.eray.thjw.po.User">
         <id column="rkrid" property="id"/>
         <result column="rkr_realname" property="realname"/>
         <result column="rkr_username" property="username"/>
     </association>
     <association property="jg_dprt" javaType="com.eray.thjw.po.Department">
         <id column="dprtcode" property="id"/>
         <result column="jg_dprtname" property="dprtname"/>
     </association>
    
  </resultMap>
  
  <!-- 配置库存映射关系 注意：在写对应关系时,id字段需要重命名 -->
	<resultMap type="com.eray.thjw.aerialmaterial.po.Stock" id="StockJoinMap" extends="BaseResultMap">  
	  	<association property="hCMainData" javaType="com.eray.thjw.aerialmaterial.po.HCMainData">  
	        <id column="HID" property="id"/>  
	        <result column="HBJH" property="bjh"/>  
	        <result column="HZWMS" property="zwms"/> 
	        <result column="HYWMS" property="ywms"/> 
	        <result column="HJLDW" property="jldw"/> 
	        <result column="HCJJH" property="cjjh"/>  
	        <result column="HHCLX" property="hclx"/>  
	        <result column="HHCJZ" property="hcjz"/>  
	        <result column="HHCLX_EJ" property="hclxEj"/>
	        <result column="FZJH" property="fixChapter.zjh"/>
	        <result column="FZWMS" property="fixChapter.zwms"/>  
	        <result column="FYWMS" property="fixChapter.ywms"/>  
	    </association>  
	</resultMap> 
	
	<resultMap type="com.eray.thjw.aerialmaterial.po.Stock" id="StockToolMap" extends="BaseResultMap">  
	        <result column="BORROWSTATUS_TEXT" property="borrowStatusText"/>
	        <result column="BORROWSTATUS" property="borrowStatus"/>    
	        <result column="POSITIONS" property="position"/>
	        <result column="BRROW_ID" property="brrowId"/>
	        <result column="DPRTNAME" property="dprtname"/>    
	        <result column="SYZT" property="syzt"/>    
	</resultMap> 
	
	<!-- 航材入库上架 -->
	<resultMap type="com.eray.thjw.aerialmaterial.po.Stock" id="StockReceiptMap" extends="BaseResultMap">  
		<association property="hCMainData" javaType="com.eray.thjw.aerialmaterial.po.HCMainData">  
	        <id column="HID" property="id"/>  
	        <result column="HBJH" property="bjh"/>  
	        <result column="HZWMS" property="zwms"/> 
	        <result column="HYWMS" property="ywms"/> 
	        <result column="HHCLX" property="hclx"/>  
	        <result column="HHCLX_EJ" property="hclxEj"/>
	    </association>  
        <association property="receipt" javaType="com.eray.thjw.material2.po.OutinReceipt">  
	        <id column="SHD_ID" property="id" jdbcType="VARCHAR" />
		    <result column="SHD_SHLX" property="shlx" jdbcType="DECIMAL" />
		    <result column="SHD_SHDH" property="shdh" jdbcType="VARCHAR" />
		    <result column="SHD_SHRID" property="shrid" jdbcType="VARCHAR" />
		    <result column="SHD_SHRQ" property="shrq" jdbcType="TIMESTAMP" />
		    <result column="SHD_LYDW" property="lydw" jdbcType="VARCHAR" />
		    <association property="shr" javaType="com.eray.thjw.po.User">  
		        <id column="SHRID" property="id"/>  
		        <result column="SHRUSERNAME" property="username"/>  
		        <result column="SHRREALNAME" property="realname"/>  
		    </association>  
	    </association> 
	    <association property="inspection" javaType="com.eray.thjw.aerialmaterial.po.Inspection">  
	        <id column="ZJD_ID" property="id" jdbcType="VARCHAR" />
		    <result column="ZJD_JYDH" property="jydh" jdbcType="VARCHAR" />
		    <result column="ZJD_JYRID" property="jyrid" jdbcType="VARCHAR" />
		    <result column="ZJD_JYRQ" property="jyrq" jdbcType="TIMESTAMP" />
		    <result column="ZJD_ZT" property="zt" jdbcType="INTEGER"  />
	        <association property="jyr" javaType="com.eray.thjw.po.User">
	    		<result column="JYRUSERNAME" jdbcType="VARCHAR" property="username" />
				<result column="JYRREALNAME" jdbcType="VARCHAR" property="realname" />
			</association>
	    </association>     
	</resultMap> 
  
  <sql id="Base_Column_List" >
    t1.ID, t1.DPRTCODE, t1.CKLB, t1.CKID, t1.CKH, t1.CKMC, t1.KWID, t1.KWH, t1.BJID, t1.BJH, t1.PCH, t1.SN, t1.ZWMS, t1.YWMS, t1.JLDW, 
    t1.KCSL, t1.DJSL, t1.CGHTID, t1.HTBH_CG, t1.SXHTID, t1.HTBH_SX, t1.TDDID, t1.TDDH, t1.RKSJ, t1.RKBMID, t1.RKRID, t1.SHZH, 
    t1.SHZWZ, t1.ZT,t1.BZ, t1.JYDID, t1.HJSM, t1.SPQX, t1.SCRQ, t1.XH, t1.GG,t1.GRN,t1.csn,t1.cso, t1.ZZCS, t1.TSN, t1.TSO, t1.HCLY, t1.CFYQ,t2.cjjh,t2.hclx,t2.gljb,ceil(t1.hjsm-sysdate) syts
  </sql>
  
    <sql id="Base_Column_Listin" >
    t1.ID, t1.DPRTCODE, t1.CKLB, t1.CKID, t1.CKH, t1.CKMC, t1.KWID, t1.KWH, t1.BJID, t1.BJH, t1.PCH, t1.SN, t1.ZWMS, t1.YWMS, t1.JLDW, 
    t1.KCSL, t1.CGHTID, t1.HTBH_CG, t1.SXHTID, t1.HTBH_SX, t1.TDDID, t1.TDDH, t1.RKSJ, t1.RKBMID, t1.RKRID, t1.SHZH, 
    t1.SHZWZ, t1.ZT,t1.BZ, t1.JYDID, t1.HJSM, t1.SPQX, t1.SCRQ, t1.XH, t1.GG,t1.GRN,t1.csn,t1.cso t1.ZZCS, t1.TSN, t1.TSO, t1.HCLY, t1.CFYQ,t2.cjjh,t2.hclx,t2.gljb,ceil(t1.hjsm-sysdate) syts
  </sql>
  
  <!-- 搜索参数 -->
	<sql id="Material_Repair_Param">
		<!--id-->
		<if test="id != null and id != ''">
			and B001.ID = #{id}
		</if>
		<if test="keyword != null and keyword != ''">
		    and (UPPER(B001.BJH) like CONCAT(UPPER(#{keyword}),'%')
		    	or UPPER(D008.CJJH) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(B001.ZWMS) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(B001.YWMS) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(B001.SN) like UPPER('%'||#{keyword}||'%')
		    )
		</if>
		<if test="dprtcode != null">
		    and B001.DPRTCODE = #{dprtcode}
		</if>
	</sql>
	
	
	<!-- 搜索参数 -->
	<sql id="Stock_Tool_Param">
		 <if test="keyword != null and keyword != ''">
		      and (UPPER(B001.BJH) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(B001.ID) = UPPER(#{keyword})
		    	or UPPER(D008.ZWMS) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(D008.YWMS) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(B001.SN) like UPPER('%'||#{keyword}||'%')
		     )             
		 </if>
		 
		<if test="paramsMap != null and paramsMap.status != null and paramsMap.status != ''">
        	and (CASE WHEN BW002.ZT IS NULL THEN 3 ELSE BW002.ZT END) =  #{paramsMap.status, jdbcType=VARCHAR}
     	</if> 
     	
     	<if test="paramsMap != null and paramsMap.inStatus != null ">
        	and BW002.ZT in  
        	<foreach item="item" index="index" collection="paramsMap.inStatus" open="("  
      		 separator="," close=")">  
       			#{item}  
  			 </foreach>
     	</if> 
     	
     	
     	<if test="paramsMap != null and paramsMap.dprtcode != null and paramsMap.dprtcode != ''">
        	and B001.DPRTCODE =  #{paramsMap.dprtcode, jdbcType=VARCHAR}
     	</if> 
     	
     	<if test="paramsMap != null and paramsMap.kcid != null and paramsMap.kcid != ''">
        	and B001.ID =  #{paramsMap.kcid, jdbcType=VARCHAR}
     	</if> 
     	
     	
	</sql>
	
  <!-- 根据条件分页查询送修航材列表(弹窗需要的数据) -->
	<select id="queryRepairStockList" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultMap="StockJoinMap">
	
		select B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       D008.JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       B001.CGHTID,
		       B001.HTBH_CG,
		       B001.SXHTID,
		       B001.HTBH_SX,
		       B001.TDDID,
		       B001.TDDH,
		       B001.RKSJ,
		       B001.RKBMID,
		       B001.RKRID,
		       B001.SHZH,
		       B001.SHZWZ,
		       B001.ZT,
		       B001.BZ,
		       B001.JYDID,
		       B001.HJSM,
		       B001.SPQX,
		       B001.SCRQ,
		       (CASE WHEN D008.XINGH IS NULL THEN B001.XH ELSE D008.XINGH END) XH,
		       (CASE WHEN D008.GG IS NULL THEN B001.GG ELSE D008.GG END) GG,
		       B001.GRN,
		       B001.csn,
		       B001.cso,
		       B001.ZZCS,
		       B001.TSN,
		       B001.TSO,
		       B001.HCLY,
		       B001.CFYQ,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.ZWMS     AS HZWMS,
		       D008.YWMS     AS HYWMS,
		       D008.JLDW     AS HJLDW,
		       D008.CJJH     AS HCJJH,
		       D008.HCLX     AS HHCLX,
		       D008.HCLX_EJ  AS HHCLX_EJ,
		       D005.ZJH      AS FZJH,
		       D005.ZWMS     AS FZWMS,
		       D005.YWMS     AS FYWMS
		  from B_H_001 B001
		  left join D_008 D008
		    on B001.BJID = D008.ID
		  left join D_005 D005
		    on D008.ZJH = D005.ZJH
		   and D008.DPRTCODE = D005.DPRTCODE

   		
           where B001.CKLB = 3 AND B001.SN IS NOT NULL AND B001.ZT = 2
           	<include refid="Material_Repair_Param"></include>
           <!-- order by ID asc -->
	  	<choose><!--  进行排序判断，如果默认就是默认字段排序 -->
	    	<when test='pagination.sort == "auto"'>                       
	    		order by B001.ID ${pagination.order}
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
		</choose>
     		
		
	</select>
	
	<select id="selectById" parameterType="String" resultMap="StockJoinMap">
		select	
		     	B001.cqid,
       	B001.SHDMXID,
       	B001.UUIDDM,
		 B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       (CASE WHEN D008.JLDW IS NULL THEN B001.JLDW ELSE D008.JLDW END) JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       B001.CGHTID,
		       B001.HTBH_CG,
		       B001.SXHTID,
		       B001.HTBH_SX,
		       B001.TDDID,
		       B001.TDDH,
		       B001.RKSJ,
		       B001.RKBMID,
		       B001.RKRID,
		       B001.SHZH,
		       B001.SHZWZ,
		       B001.ZT,
		       B001.BZ,
		       B001.JYDID,
		       B001.HJSM,
		       B001.SPQX,
		       B001.SCRQ,
		       B001.KCCB,
		       B001.BIZ,
		       B001.JZ,
		       B001.JZBZ,
		       B001.grn,
		       B001.csn,
		       B001.cso,
		       (CASE WHEN D008.XINGH IS NULL THEN B001.XH ELSE D008.XINGH END) XH,
		       (CASE WHEN D008.GG IS NULL THEN B001.GG ELSE D008.GG END) GG,
		       B001.ZZCS,
		       B001.TSN,
		       B001.TSO,
		       B001.HCLY,
		       B001.CFYQ,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.ZWMS     AS HZWMS,
		       D008.YWMS     AS HYWMS,
		       D008.JLDW     AS HJLDW,
		       D008.CJJH     AS HCJJH,
		       D008.HCLX     AS HHCLX,
		       D008.HCLX_EJ  AS HHCLX_EJ
		  from B_H_001 B001
		  left join D_008 D008
		    on B001.BJID = D008.ID

           where B001.ID = #{id}
		
	</select>
	
    <!-- 根据条件分页查询设备，工具航材列表 -->
	<select id="queryList4Tool" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultMap="StockToolMap">
	
		  SELECT B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       (CASE WHEN D008.JLDW IS NULL THEN B001.JLDW ELSE D008.JLDW END) JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       B001.CGHTID,
		       B001.HTBH_CG,
		       B001.SXHTID,
		       B001.HTBH_SX,
		       B001.TDDID,
		       B001.TDDH,
		       B001.RKSJ,
		       B001.RKBMID,
		       B001.RKRID,
		       B001.XKZH,
		       B001.SHZH,
		       B001.SHZWZ,
		       B001.ZT,
		       B001.BZ,
		       B001.JYDID,
		       B001.HJSM,
		       B001.SPQX,
		       B001.SCRQ,
		       (CASE WHEN D008.XINGH IS NULL THEN B001.XH ELSE D008.XINGH END) XH,
		       (CASE WHEN D008.GG IS NULL THEN B001.GG ELSE D008.GG END) GG,
		       B001.ZZCS,
		       B001.TSN,
		       B001.TSO,
		       B001.HCLY,
		       B001.CFYQ,
		       B001.BJGZJL,
		       B001.LLKLX,
		       B001.LLKBH,
		       B001.KZLX,
		       B001.IS_DJ,
		       B001.KCCB,
		       B001.GRN,
		       B001.csn,
		       B001.cso,
		       D008.HCLX,
		       BW002.ZT SYZT,
		       CASE
		         WHEN BW002.ZT = 1 THEN
		          '申请'
		         WHEN BW002.ZT = 2 THEN
		          '借用'
		         WHEN BW002.ZT = 3 THEN
		          '空闲'
		         WHEN BW002.ZT = 9 THEN
		          '指定结束'
		         WHEN BW002.ZT = 10 THEN
		          '完成'
		         ELSE
		          '空闲'
		       END BORROWSTATUS_TEXT,
		       (CASE WHEN BW002.ZT IS NULL THEN 3 ELSE BW002.ZT END) BORROWSTATUS,
		       CASE
		         WHEN BW002.ZT = 1 OR BW002.ZT = 2 THEN
		          (select t_user.username || ' ' || t_user.realname
		             from t_user
		            where t_user.id = BW002.JY_ZRRID)
		         ELSE
		          B001.CKMC || ' ' || B001.KWH
		       END POSITIONS,
		       BW002.ID BRROW_ID,
		       DEPT.DPRTNAME
		  FROM B_H_001 B001
		  LEFT JOIN D_008 D008
		    ON B001.BJID = D008.ID
		  LEFT JOIN B_W_002 BW002
		    ON B001.ID = BW002.KCID
		   AND BW002.ZT IN (1, 2)
		  LEFT JOIN T_DEPARTMENT DEPT
		    ON B001.DPRTCODE = DEPT.ID
		
		 WHERE D008.HCLX IN (2, 3) and B001.CKLB IN (0,4,5,6,7,8)

				 
			  <include refid="Stock_Tool_Param"></include>
			 
            <!-- order by ID asc 进行排序判断，如果默认就是默认字段排序-->
		  	   <choose> 
		    	<when test='pagination.sort == "auto"'>                       
		    		order by B001.ID ${pagination.order}
		    	</when>
		    	<otherwise>
				    order by ${pagination.sort} ${pagination.order}
		    	</otherwise>
			</choose>   
    
	</select>
   
 	<select id="queryAllPageList" resultMap="BaseResultMap">
	select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t3.ckmc,
	       t1.KWID,
	       t4.kwh,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       t1.whsj,
	       t1.whrid,
	       T1.YWMS,
	       T2.JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       (userName || ' ' || realName) RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts,
	       ceil(t1.SPQX - sysdate) sytss,
	       t6.tdjczs,
       	   t6.kcsl dxtdsl
      from b_h_001 t1
      left join d_008 t2
        on t1.bjid = t2.id
        left join d_009 t3 on t1.ckid=t3.id
         left join d_00901 t4 on t1.kwid=t4.id
        LEFT JOIN t_user t5
    	ON t5. ID = t1.RKRID
  		left join (select d017.dprtcode,
                    d017.bjh,
                    count(d017.bs) tdjczs,
                    sum(h001.kcsl) kcsl,
                    sum(h001.kykcsl) kykcsl
               from (select d_017.dprtcode, d_017.bjh, d_017.tdjh, 1 bs
                       from d_017
                      where d_017.zt = 1
                     union
                     select d_017.dprtcode,
                            d_017.tdjh     bjh,
                            d_017.bjh      tdjh,
                            1              bs
                       from d_017
                      where d_017.knxbs = 2
                        and d_017.zt = 1) d017
               left join (select b_h_001.dprtcode,
                                b_h_001.bjh,
                                sum(b_h_001.kcsl) kcsl,
                                sum(b_h_001.kcsl - (CASE WHEN b_h_001.djsl IS NULL THEN 0 ELSE b_h_001.djsl END)) kykcsl
                           from b_h_001
                          where b_h_001.zt = 2
                          group by b_h_001.dprtcode, b_h_001.bjh) h001
                 on d017.dprtcode = h001.dprtcode
                and d017.tdjh = h001.bjh
              group by d017.dprtcode, d017.bjh) t6
    	on t1.dprtcode = t6.dprtcode
   		and t1.bjh = t6.bjh
     where 1=1

		<include refid="FlightRecordParam3"></include>

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by syts 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
	</select>
	
	<select id="queryOutinAllPageList" resultMap="BaseResultMap">
	select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t3.ckmc,
	       t1.KWID,
	       t4.kwh,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T2.ZWMS,
	       t1.whsj,
	       t1.whrid,
	       T2.YWMS,
	       T2.JLDW,
	       t2.gg,
	       t2.xingh xh,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       (userName || ' ' || realName) RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t2.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t1.qczt,
	       BH032.CB KCCB,
	       BH032.CBBZ BIZ,
	       BH032.JZ,
	       BH032.JZBZ,
	       t2.cjjh,
	       t2.hclx,
	       t2.hclx_ej,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts,
	       ceil(t1.SPQX - sysdate) sytss,
	       t6.tdjczs,
       	   t6.kcsl dxtdsl,
       	    b7.cqbh || ' '|| b7.fjzch ||' '|| b7.gsmc cqbh
      from b_h_001 t1
      left join d_008 t2
        on t1.bjid = t2.id
        left join d_009 t3 on t1.ckid=t3.id
         left join d_00901 t4 on t1.kwid=t4.id
        LEFT JOIN t_user t5
    	ON t5. ID = t1.RKRID
  		left join (select d017.dprtcode,
                    d017.bjh,
                    count(d017.bs) tdjczs,
                    sum(h001.kcsl) kcsl,
                    sum(h001.kykcsl) kykcsl
               from (select d_017.dprtcode, d_017.bjh, d_017.tdjh, 1 bs
                       from d_017
                      where d_017.zt = 1
                     union
                     select d_017.dprtcode,
                            d_017.tdjh     bjh,
                            d_017.bjh      tdjh,
                            1              bs
                       from d_017
                      where d_017.knxbs = 2
                        and d_017.zt = 1) d017
               left join (select b_h_001.dprtcode,
                                b_h_001.bjh,
                                sum(b_h_001.kcsl) kcsl,
                                sum(b_h_001.kcsl - (CASE WHEN b_h_001.djsl IS NULL THEN 0 ELSE b_h_001.djsl END)) kykcsl
                           from b_h_001
                          where b_h_001.zt = 2
                          group by b_h_001.dprtcode, b_h_001.bjh) h001
                 on d017.dprtcode = h001.dprtcode
                and d017.tdjh = h001.bjh
              group by d017.dprtcode, d017.bjh) t6
    	on t1.dprtcode = t6.dprtcode
   		and t1.bjh = t6.bjh
   		 left join d_026 b7 on t1.cqid=b7.id
   		left join b_h_032 BH032 
   		on t1.dprtcode = BH032.dprtcode 
   		and COALESCE(t1.sn, '-')=COALESCE(BH032.xlh,'-') 
   		and COALESCE(t1.pch,'-')=COALESCE(BH032.pch,'-') 
   		and t1.bjh = BH032.bjh
     where 1=1

		<include refid="FlightRecordParamOution"></include>

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by syts ,t1.id
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order},t1.id
			    	</otherwise>
		 	</choose>
	</select>
	
	
	 <!-- 搜索参数 -->
	<sql id="FlightRecordParamOution">
	     <if test="bjh != null and bjh != ''">
             and UPPER(t1.bjh) like UPPER('%'||#{bjh,jdbcType=VARCHAR}||'%')
         </if>
	     <if test="pch != null and pch != ''">
             and UPPER(t1.pch) like UPPER('%'||#{pch,jdbcType=VARCHAR}||'%')
         </if>
	     <if test="sn != null and sn != ''">
             and UPPER(t1.sn) like UPPER('%'||#{sn,jdbcType=VARCHAR}||'%')
         </if>
	     <if test="paramsMap.ggxh != null and paramsMap.ggxh != ''">
             and (UPPER(t2.gg) like UPPER('%'||#{paramsMap.ggxh,jdbcType=VARCHAR}||'%')
             or UPPER(t2.xingh) like UPPER('%'||#{paramsMap.ggxh,jdbcType=VARCHAR}||'%'))
         </if>
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="paramsMap != null and paramsMap.hclxEj != null and paramsMap.hclxEj != '' ">
		    AND t2.HCLX_EJ =  #{paramsMap.hclxEj}
	     </if>
         <if test="gljb != null and gljb != ''">
             and t2.gljb =  #{gljb}
         </if>
         <if test="ckid != null and ckid != ''">
             and t1.ckid =  #{ckid,jdbcType=VARCHAR}
         </if>
         <if test="cqid != null and cqid != ''">
             and t1.cqid =  #{cqid,jdbcType=VARCHAR}
         </if>
         <if test="kwid != null and kwid != ''">
             and t1.kwid =  #{kwid,jdbcType=VARCHAR}
         </if>
         <if test="grn != null and grn != ''">
              and UPPER(t1.grn) like UPPER('%'||#{grn,jdbcType=VARCHAR}||'%')
         </if>
         <if test="hcly != null and hcly != ''">
              and t1.hcly =  #{hcly,jdbcType=VARCHAR}
         </if>
         <if test="zzcs != null and zzcs != ''">
              and UPPER(t2.zzcs) like UPPER('%'||#{zzcs,jdbcType=VARCHAR}||'%')
         </if>
         <if test="cjjh != null and cjjh != ''">
              and UPPER(t2.cjjh) like UPPER('%'||#{cjjh,jdbcType=VARCHAR}||'%')
         </if>
	     <if test="id != null and id != ''">
             and t1.id =  #{id,jdbcType=VARCHAR}
         </if>
         <if test="paramsMap != null and paramsMap.idList != null and paramsMap.idList != '' ">
		    AND T1.ID IN 
		   	<foreach collection="paramsMap.idList" item="item" index="index" open="(" close=")" separator=",">
				#{item}
			</foreach>
	     </if>
	     <if test="paramsMap != null and paramsMap.hclxList != null and paramsMap.hclxList != '' ">
		    AND t2.HCLX IN 
		   	<foreach collection="paramsMap.hclxList" item="item" index="index" open="(" close=")" separator=",">
				#{item}
			</foreach>
	     </if>
	     <if test="paramsMap != null and paramsMap.ckidList != null and paramsMap.ckidList != '' ">
		    AND t1.CKID IN 
		   	<foreach collection="paramsMap.ckidList" item="item" index="index" open="(" close=")" separator=",">
				#{item}
			</foreach>
	     </if>
	     <if test="paramsMap.bs == 2 ">
	    	 AND T1.ID IS NULL
	    </if>
         <if test="zt != null and zt != ''">
             and t1.zt =  #{zt}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode,jdbcType=VARCHAR}
         </if>
         <if test="qczt != null and qczt != ''">
             and t1.qczt =  #{qczt,jdbcType=VARCHAR}
         </if>
         <if test="paramsMap != null and paramsMap.rksjrqBeginDate != null and paramsMap.rksjrqBeginDate != ''">
		     AND t1.rksj &gt;= TO_DATE(#{paramsMap.rksjrqBeginDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		 </if>
         <if test="paramsMap != null and paramsMap.rksjrqEndDate != null and paramsMap.rksjrqEndDate != ''">
		     AND t1.rksj &lt;= TO_DATE(#{paramsMap.rksjrqEndDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		 </if>
         <if test="paramsMap != null and  paramsMap.scrqrqBeginDate != null and  paramsMap.scrqrqBeginDate != ''">
		     AND t1.scrq &gt;= TO_DATE(#{paramsMap.scrqrqBeginDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		 </if>
         <if test="paramsMap != null and paramsMap.scrqrqEndDate != null and paramsMap.scrqrqEndDate != ''">
		     AND t1.scrq &lt;= TO_DATE(#{paramsMap.scrqrqEndDate, jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
		 </if>
         <if test="paramsMap!=null and paramsMap.codeList != null and paramsMap.codeList !='' ">
             and T1.ID  not in 
            <foreach collection="paramsMap.codeList" item="item" index="index" open="(" close=")" separator=",">
				#{item}
			</foreach>
        </if>
          <choose>
	         <when test="ckh != null and ckh != ''">
	             and t1.ckid =  #{ckh,jdbcType=VARCHAR}
	         </when>
	         <otherwise>  
	         	and t1.ckid <include refid="userStoreParam"></include>
             </otherwise> 
         </choose>
        
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t1.sn) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t2.zwms) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t2.ywms) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t2.xingh) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t1.pch) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t2.zzcs) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t1.cfyq) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t1.grn) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t1.bz) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t1.gg) like UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%')
		    	or UPPER(t2.id) like UPPER(#{keyword,jdbcType=VARCHAR})
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
	
	<select id="queryAllPageListWin" resultMap="BaseResultMap">
	select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t3.ckmc,
	       t1.KWID,
	       t4.kwh,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	          t1.whsj,
	       t1.whrid,
	       T1.YWMS,
	       T2.JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       (userName || ' ' || realName) RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts,
	       ceil(t1.SPQX - sysdate) sytss,
	       t6.tdjczs,
       	   t6.kcsl dxtdsl
      from b_h_001 t1
      left join d_008 t2
        on t1.bjid = t2.id
        left join d_009 t3 on t1.ckid=t3.id
         left join d_00901 t4 on t1.kwid=t4.id
       LEFT JOIN t_user t5
    	  ON t5. ID = t1.RKRID
  		  left join (select d017.dprtcode,
                    d017.bjh,
                    count(d017.bs) tdjczs,
                    sum(h001.kcsl) kcsl,
                    sum(h001.kykcsl) kykcsl
               from (select d_017.dprtcode, d_017.bjh, d_017.tdjh, 1 bs
                       from d_017
                      where d_017.zt = 1
                     union
                     select d_017.dprtcode,
                            d_017.tdjh     bjh,
                            d_017.bjh      tdjh,
                            1              bs
                       from d_017
                      where d_017.knxbs = 2
                        and d_017.zt = 1) d017
               left join (select b_h_001.dprtcode,
                                b_h_001.bjh,
                                sum(b_h_001.kcsl) kcsl,
                                sum(b_h_001.kcsl - (CASE WHEN b_h_001.djsl IS NULL THEN 0 ELSE b_h_001.djsl END)) kykcsl
                           from b_h_001
                          where b_h_001.zt = 2
                          group by b_h_001.dprtcode, b_h_001.bjh) h001
                 on d017.dprtcode = h001.dprtcode
                and d017.tdjh = h001.bjh
              group by d017.dprtcode, d017.bjh) t6
    on t1.dprtcode = t6.dprtcode
   and t1.bjh = t6.bjh
     where (t1.KCSL &gt; t1.DJSL or t1.DJSL is null) and t1.CKLB in (0,1,4,5,6,7,8)
     	and t1.zt=2
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.pch) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.sn) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.id) like UPPER(#{keyword})
		     )
		  </if>
		  <if test="paramsMap != null and paramsMap.idList != null and paramsMap.idList != ''">
		    and t1.ID not in
     			 <foreach item="item" index="index" collection="paramsMap.idList" open="(" separator="," close=")">  
          			#{item}  
     			 </foreach>  
		</if>
		  order by syts 
	</select>
	
	<select id="queryAllPageNormalList" resultMap="BaseResultMap">
           
	   select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts
	  from b_h_001 t1
	  left join d_008 t2
	    on t1.bjid = t2.id
	 where t1.cklb in (3,5, 6, 7, 8)
	   and t1.zt = 2

		<include refid="FlightRecordParam5"></include>

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by syts 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
		 	
	</select>
	<sql id="FlightRecordParam5">
	   
	     <if test="id != null and id != ''">
             and t1.id =  #{id}
         </if>
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="zt != null and zt != ''">
             and t1.zt =  #{zt}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
          <choose>
	         <when test="ckh != null and ckh != ''">
	             and t1.ckid =  #{ckh}
	         </when>
	         <otherwise>  
	         	and t1.ckid <include refid="userStoreParam"></include>
             </otherwise> 
         </choose>
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.BJH) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.id) like UPPER(#{keyword})
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
	
	<select id="queryAllPageNormalListkc" resultMap="BaseResultMap">
           
	   select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts
	  from b_h_001 t1
	  left join d_008 t2
	    on t1.bjid = t2.id
	 where t1.cklb in (0,4,5, 6, 7, 8)
	   and t1.zt = 2

		<include refid="FlightRecordParam3"></include>

	  	<choose>
	    	<when test='pagination.sort == "auto"'>
	    		 order by syts 
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
	 	</choose>
		 	
	</select>
	
	
		<select id="queryKeytuihuo" resultMap="BaseResultMap">
           
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       ceil(t1.hjsm - sysdate) syts
  from b_h_001 t1
  left join d_008 t2
    on t1.bjid = t2.id
 where  t1.zt = 2

		<include refid="FlightRecordParam"></include>
		 	
	</select>
	
	<select id="queryKey" resultMap="BaseResultMap">
           
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       ceil(t1.hjsm - sysdate) syts
  from b_h_001 t1
  left join d_008 t2
    on t1.bjid = t2.id
 where t1.cklb in (0,4,5, 6, 7, 8)
   and t1.zt = 2

		<include refid="FlightRecordParam"></include>
		 	
	</select>
	
	<select id="queryKeys" resultMap="BaseResultMap">
           
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       t1.xkzh,
       t1.zzcs,
       t1.bjgzjl,
       t1.llklx,
       t1.llkbh,
       t1.kzlx,
       t1.is_dj,
       t1.kccb,
       t1.grn,
       t1.csn,
       t1.cso,
       ceil(t1.hjsm - sysdate) syts
  from b_h_001 t1
  left join d_008 t2
    on t1.bjid = t2.id
 where t1.cklb in (5, 6, 7, 8)
   and t1.zt = 2

		<include refid="FlightRecordParam"></include>
		 	
	</select>
	
	<select id="queryKeys1" resultMap="BaseResultMap">
           
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       ceil(t1.hjsm - sysdate) syts
  from b_h_001 t1
  left join d_008 t2
    on t1.bjid = t2.id
	where 	1=1 <include refid="FlightRecordParam"></include>
		 	
	</select>
	
	
 	<select id="queryAllList" resultMap="BaseResultMap">
           
	   select t1.ID,
       t1.DPRTCODE,
       t3.CKLB,
       t1.CKID,
       t3.CKH,
       t3.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       ceil(t1.hjsm - sysdate) syts
  from b_h_001 t1
  left join d_008 t2
    on t1.bjid = t2.id
    left join d_009 t3 on t1.ckid=t3.id
 where t1.cklb in (5, 6, 7, 8) and t1.zt=2

		<include refid="FlightRecordParam2"></include>
			    		 order by t1.bjh desc
	</select>
 
  	<!-- 搜索参数 -->
	<sql id="FlightRecordParam2">
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
	</sql>
 	<!-- 修改库存表状态 -->
 	<update id="updateLocked" parameterType="String">
		update b_h_001 set
		ZT=#{zt,jdbcType=VARCHAR}
		where id=#{id, jdbcType=VARCHAR}
	</update>
 
 	<update id="update" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
		update b_h_001 set
		kcsl=#{kcsl,jdbcType=DECIMAL},
		whrid=#{whrid,jdbcType=VARCHAR},
		whsj=#{whsj,jdbcType=TIMESTAMP}
		where id=#{id,jdbcType=VARCHAR}
	</update>
 
	<delete id="delete" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
		delete from b_h_001
		where id=#{id}
	</delete>
 
 	<select id="queryCount" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultType="int">
		select count(*) from b_h_001 t1 left join d_008 t2 on t1.bjid = t2.id  where 1=1
	 <include refid="FlightRecordParam3"></include>
 	 </select>
 	 
 	<select id="queryCountckls" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultType="int">
		select count(*) from b_h_001 t1 left join d_008 t2 on t1.bjid = t2.id  where t1.zt=2
	 <include refid="FlightRecordParamls"></include>
 	 </select>
 	 
 	 <sql id="FlightRecordParamls">
	   
	     <if test="id != null and id != ''">
             and t1.id =  #{id}
         </if>
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
        
	</sql>
 	 
 	<select id="queryCountnum" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultType="int">
		select count(1) from b_h_001 
	 <include refid="FlightRecord"></include>
 	 </select>
 	  
 	<select id="queryCountnums" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultMap="StockToolMap">
		select t1.ID, t1.DPRTCODE, t1.CKLB, t1.CKID, t1.CKH, t1.CKMC, t1.KWID, t1.KWH, t1.BJID, t1.BJH, t1.PCH, t1.SN, t1.ZWMS, t1.YWMS, t1.JLDW, 
    t1.KCSL, t1.DJSL, t1.CGHTID, t1.HTBH_CG, t1.SXHTID, t1.HTBH_SX, t1.TDDID, t1.TDDH, t1.RKSJ, t1.RKBMID, t1.RKRID, t1.SHZH, 
    t1.SHZWZ, t1.ZT,t1.BZ, t1.JYDID, t1.HJSM, t1.SPQX, t1.SCRQ, t1.XH, t1.GG,t1.GRN,t1.csn,t1.cso, t1.ZZCS, t1.TSN, t1.TSO, t1.HCLY, t1.CFYQ from b_h_001 t1
	 <include refid="FlightRecords1"></include>
 	 </select>
 	  <!-- 搜索参数 -->
	<sql id="FlightRecords1">
         where 1=1
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
         <if test="sn != null and sn != ''">
             and t1.sn =  #{sn}
         </if>
         <if test="sn == null ">
             and t1.sn is null
         </if>
         <if test="pch != null and pch != ''">
             and t1.pch =  #{pch}
         </if>
         <if test="pch == null ">
             and t1.pch is null
         </if>
         <if test="kwh != null and kwh != ''">
              and t1.kwh = #{kwh,jdbcType=VARCHAR} 
         </if>
         <if test="ckh != null and ckh != ''">
              and t1.ckh = #{ckh,jdbcType=VARCHAR} 
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtCode =  #{dprtcode}
         </if>
	</sql>
 	 
 	 
 <!-- 搜索参数 -->
	<sql id="FlightRecord">
         where 1=1
         <if test="kwh != null and kwh != ''">
             and kwh =  #{kwh}
         </if>
         <if test="pch != null and pch != ''">
             and pch =  #{pch}
         </if>
         <if test="bjh != null and bjh != ''">
             and bjh =  #{bjh}
         </if>
         <if test="sn != null and sn != ''">
             and sn =  #{sn}
         </if>
	</sql>
 	 
 	 
 
 <!-- 搜索参数 -->
	<sql id="FlightRecordParam3">
	   
	     <if test="id != null and id != ''">
             and t1.id =  #{id}
         </if>
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="zt != null and zt != ''">
             and t1.zt =  #{zt}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
          <choose>
	         <when test="ckh != null and ckh != ''">
	             and t1.ckid =  #{ckh}
	         </when>
	         <otherwise>  
	         	and t1.ckid <include refid="userStoreParam"></include>
             </otherwise> 
         </choose>
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.pch) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.sn) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.grn) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.id) like UPPER(#{keyword})
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
 
 
 	<!-- 搜索参数 -->
	<sql id="FlightRecordParam">
	   
	     <if test="id != null and id != ''">
             and t1.id =  #{id}
         </if>
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
 
 <sql id="Base_Column_List1" >
    t1.ID, t1.DPRTCODE, t1.CKLB, t1.CKID, t1.CKH, t1.CKMC, t1.KWID, t1.KWH, t1.BJID, t1.BJH, t1.PCH, t1.SN, t1.ZWMS, t1.YWMS, t1.JLDW, 
    t1.KCSL, t1.DJSL, t1.CGHTID, t1.HTBH_CG, t1.SXHTID, t1.HTBH_SX, t1.TDDID, t1.TDDH, t1.RKSJ, t1.RKBMID, t1.RKRID, t1.SHZH, 
    t1.SHZWZ, t1.ZT,t1.BZ, t1.JYDID, t1.HJSM, t1.SPQX, t1.SCRQ, t1.XH, t1.GG, t1.ZZCS, t1.TSN, t1.TSO, t1.HCLY, t1.CFYQ, t1.bjgzjl, t1.llklx, t1.llkbh, t1.kzlx, t1.is_dj, t1.kccb,t1.grn,t1.csn,t1.cso
  </sql>
 
   <select id="queryList" resultMap="BaseResultMap" parameterType="com.eray.thjw.aerialmaterial.po.Stock" >
    
    select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T3.JLDW IS NULL THEN T1.JLDW ELSE T3.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T3.XINGH IS NULL THEN T1.XH ELSE T3.XINGH END) XH,
       (CASE WHEN T3.GG IS NULL THEN T1.GG ELSE T3.GG END) GG,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t1.bjgzjl,
       t1.llklx,
       t1.llkbh,
       t1.kzlx,
       t1.is_dj,
       t1.kccb,
       t1.csn,
       t1.cso,
       t1.grn
  from b_h_001 t1
  left join d_009 t2
    on t1.ckid = t2.id
  LEFT JOIN D_008 T3
    ON T1.BJID = T3.ID
 where t1.cklb in (5, 6, 7, 8)

    	 <include refid="base_list"></include>
  </select>
 
  	<!-- 搜索参数 -->
	<sql id="base_list">
	   
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="cangkuzt != null and cangkuzt != ''">
             and t2.zt =  #{cangkuzt}
         </if>
	</sql>
	
	<sql id="Base_Column_List2" >
	    t1.ID, t1.DPRTCODE, t1.CKLB, t1.CKID, t1.CKH, t1.CKMC, t1.KWID, t1.KWH, t1.BJID, t1.BJH, t1.PCH, t1.SN, t1.ZWMS, t1.YWMS, t1.JLDW, 
	    t1.KCSL, t1.DJSL, t1.CGHTID, t1.HTBH_CG, t1.SXHTID, t1.HTBH_SX, t1.TDDID, t1.TDDH, t1.RKSJ, t1.RKBMID, t1.RKRID,t1.XKZH, t1.SHZH, 
	    t1.SHZWZ, t1.ZT,t1.BZ, t1.JYDID, t1.HJSM, t1.SPQX, t1.SCRQ, t1.XH, t1.GG,t1.GRN,t1.csn,t1.cso, t1.ZZCS, t1.TSN, t1.TSO, t1.HCLY, t1.CFYQ
  	</sql>
	
	
	<select id="queryById" parameterType="java.lang.String" resultMap="BaseResultMap">
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.XKZH,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t1.QCZT,
       t2.GLJB,
       t2.JLDW,
       t1.cqid,
       t1.SHDMXID,
       t1.UUIDDM,
       t1.kccb,
       t1.biz,t1.jz,t1.jzbz,
       t1.whsj,t1.whrid
  from B_H_001 t1
  left join D_008 t2
    on t1.bjid = t2.id

	   where t1.ID = #{id,jdbcType=VARCHAR}
	</select>
	
	<select id="queryStockListByPdid" parameterType="java.lang.String" resultMap="BaseResultMap">
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.XKZH,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.GLJB
  from B_H_001 t1
  left join D_008 t2
    on t1.bjid = t2.id
    
 where not exists
 (select 1
          from (select b1.id b1_id, b2.id b2_id, b2.kcid b2_kcid
                  from B_H_01601 b1
                  left join b_h_017 b2
                    on b1.kcllid = b2.id
                 where b1.MAINID = #{pdid}) b3
         where b3.b2_kcid = t1.id)
   and t1.CKID = (select CKID from B_H_016 where ID = #{pdid})
   and ((exists (select 1
                   from B_H_01602 B01602
                  where B01602.ZT = 1
                    and B01602.PDLX = 3
                    and B01602.MAINID = #{pdid}
                    and B01602.DXID = t1.BJID) or not exists
        (select 1
            from B_H_01602 B01602
           where B01602.ZT = 1
             and B01602.PDLX = 3
             and B01602.MAINID = #{pdid})) and
       (exists (select 1
                   from B_H_01602 B01602
                  where B01602.ZT = 1
                    and B01602.PDLX = 2
                    and B01602.MAINID = #{pdid}
                    and B01602.DXID = t1.KWID) or not exists
        (select 1
            from B_H_01602 B01602
           where B01602.ZT = 1
             and B01602.PDLX = 2
             and B01602.MAINID = #{pdid})))

	   <if test="keyword != null and keyword != ''">
		    and (UPPER(t1.BJH) like UPPER('%'||#{keyword}||'%')
		    	OR UPPER(t1.YWMS) like UPPER('%'||#{keyword}||'%')
		    	OR UPPER(t1.SN) like UPPER('%'||#{keyword}||'%')
		    	OR UPPER(t1.PCH) like UPPER('%'||#{keyword}||'%')
		    	OR UPPER(t1.SHZH) like UPPER('%'||#{keyword}||'%')
		    )
		</if>
	</select>
	
	<insert id="insert" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
	    insert into B_H_001 (ID, DPRTCODE, CKLB, 
	      CKID, CKH, CKMC, KWID, 
	      KWH, BJID, BJH, PCH, 
	      SN, ZWMS, YWMS, JLDW, 
	      KCSL, DJSL, CGHTID, 
	      HTBH_CG, SXHTID, HTBH_SX, 
	      TDDID, TDDH, RKSJ, 
	      RKBMID, RKRID, XKZH, 
	      SHZH, SHZWZ, ZT, BZ, 
	      JYDID, HJSM, SPQX, 
	      SCRQ, XH, GG, ZZCS, 
	      TSN, TSO, HCLY, CFYQ, 
	      BJGZJL, LLKLX, LLKBH, 
	      KZLX, IS_DJ, KCCB,GRN,csn,cso)
	    values (#{id,jdbcType=VARCHAR}, #{dprtcode,jdbcType=VARCHAR}, #{cklb,jdbcType=DECIMAL}, 
	      #{ckid,jdbcType=VARCHAR}, #{ckh,jdbcType=VARCHAR}, #{ckmc,jdbcType=VARCHAR}, #{kwid,jdbcType=VARCHAR}, 
	      #{kwh,jdbcType=VARCHAR}, #{bjid,jdbcType=VARCHAR}, #{bjh,jdbcType=VARCHAR}, #{pch,jdbcType=VARCHAR}, 
	      #{sn,jdbcType=VARCHAR}, #{zwms,jdbcType=VARCHAR}, #{ywms,jdbcType=VARCHAR}, #{jldw,jdbcType=VARCHAR}, 
	      #{kcsl,jdbcType=DECIMAL}, #{djsl,jdbcType=DECIMAL}, #{cghtid,jdbcType=VARCHAR}, 
	      #{htbhCg,jdbcType=VARCHAR}, #{sxhtid,jdbcType=VARCHAR}, #{htbhSx,jdbcType=VARCHAR}, 
	      #{tddid,jdbcType=VARCHAR}, #{tddh,jdbcType=VARCHAR}, #{rksj,jdbcType=TIMESTAMP}, 
	      #{rkbmid,jdbcType=VARCHAR}, #{rkrid,jdbcType=VARCHAR}, #{xkzh,jdbcType=VARCHAR}, 
	      #{shzh,jdbcType=VARCHAR}, #{shzwz,jdbcType=VARCHAR}, #{zt,jdbcType=DECIMAL}, #{bz,jdbcType=VARCHAR}, 
	      #{jydid,jdbcType=VARCHAR}, #{hjsm,jdbcType=TIMESTAMP}, #{spqx,jdbcType=TIMESTAMP}, 
	      #{scrq,jdbcType=TIMESTAMP}, #{xh,jdbcType=VARCHAR}, #{gg,jdbcType=VARCHAR}, #{zzcs,jdbcType=VARCHAR}, 
	      #{tsn,jdbcType=VARCHAR}, #{tso,jdbcType=VARCHAR}, #{hcly,jdbcType=VARCHAR}, #{cfyq,jdbcType=VARCHAR}, 
	      #{bjgzjl,jdbcType=VARCHAR}, #{llklx,jdbcType=DECIMAL}, #{llkbh,jdbcType=VARCHAR}, 
	      #{kzlx,jdbcType=DECIMAL}, #{isDj,jdbcType=DECIMAL}, #{kccb,jdbcType=DECIMAL}, #{grn,jdbcType=VARCHAR},#{csn,jdbcType=VARCHAR},#{cso,jdbcType=VARCHAR})
	  </insert>
	  <insert id="insertSelective" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
	    insert into B_H_001
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	      <if test="id != null">
	        ID,
	      </if>
	      <if test="dprtcode != null">
	        DPRTCODE,
	      </if>
	      <if test="cklb != null">
	        CKLB,
	      </if>
	      <if test="ckid != null">
	        CKID,
	      </if>
	      <if test="ckh != null">
	        CKH,
	      </if>
	      <if test="ckmc != null">
	        CKMC,
	      </if>
	      <if test="kwid != null">
	        KWID,
	      </if>
	      <if test="kwh != null">
	        KWH,
	      </if>
	      <if test="bjid != null">
	        BJID,
	      </if>
	      <if test="bjh != null">
	        BJH,
	      </if>
	      <if test="pch != null">
	        PCH,
	      </if>
	      <if test="sn != null">
	        SN,
	      </if>
	      <if test="zwms != null">
	        ZWMS,
	      </if>
	      <if test="ywms != null">
	        YWMS,
	      </if>
	      <if test="jldw != null">
	        JLDW,
	      </if>
	      <if test="kcsl != null">
	        KCSL,
	      </if>
	      <if test="djsl != null">
	        DJSL,
	      </if>
	      <if test="cghtid != null">
	        CGHTID,
	      </if>
	      <if test="htbhCg != null">
	        HTBH_CG,
	      </if>
	      <if test="sxhtid != null">
	        SXHTID,
	      </if>
	      <if test="htbhSx != null">
	        HTBH_SX,
	      </if>
	      <if test="tddid != null">
	        TDDID,
	      </if>
	      <if test="tddh != null">
	        TDDH,
	      </if>
	      <if test="rkrid != null">
	        RKSJ,
	      </if>
	      <if test="rkbmid != null">
	        RKBMID,
	      </if>
	      <if test="rkrid != null">
	        RKRID,
	      </if>
	      <if test="xkzh != null">
	        XKZH,
	      </if>
	      <if test="shzh != null">
	        SHZH,
	      </if>
	      <if test="shzwz != null">
	        SHZWZ,
	      </if>
	      <if test="zt != null">
	        ZT,
	      </if>
	      <if test="bz != null">
	        BZ,
	      </if>
	      <if test="jydid != null">
	        JYDID,
	      </if>
	      <if test="hjsm != null">
	        HJSM,
	      </if>
	      <if test="spqx != null">
	        SPQX,
	      </if>
	      <if test="scrq != null">
	        SCRQ,
	      </if>
	      <if test="xh != null">
	        XH,
	      </if>
	      <if test="gg != null">
	        GG,
	      </if>
	      <if test="zzcs != null">
	        ZZCS,
	      </if>
	      <if test="tsn != null">
	        TSN,
	      </if>
	      <if test="tso != null">
	        TSO,
	      </if>
	      <if test="hcly != null">
	        HCLY,
	      </if>
	      <if test="cfyq != null">
	        CFYQ,
	      </if>
	      <if test="bjgzjl != null">
	        BJGZJL,
	      </if>
	      <if test="llklx != null">
	        LLKLX,
	      </if>
	      <if test="llkbh != null">
	        LLKBH,
	      </if>
	      <if test="kzlx != null">
	        KZLX,
	      </if>
	      <if test="isDj != null">
	        IS_DJ,
	      </if>
	      <if test="kccb != null">
	        KCCB,
	      </if>
	      <if test="grn != null">
	        grn,
	      </if>
	      <if test="csn != null">
	        csn,
	      </if>
	      <if test="cso != null">
	        cso,
	      </if>
	      <if test="whrid != null">
	        whsj,
	      </if>
	      <if test="whrid != null">
	        whrid,
	      </if>
	      <if test="biz != null">
	        biz,
	      </if>
	      <if test="jz != null">
	        jz,
	      </if>
	      <if test="jzbz != null">
	        jzbz,
	      </if>
	      <if test="cqid != null">
	        cqid,
	      </if>
	      <if test="shdmxid != null">
	        shdmxid,
	      </if>
	      <if test="qczt != null">
	        qczt,
	      </if>
	        uuiddm
	    </trim>
	    <trim prefix="values (" suffix=")" suffixOverrides=",">
	      <if test="id != null">
	        #{id,jdbcType=VARCHAR},
	      </if>
	      <if test="dprtcode != null">
	        #{dprtcode,jdbcType=VARCHAR},
	      </if>
	      <if test="cklb != null">
	        #{cklb,jdbcType=DECIMAL},
	      </if>
	      <if test="ckid != null">
	        #{ckid,jdbcType=VARCHAR},
	      </if>
	      <if test="ckh != null">
	        #{ckh,jdbcType=VARCHAR},
	      </if>
	      <if test="ckmc != null">
	        #{ckmc,jdbcType=VARCHAR},
	      </if>
	      <if test="kwid != null">
	        #{kwid,jdbcType=VARCHAR},
	      </if>
	      <if test="kwh != null">
	        #{kwh,jdbcType=VARCHAR},
	      </if>
	      <if test="bjid != null">
	        #{bjid,jdbcType=VARCHAR},
	      </if>
	      <if test="bjh != null">
	        #{bjh,jdbcType=VARCHAR},
	      </if>
	      <if test="pch != null">
	        #{pch,jdbcType=VARCHAR},
	      </if>
	      <if test="sn != null">
	        #{sn,jdbcType=VARCHAR},
	      </if>
	      <if test="zwms != null">
	        #{zwms,jdbcType=VARCHAR},
	      </if>
	      <if test="ywms != null">
	        #{ywms,jdbcType=VARCHAR},
	      </if>
	      <if test="jldw != null">
	        #{jldw,jdbcType=VARCHAR},
	      </if>
	      <if test="kcsl != null">
	        #{kcsl,jdbcType=DECIMAL},
	      </if>
	      <if test="djsl != null">
	        #{djsl,jdbcType=DECIMAL},
	      </if>
	      <if test="cghtid != null">
	        #{cghtid,jdbcType=VARCHAR},
	      </if>
	      <if test="htbhCg != null">
	        #{htbhCg,jdbcType=VARCHAR},
	      </if>
	      <if test="sxhtid != null">
	        #{sxhtid,jdbcType=VARCHAR},
	      </if>
	      <if test="htbhSx != null">
	        #{htbhSx,jdbcType=VARCHAR},
	      </if>
	      <if test="tddid != null">
	        #{tddid,jdbcType=VARCHAR},
	      </if>
	      <if test="tddh != null">
	        #{tddh,jdbcType=VARCHAR},
	      </if>
	      <if test="rkrid != null">
	        sysdate,
	      </if>
	      <if test="rkbmid != null">
	        #{rkbmid,jdbcType=VARCHAR},
	      </if>
	      <if test="rkrid != null">
	        #{rkrid,jdbcType=VARCHAR},
	      </if>
	      <if test="xkzh != null">
	        #{xkzh,jdbcType=VARCHAR},
	      </if>
	      <if test="shzh != null">
	        #{shzh,jdbcType=VARCHAR},
	      </if>
	      <if test="shzwz != null">
	        #{shzwz,jdbcType=VARCHAR},
	      </if>
	      <if test="zt != null">
	        #{zt,jdbcType=DECIMAL},
	      </if>
	      <if test="bz != null">
	        #{bz,jdbcType=VARCHAR},
	      </if>
	      <if test="jydid != null">
	        #{jydid,jdbcType=VARCHAR},
	      </if>
	      <if test="hjsm != null">
	        #{hjsm,jdbcType=TIMESTAMP},
	      </if>
	      <if test="spqx != null">
	        #{spqx,jdbcType=TIMESTAMP},
	      </if>
	      <if test="scrq != null">
	        #{scrq,jdbcType=TIMESTAMP},
	      </if>
	      <if test="xh != null">
	        #{xh,jdbcType=VARCHAR},
	      </if>
	      <if test="gg != null">
	        #{gg,jdbcType=VARCHAR},
	      </if>
	      <if test="zzcs != null">
	        #{zzcs,jdbcType=VARCHAR},
	      </if>
	      <if test="tsn != null">
	        #{tsn,jdbcType=VARCHAR},
	      </if>
	      <if test="tso != null">
	        #{tso,jdbcType=VARCHAR},
	      </if>
	      <if test="hcly != null">
	        #{hcly,jdbcType=VARCHAR},
	      </if>
	      <if test="cfyq != null">
	        #{cfyq,jdbcType=VARCHAR},
	      </if>
	      <if test="bjgzjl != null">
	        #{bjgzjl,jdbcType=VARCHAR},
	      </if>
	      <if test="llklx != null">
	        #{llklx,jdbcType=DECIMAL},
	      </if>
	      <if test="llkbh != null">
	        #{llkbh,jdbcType=VARCHAR},
	      </if>
	      <if test="kzlx != null">
	        #{kzlx,jdbcType=DECIMAL},
	      </if>
	      <if test="isDj != null">
	        #{isDj,jdbcType=DECIMAL},
	      </if>
	      <if test="kccb != null">
	        #{kccb,jdbcType=DECIMAL},
	      </if>
	      <if test="grn != null">
	        #{grn,jdbcType=VARCHAR},
	      </if>
	      <if test="csn != null">
	        #{csn,jdbcType=VARCHAR},
	      </if>
	      <if test="cso != null">
	        #{cso,jdbcType=VARCHAR},
	      </if>
	      <if test="whrid != null">
	        sysdate,
	      </if>
	      <if test="whrid != null">
	        #{whrid,jdbcType=VARCHAR},
	      </if>
	      <if test="biz != null">
	        #{biz,jdbcType=VARCHAR},
	      </if>
	      <if test="jz != null">
	        #{jz,jdbcType=DECIMAL},
	      </if>
	      <if test="jzbz != null">
	        #{jzbz,jdbcType=VARCHAR},
	      </if>
	      <if test="cqid != null">
	        #{cqid,jdbcType=VARCHAR},
	      </if>
	      <if test="shdmxid != null">
	        #{shdmxid,jdbcType=VARCHAR},
	      </if>
	      <if test="qczt != null">
	        #{qczt,jdbcType=VARCHAR},
	      </if>
	      <if test="uuiddm != null">
	        #{uuiddm,jdbcType=VARCHAR},
	      </if>
	      <if test="uuiddm == null">
		    F_InviteCodeGenerator()
	      </if>
	    </trim>
	  </insert>

 <update id="updateByPrimaryKeySelective" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
       update B_H_001
    <set>
      <if test="cklb != null">
        cklb = #{cklb,jdbcType=INTEGER},
      </if>
      <if test="hcly != null">
        hcly = #{hcly,jdbcType=VARCHAR},
      </if>
      <if test="ckid != null">
        ckid = #{ckid,jdbcType=VARCHAR},
      </if>
      <if test="ckh != null">
        ckh = #{ckh,jdbcType=VARCHAR},
      </if>
      <if test="ckmc != null">
        ckmc = #{ckmc,jdbcType=VARCHAR},
      </if>
      <if test="kwid != null">
        kwid = #{kwid,jdbcType=VARCHAR},
      </if>
      <if test="kwh != null">
        kwh = #{kwh,jdbcType=VARCHAR},
      </if>
      <if test="bjid != null">
        bjid = #{bjid,jdbcType=VARCHAR},
      </if>
      <if test="bjh != null">
        bjh = #{bjh,jdbcType=VARCHAR},
      </if>
      <if test="pch != null">
        pch = #{pch,jdbcType=VARCHAR},
      </if>
      <if test="sn != null">
        sn = #{sn,jdbcType=VARCHAR},
      </if>
      <if test="zwms != null">
        zwms = #{zwms,jdbcType=VARCHAR},
      </if>
      <if test="ywms != null">
        ywms = #{ywms,jdbcType=VARCHAR},
      </if>
      <if test="jldw != null">
        jldw = #{jldw,jdbcType=VARCHAR},
      </if>
      <if test="kcsl != null">
        kcsl = #{kcsl,jdbcType=DECIMAL},
      </if>
      <if test="djsl != null">
        djsl = #{djsl,jdbcType=VARCHAR},
      </if>
      <if test="htbhCg != null">
        htbh_cg = #{htbhCg,jdbcType=VARCHAR},
      </if>
      <if test="htbhSx != null">
        htbh_sx = #{htbhSx,jdbcType=VARCHAR},
      </if>
      <if test="tddh != null">
        tddh = #{tddh,jdbcType=VARCHAR},
      </if>
      <if test="rksj != null">
        rksj = #{rksj,jdbcType=TIMESTAMP},
      </if>
      <if test="xkzh != null">
        xkzh = #{xkzh,jdbcType=VARCHAR},
      </if>
      <if test="shzh != null">
        shzh = #{shzh,jdbcType=VARCHAR},
      </if>
      <if test="shzwz != null">
        shzwz = #{shzwz,jdbcType=VARCHAR},
      </if>
       <if test="zt != null">
        ZT = #{zt,jdbcType=INTEGER},
      </if>
      <if test="bz != null">
        bz = #{bz,jdbcType=VARCHAR},
      </if>
      <if test="hjsm != null">
        hjsm = #{hjsm,jdbcType=TIMESTAMP},
      </if>
      <if test="spqx != null">
        spqx = #{spqx,jdbcType=TIMESTAMP},
      </if>
      <if test="scrq != null">
        scrq = #{scrq,jdbcType=TIMESTAMP},
      </if>
      <if test="xh != null">
        xh = #{xh,jdbcType=VARCHAR},
      </if>
      <if test="gg != null">
        gg = #{gg,jdbcType=VARCHAR},
      </if>
      <if test="zzcs != null">
        zzcs = #{zzcs,jdbcType=VARCHAR},
      </if>
      <if test="tsn != null">
        tsn = #{tsn,jdbcType=VARCHAR},
      </if>
      <if test="cfyq != null">
        cfyq = #{cfyq,jdbcType=VARCHAR},
      </if>
      <if test="tso != null">
        tso = #{tso,jdbcType=VARCHAR},
      </if>
      <if test="kccb != null">
        kccb = #{kccb,jdbcType=DECIMAL},
      </if>
      <if test="grn != null">
        grn = #{grn,jdbcType=VARCHAR},
      </if>
      <if test="csn != null">
        csn = #{csn,jdbcType=VARCHAR},
      </if>
      <if test="cso != null">
        cso = #{cso,jdbcType=VARCHAR},
      </if>
       <if test="jydid != null">
        JYDID = #{jydid,jdbcType=DECIMAL},
      </if>
       <if test="whrid != null">
        whrid = #{whrid,jdbcType=VARCHAR},
      </if>
      <if test="whsj != null">
        whsj = #{whsj,jdbcType=TIMESTAMP},
      </if>
      <if test="biz != null">
        biz = #{biz,jdbcType=VARCHAR},
      </if>
      <if test="cqid != null">
        cqid = #{cqid,jdbcType=VARCHAR},
      </if>
      <if test="shdmxid != null">
        shdmxid = #{shdmxid,jdbcType=VARCHAR},
      </if>
      <if test="jz != null">
        jz = #{jz,jdbcType=DECIMAL},
      </if>
      <if test="jzbz != null">
        jzbz = #{jzbz,jdbcType=VARCHAR},
      </if>
      <if test="qczt != null">
        qczt = #{qczt,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update> 
  
  <update id="updateByPrimaryKeySelectives" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
       update B_H_001 set 
        cklb = #{cklb,jdbcType=INTEGER},
        ckid = #{ckid,jdbcType=VARCHAR},
        ckh = #{ckh,jdbcType=VARCHAR},
        ckmc = #{ckmc,jdbcType=VARCHAR},
        kwid = #{kwid,jdbcType=VARCHAR},
        bjid = #{bjid,jdbcType=VARCHAR},
        zwms = #{zwms,jdbcType=VARCHAR},
        ywms = #{ywms,jdbcType=VARCHAR},
        jldw = #{jldw,jdbcType=VARCHAR},
        kcsl = #{kcsl,jdbcType=DECIMAL},
        djsl = #{djsl,jdbcType=VARCHAR},
        htbh_cg = #{htbhCg,jdbcType=VARCHAR},
        htbh_sx = #{htbhSx,jdbcType=VARCHAR},
        tddh = #{tddh,jdbcType=VARCHAR},
        rksj = #{rksj,jdbcType=TIMESTAMP},
        xkzh = #{xkzh,jdbcType=VARCHAR},
        shzh = #{shzh,jdbcType=VARCHAR},
        shzwz = #{shzwz,jdbcType=VARCHAR},
        ZT = #{zt,jdbcType=INTEGER},
        bz = #{bz,jdbcType=VARCHAR},
        hjsm = #{hjsm,jdbcType=TIMESTAMP},
        spqx = #{spqx,jdbcType=TIMESTAMP},
        scrq = #{scrq,jdbcType=TIMESTAMP},
        xh = #{xh,jdbcType=VARCHAR},
        cfyq = #{cfyq,jdbcType=VARCHAR},
        gg = #{gg,jdbcType=VARCHAR},
        zzcs = #{zzcs,jdbcType=VARCHAR},
        tsn = #{tsn,jdbcType=VARCHAR},
        tso = #{tso,jdbcType=VARCHAR},
        kccb = #{kccb,jdbcType=DECIMAL},
        grn = #{grn,jdbcType=VARCHAR},
        csn = #{csn,jdbcType=VARCHAR},
        cso = #{cso,jdbcType=VARCHAR},
        whrid = #{whrid,jdbcType=VARCHAR},
        jz = #{jz,jdbcType=DECIMAL},
        cqid = #{cqid,jdbcType=VARCHAR},
        jzbz = #{jzbz,jdbcType=VARCHAR},
        biz = #{biz,jdbcType=VARCHAR},
        qczt = #{qczt,jdbcType=VARCHAR},
        hcly = #{hcly,jdbcType=VARCHAR},
        whsj = #{whsj,jdbcType=TIMESTAMP}
    where bjh = #{bjh,jdbcType=VARCHAR} 
    and kwh = #{kwh,jdbcType=VARCHAR} 
    <if test="pch != null and pch != ''">
        and pch = #{pch,jdbcType=VARCHAR} 
    </if>
    <if test="sn != null and sn != ''">
       and sn = #{sn,jdbcType=VARCHAR}
    </if>
  </update> 
  
  
  <!-- 查询已选择的移库航材 -->
    <select id="queryChoseList" resultMap="BaseResultMap" parameterType="list">
	   select t1.ID,
       t1.DPRTCODE,
       t1.CKLB,
       t1.CKID,
       t1.CKH,
       t1.CKMC,
       t1.KWID,
       t1.KWH,
       t1.BJID,
       t1.BJH,
       t1.PCH,
       t1.SN,
       T1.ZWMS,
       T1.YWMS,
       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
       t1.KCSL,
       t1.DJSL,
       t1.CGHTID,
       t1.HTBH_CG,
       t1.SXHTID,
       t1.HTBH_SX,
       t1.TDDID,
       t1.TDDH,
       t1.RKSJ,
       t1.RKBMID,
       t1.RKRID,
       t1.SHZH,
       t1.SHZWZ,
       t1.ZT,
       t1.BZ,
       t1.JYDID,
       t1.HJSM,
       t1.SPQX,
       t1.SCRQ,
       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
       t1.GRN,
       t1.csn,
       t1.cso,
       t1.ZZCS,
       t1.TSN,
       t1.TSO,
       t1.HCLY,
       t1.CFYQ,
       t2.cjjh,
       t2.hclx,
       t2.gljb,
       ceil(t1.hjsm - sysdate) syts
  from b_h_001 t1
  left join d_008 t2
    on t1.bjid = t2.id

	   
	   where  t1.id in  
  			 <foreach item="item" index="index" collection="list" open="("  
      		 separator="," close=")">  
       			#{item}  
  			 </foreach>
	</select>
	
	<!-- 更新移库后的原始库存 -->
   <update id="updateStockKc" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
       update B_H_001
    <set>
      <if test="kcsl != null">
        KCSL = #{kcsl,jdbcType=INTEGER},
      </if>
<!--       <if test="dprtcode != null"> -->
<!--         DPRTCODE = #{dprtcode,jdbcType=VARCHAR}, -->
<!--       </if> -->
      <if test="cklb != null">
        CKLB = #{cklb,jdbcType=INTEGER},
      </if>
      <if test="ckid != null">
        CKID = #{ckid,jdbcType=VARCHAR},
      </if>
      <if test="ckh != null">
        CKH = #{ckh,jdbcType=VARCHAR},
      </if>
      <if test="ckmc != null">
        CKMC = #{ckmc,jdbcType=VARCHAR},
      </if>
      <if test="kwid != null">
        KWID = #{kwid,jdbcType=VARCHAR},
      </if>
      <if test="kwh != null">
        KWH = #{kwh,jdbcType=VARCHAR},
      </if>
      <if test="whsj != null">
        WHSJ = #{whsj,jdbcType=TIMESTAMP},
      </if>
      <if test="whrid != null">
        WHRID = #{whrid,jdbcType=VARCHAR},
      </if>
    </set>
      where ID = #{id,jdbcType=VARCHAR}
  </update> 
  
  
  <select id="query4RequisitionPage" resultMap="BaseResultMap">
	   select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts
	  from b_h_001 t1
	  left join d_008 t2
	    on t1.bjid = t2.id
	 where t1.cklb in (0,4, 6, 8)
	   and t1.zt = 2
		<include refid="query4RequisitionParam"></include>
 		<choose>
	    	<when test='pagination.sort == "auto"'>
	    		 order by syts 
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
	 	</choose>
	</select>
 
 	<!-- 搜索参数 -->
	<sql id="query4RequisitionParam">
	 	and t1.ckid <include refid="userStoreParam"></include>
         <if test="hclx != null and hclx != ''">
            and t2.hclx =  #{hclx}
         </if>
         <if test="paramsMap != null and paramsMap.hclxs != null and paramsMap.hclxs != ''">
           and t2.hclx in 
			<foreach item="item" index="index" collection="paramsMap.hclxs" open="(" separator="," close=")">  
     			#{item}  
			 </foreach>
			
         </if>
         <if test="ckid != null and ckid != ''">
            and t1.ckid =  #{ckid}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
        
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.sn) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.pch) like UPPER('%'||#{keyword}||'%')
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
	
	<!-- 搜索参数 -->
	<sql id="query4TansferParam">
          <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
       <choose>
	         <when test="ckh!= null and ckh != ''">
	             and t1.ckid =  #{ckh}
	         </when>
	         <otherwise>  
	         	and t1.ckid <include refid="userStoreParam"></include>
             </otherwise> 
         </choose>
         
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.sn) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.pch) like UPPER('%'||#{keyword}||'%')
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
	
	<sql id="userStoreParam">
	   in (select d9.id from 
       d_009 d9
       left join d_00901 d901 on d9.id = d901.mainid
       where d9.zt =1 and d901.zt=1 and d9.id in (select rw.ck_id from V_ROLE_WH rw where rw.user_id = #{paramsMap.userId, jdbcType=VARCHAR}))
	</sql>
	
	 <select id="queryTransferPage" resultMap="BaseResultMap">
	   select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts
	  from b_h_001 t1
	  left join d_008 t2
	    on t1.bjid = t2.id
	 where t1.zt = 2
		<include refid="query4TansferParam"></include>
		<choose>
	    	<when test='pagination.sort == "auto"'>
	    		 order by syts 
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
 		</choose>
	</select>
 	 
 	<select id="queryAllPageList3" resultMap="BaseResultMap">
           
	   select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t3.CKMC,
	       t1.KWID,
	       t4.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	          t1.whsj,
	       t1.whrid,
	       T1.ZWMS,
	       T1.YWMS,
	       (CASE WHEN T2.JLDW IS NULL THEN T1.JLDW ELSE T2.JLDW END) JLDW,
	       t1.KCSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts
	  from b_h_003 t1
	  left join d_008 t2
	    on t1.bjid = t2.id
        	left join d_009 t3 on t1.ckid=t3.id
         left join d_00901 t4 on t1.kwid=t4.id
        
	 where 1 = 1
		<include refid="FlightRecordParam4"></include>

  		<choose>
	    	<when test='pagination.sort == "auto"'>
	    		 order by syts 
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
	 	</choose>
	</select>
	
 	<sql id="FlightRecordParam4">
	   
	     <if test="id != null and id != ''">
             and t1.id =  #{id}
         </if>
         <if test="hclx != null and hclx != ''">
             and t2.hclx =  #{hclx}
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="bjh != null and bjh != ''">
             and t1.bjh =  #{bjh}
         </if>
         <if test="zt != null and zt != ''">
             and t1.zt =  #{zt}
         </if>
         <if test="keyword != null and keyword != ''">
		      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
	</sql>
	
	<select id="selectCountBjSn" resultType="int">
		select count(1)
		  from (select t1.dprtcode, t1.jh as bjh, t1.xlh as sn
		          from b_s_001 t1
		         where t1.bjlx = 1
		           and t1.zt in (1, 2)
		        union all
		        select t2.dprtcode, t2.bjh, t2.sn
		          from b_h_001 t2
		        union all
		        select t3.dprtcode, t3.bjh, t3.sn
		          from b_h_003 t3
		        union all
		        select tt3.dprtcode, tt2.bjh, tt2.sn
		          from b_h_00901 tt1
		          left join b_h_017 tt2 on tt1.kcllid = tt2.id
		          left join b_h_009 tt3 on tt1.mainid = tt3.id)
		 where dprtcode = #{0}
		   and bjh = #{1}
		   and sn = #{2}
	</select>
	<select id="queryByCklb" resultMap="BaseResultMap">
	   select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       T2.JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       (select userName||' '||realName from t_user where t_user.id=t1.RKRID) RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       CEIL (to_date(to_char(t1.hjsm,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) syts,
	       CEIL (to_date(to_char(t1.SPQX,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) sytss,
	       rkr.realname rkr_realname,
	       rkr.username rkr_username,
			jg.dprtname jg_dprtname
		  from b_h_001 t1
		  left join d_008 t2 on t1.bjid = t2.id
		  left join t_user rkr on rkr.id=t1.rkrid
		  left join t_department jg on jg.id=t1.dprtcode
		 where t1.cklb=2 and t1.zt=4
		<include refid="FlightRecordParam3"></include>
		<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by whsj 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
	</select>
	
		<!-- 根据多个id查询信息 -->
	<select id="queryByIds" resultMap="BaseResultMap" >
		select 
		t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       T2.JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       t1.kccb,
	       t1.grn,
	       t1.csn,
	       t1.cso,
	       CEIL (to_date(to_char(t1.hjsm,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) syts,
	       CEIL (to_date(to_char(t1.SPQX,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) sytss,
	       rkr.realname rkr_realname,
	       rkr.username rkr_username,
			jg.dprtname jg_dprtname
		  from b_h_001 t1
		  left join d_008 t2 on t1.bjid = t2.id
		  left join t_user rkr on rkr.id=t1.rkrid
		  left join t_department jg on jg.id=t1.dprtcode
		where t1.cklb=2 and t1.id in
		<foreach collection="list" item="idList" index="index" open="(" close=")" separator=",">
			#{idList}
		 </foreach>
 	</select>
	<select id="queryPage4Edit" resultMap="BaseResultMap">
	
	  <!-- 仓库内 -->
	  <if test='ckh != "50"'>
		   select 
		       '1' kcly,
		       t1.XKZH,
		       t1.ID,
		       t1.DPRTCODE,
		       t1.CKLB,
		       t1.CKID,
		       t1.CKH,
		       t1.CKMC,
		       t1.KWID,
		       t1.KWH,
		       t1.BJID,
		       t1.BJH,
		       t1.PCH,
		       t1.SN,
		       T1.ZWMS,
		       T1.YWMS,
		       T2.JLDW,
		       t1.KCSL,
		       <!-- t1.DJSL, -->
		       t1.CGHTID,
		       t1.HTBH_CG,
		       t1.SXHTID,
		       t1.HTBH_SX,
		       t1.TDDID,
		       t1.TDDH,
		       t1.RKSJ,
		       t1.RKBMID,
		       (select userName||' '||realName from t_user where t_user.id=t1.RKRID) RKRID,
		       t1.SHZH,
		       t1.SHZWZ,
		       t1.ZT,
		       t1.BZ,
		       t1.JYDID,
		       t1.HJSM,
		       t1.SPQX,
		       t1.SCRQ,
		       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
		       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
		       t1.GRN,
		       t1.csn,
		       t1.cso,
		       t1.ZZCS,
		       t1.TSN,
		       t1.TSO,
		       t1.HCLY,
		       t1.CFYQ,
		       t2.cjjh,
		       t2.hclx,
		       t2.gljb,
		       CEIL (to_date(to_char(t1.hjsm,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) syts,
		       CEIL (to_date(to_char(t1.SPQX,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) sytss
			  from b_h_001 t1
			  left join d_008 t2
			    on t1.bjid = t2.id
			 where 1=1
	
				<if test="keyword != null and keyword != ''">
			      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t2.id) like UPPER(#{keyword})
			     )              <!-- 左右匹配 查询关键字 -->
			  </if>
			  
			  
	         <if test="hclx != null and hclx != ''">
	             and t2.hclx =  CAST(#{hclx} AS NUMERIC)
	         </if>
	         <if test="zt != null and zt != ''">
	             and t1.zt =  #{zt}
	         </if>
	         <if test="dprtcode != null and dprtcode != ''">
	             and t1.dprtcode =  #{dprtcode}
	         </if>
	          <choose>
		         <when test="ckh != null and ckh != ''">
		             and t1.ckid =  #{ckh}
		         </when>
		         <otherwise>  
		         	and t1.ckid <include refid="userStoreParam"></include>
	             </otherwise> 
	         </choose>
	         <if test="bjh != null and bjh != ''">
	             and t1.bjh =  #{bjh}
	         </if>
	         <if test="id != null and id != ''">
	             and t1.id =  #{id}
	         </if>
         </if>
         
         <!-- 全部 -->
         <if test='ckh == ""'>
         union all
         </if>
         
         <!-- 外场 -->
         <if test='ckh == "50" or ckh == null or ckh == ""'>
	         select 
	            '2' kcly,
	            t1.XKZH,
	           t1.ID,
		       t1.DPRTCODE,
		       t1.CKLB,
		       t1.CKID,
		       t1.CKH,
		       '外场' CKMC,
		       t1.KWID,
		       t1.KWH,
		       t1.BJID,
		       t1.BJH,
		       t1.PCH,
		       t1.SN,
		       T1.ZWMS,
		       T1.YWMS,
		       T2.JLDW,
		       t1.KCSL,
		       <!-- t1.DJSL, -->
		       t1.CGHTID,
		       t1.HTBH_CG,
		       t1.SXHTID,
		       t1.HTBH_SX,
		       t1.TDDID,
		       t1.TDDH,
		       t1.RKSJ,
		       t1.RKBMID,
		       (select userName||' '||realName from t_user where t_user.id=t1.RKRID) RKRID,
		       t1.SHZH,
		       t1.SHZWZ,
		       t1.ZT,
		       t1.BZ,
		       t1.JYDID,
		       t1.HJSM,
		       t1.SPQX,
		       t1.SCRQ,
		       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
		       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
		       t1.GRN,
		       t1.csn,
		       t1.cso,
		       t1.ZZCS,
		       t1.TSN,
		       t1.TSO,
		       t1.HCLY,
		       t1.CFYQ,
		       t2.cjjh,
		       t2.hclx,
		       t2.gljb,
		       CEIL (to_date(to_char(t1.hjsm,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) syts,
		       CEIL (to_date(to_char(t1.SPQX,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) sytss
			  from b_h_003 t1
			  left join d_008 t2
			    on t1.bjid = t2.id
			 where 1=1
	
				<if test="keyword != null and keyword != ''">
			      and (UPPER(t1.bjh) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t1.zwms) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t1.ywms) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t2.cjjh) like UPPER('%'||#{keyword}||'%')
			    	or UPPER(t2.id) like UPPER(#{keyword})
			     )              <!-- 左右匹配 查询关键字 -->
			  </if>
			  
			  
	         <if test="hclx != null and hclx != ''">
	             and t2.hclx =  CAST(#{hclx} AS NUMERIC)
	         </if>
	         <if test="zt != null and zt != ''">
	             and t1.zt =  #{zt}
	         </if>
	         <if test="dprtcode != null and dprtcode != ''">
	             and t1.dprtcode =  #{dprtcode}
	         </if>
	          <!-- <choose>
		         <when test="ckh != null and ckh != ''">
		             and t1.ckid =  #{ckh}
		         </when>
		         <otherwise>  
		         	and t1.ckid <include refid="userStoreParam"></include>
	             </otherwise> 
	         </choose> -->
	         <if test="bjh != null and bjh != ''">
	             and t1.bjh =  #{bjh}
	         </if>
	         <if test="id != null and id != ''">
	             and t1.id =  #{id}
	         </if>
         </if>
         
         

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		  order by syts 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
		  
	</select>
	
	
	<!-- 查一个库存（仓库内） -->
	  <select id="selectOne4Wh" resultMap="BaseResultMap"  >
	 
		   select 
		       t1.kccb,
		       '1' kcly,
		       t1.XKZH,
		       t1.ID,
		       t1.DPRTCODE,
		       t1.CKLB,
		       t1.CKID,
		       t1.CKH,
		       t1.CKMC,
		       t1.KWID,
		       t1.KWH,
		       t1.BJID,
		       t1.BJH,
		       t1.PCH,
		       t1.SN,
		       T1.ZWMS,
		       T1.YWMS,
		       T2.JLDW,
		       t1.KCSL,
		      
		       t1.CGHTID,
		       t1.HTBH_CG,
		       t1.SXHTID,
		       t1.HTBH_SX,
		       t1.TDDID,
		       t1.TDDH,
		       t1.RKSJ,
		       t1.RKBMID,
		       (select userName||' '||realName from t_user where t_user.id=t1.RKRID) RKRID,
		       t1.SHZH,
		       t1.SHZWZ,
		       t1.ZT,
		       t1.BZ,
		       t1.JYDID,
		       t1.HJSM,
		       t1.SPQX,
		       t1.SCRQ,
		       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
		       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
		       t1.GRN,
		       t1.csn,
		       t1.cso,
		       t1.ZZCS,
		       t1.TSN,
		       t1.TSO,
		       t1.HCLY,
		       t1.CFYQ,
		       t2.cjjh,
		       t2.hclx,
		       t2.gljb,
		       CEIL (to_date(to_char(t1.hjsm,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) syts,
		       CEIL (to_date(to_char(t1.SPQX,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) sytss
			  from b_h_001 t1
			  left join d_008 t2
			    on t1.bjid = t2.id
			 where 1=1  and t1.id =  #{id}
	</select>  
	
	<!-- 查一个库存（外场） -->
	   <select id="selectOne4Out" resultMap="BaseResultMap">
	   
	         select 
	           t1.kccb,
	            '2' kcly,
	            t1.XKZH,
	           t1.ID,
		       t1.DPRTCODE,
		       t1.CKLB,
		       t1.CKID,
		       t1.CKH,
	           '外场' CKMC,
		       t1.KWID,
		       t1.KWH,
		       t1.BJID,
		       t1.BJH,
		       t1.PCH,
		       t1.SN,
		       T1.ZWMS,
		       T1.YWMS,
		       T2.JLDW,
		       t1.KCSL,
		      <!--  t1.DJSL, -->
		       t1.CGHTID,
		       t1.HTBH_CG,
		       t1.SXHTID,
		       t1.HTBH_SX,
		       t1.TDDID,
		       t1.TDDH,
		       t1.RKSJ,
		       t1.RKBMID,
		       (select userName||' '||realName from t_user where t_user.id=t1.RKRID) RKRID,
		       t1.SHZH,
		       t1.SHZWZ,
		       t1.ZT,
		       t1.BZ,
		       t1.JYDID,
		       t1.HJSM,
		       t1.SPQX,
		       t1.SCRQ,
		       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
		       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
		       t1.GRN,
		       t1.csn,
		       t1.cso,
		       t1.ZZCS,
		       t1.TSN,
		       t1.TSO,
		       t1.HCLY,
		       t1.CFYQ,
		       t2.cjjh,
		       t2.hclx,
		       t2.gljb,
		       CEIL (to_date(to_char(t1.hjsm,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) syts,
		       CEIL (to_date(to_char(t1.SPQX,'yyyy-mm-dd'),'yyyy-mm-dd') - CURRENT_DATE) sytss
			  from b_h_003 t1
			  left join d_008 t2
			    on t1.bjid = t2.id
			 where 1=1 and t1.id =  #{id}
	        
	</select>
	 <update id="update4Wh" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
       update B_H_001
    <set>
    
      <if test="xkzh != null">
        xkzh = #{xkzh,jdbcType=VARCHAR},
      </if>
      <if test="shzh != null">
        shzh = #{shzh,jdbcType=VARCHAR},
      </if>
      <if test="shzwz != null">
        shzwz = #{shzwz,jdbcType=VARCHAR},
      </if>
        hjsm = #{hjsm,jdbcType=TIMESTAMP},
        spqx = #{spqx,jdbcType=TIMESTAMP},
        scrq = #{scrq,jdbcType=TIMESTAMP},
       <if test="zzcs != null">
        zzcs = #{zzcs,jdbcType=VARCHAR},
      </if>
       <if test="rkrid != null">
        rkrid = #{rkrid,jdbcType=VARCHAR},
        rksj = sysdate,
      </if>
      <if test="tsn != null">
        tsn = #{tsn,jdbcType=VARCHAR},
      </if>
      <if test="tso != null">
        tso = #{tso,jdbcType=VARCHAR},
      </if>
       <if test="hcly != null">
        hcly = #{hcly,jdbcType=VARCHAR},
      </if>
      <if test="pch != null">
        pch = #{pch,jdbcType=VARCHAR},
      </if>
      <if test="sn != null">
        sn = #{sn,jdbcType=VARCHAR},
      </if>
      
      <if test="kccb != null">
        kccb = #{kccb,jdbcType=DECIMAL},
      </if>
      <if test="grn != null">
        grn = #{grn,jdbcType=VARCHAR},
      </if>
      <if test="csn != null">
        csn = #{csn,jdbcType=VARCHAR},
      </if>
      <if test="cso != null">
        cso = #{cso,jdbcType=VARCHAR},
      </if>
      <if test="cfyq != null">
        cfyq = #{cfyq,jdbcType=VARCHAR},
      </if>
       
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update> 
  
  
	<update id="update4Out" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
       update B_H_003
    <set>
    
      <if test="xkzh != null">
        xkzh = #{xkzh,jdbcType=VARCHAR},
      </if>
      <if test="shzh != null">
        shzh = #{shzh,jdbcType=VARCHAR},
      </if>
      <if test="shzwz != null">
        shzwz = #{shzwz,jdbcType=VARCHAR},
      </if>
      <if test="hjsm != null">
        hjsm = #{hjsm,jdbcType=TIMESTAMP},
      </if>
      
      <if test="spqx != null">
        spqx = #{spqx,jdbcType=TIMESTAMP},
      </if>
      <if test="scrq != null">
        scrq = #{scrq,jdbcType=TIMESTAMP},
      </if>
       <if test="zzcs != null">
        zzcs = #{zzcs,jdbcType=VARCHAR},
      </if>
      <if test="tsn != null">
        tsn = #{tsn,jdbcType=VARCHAR},
      </if>
      
      
      <if test="tso != null">
        tso = #{tso,jdbcType=VARCHAR},
      </if>
       <if test="hcly != null">
        hcly = #{hcly,jdbcType=VARCHAR},
      </if>
      <if test="pch != null">
        pch = #{pch,jdbcType=VARCHAR},
      </if>
      <if test="sn != null">
        sn = #{sn,jdbcType=VARCHAR},
      </if>
      
      <if test="kccb != null">
        kccb = #{kccb,jdbcType=DECIMAL},
      </if>
      <if test="grn != null">
        grn = #{grn,jdbcType=VARCHAR},
      </if>
      <if test="csn != null">
        csn = #{csn,jdbcType=VARCHAR},
      </if>
      <if test="cso != null">
        cso = #{cso,jdbcType=VARCHAR},
      </if>
      <if test="cfyq != null">
        cfyq = #{cfyq,jdbcType=VARCHAR},
      </if>
       <if test="rkrid != null">
        rkrid = #{rkrid,jdbcType=VARCHAR},
        rksj = sysdate,
      </if>
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update> 
	<update id="updateZTById" parameterType="String">
		update b_h_001 set zt=2 where id =#{id,jdbcType=VARCHAR}
	</update>
	<insert id="insertStockFromMaterialHistory" parameterType="String">
	insert into B_H_001 (ID, DPRTCODE, CKLB, 
	      CKID, CKH, CKMC, KWID, 
	      KWH, BJID, BJH, PCH, 
	      SN, ZWMS, YWMS, JLDW, 
	      KCSL, DJSL, CGHTID, 
	      HTBH_CG, SXHTID, HTBH_SX, 
	      TDDID, TDDH, RKSJ, 
	      RKBMID, RKRID, XKZH, 
	      SHZH, SHZWZ, ZT, BZ, 
	      JYDID, HJSM, SPQX, 
	      SCRQ, XH, GG, ZZCS, 
	      TSN, TSO, HCLY, CFYQ, 
	      BJGZJL, LLKLX, LLKBH, 
	      KZLX, IS_DJ, KCCB,GRN,csn,cso,WHRID,WHSJ)
	    select KCID, DPRTCODE, CKLB, 
	      CKID, CKH, CKMC, KWID, 
	      KWH, BJID, BJH, PCH, 
	      SN, ZWMS, YWMS, JLDW, 
	      KCSL, DJSL, CGHTID, 
	      HTBH_CG, SXHTID, HTBH_SX, 
	      TDDID, TDDH, RKSJ, 
	      RKBMID, RKRID, XKZH, 
	      SHZH, SHZWZ, zt, BZ, 
	      JYDID, HJSM, SPQX, 
	      SCRQ, XH, GG, ZZCS, 
	      TSN, TSO, HCLY, CFYQ, 
	      BJGZJL, LLKLX, LLKBH, 
	      KZLX, IS_DJ, KCCB,GRN,csn,cso,#{0},sysdate from b_h_017 where id=#{1}
	</insert>
	
	<select id="selectBjhAndDprt" resultMap="BaseResultMap" >
	    select t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       T2.JLDW,
	       t1.KCSL,
	       t1.DJSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       (select userName||' '||realName from t_user where t_user.id=t1.RKRID) RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       (CASE WHEN T2.XINGH IS NULL THEN T1.XH ELSE T2.XINGH END) XH,
	       (CASE WHEN T2.GG IS NULL THEN T1.GG ELSE T2.GG END) GG,
	       t1.GRN,
	       t1.csn,
	       t1.cso,
	       t1.ZZCS,
	       t1.TSN,
	       t1.TSO,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.cjjh,
	       t2.hclx,
	       t2.gljb,
	       ceil(t1.hjsm - sysdate) syts,
	       ceil(t1.SPQX - sysdate) sytss
		  from b_h_001 t1
		  left join d_008 t2
		    on t1.bjid = t2.id
		 where t1.dprtcode = #{dprtcode}
		 	and (
		 		t1.bjh in 
	            (select D017.TDJH from D_017 D017 where D017.DPRTCODE = t1.DPRTCODE AND D017.BJH = #{bjh} AND D017.ZT = 1)
	            OR
	            t1.bjh in 
	            (select D017.BJH from D_017 D017 where D017.DPRTCODE = t1.DPRTCODE AND D017.TDJH = #{bjh} AND D017.KNXBS = 2 AND D017.ZT = 1)
		 	)
		 	and t1.zt = 2
		 order by KCSL asc
	</select>
	
	<!-- 查询可报废的库存 -->
	<select id="selectScrapableStock" resultMap="StockJoinMap" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
		SELECT T1.ID,
	       T1.DPRTCODE,
	       T1.CKLB,
	       T1.CKID,
	       T1.CKH,
	       T1.CKMC,
	       T1.KWID,
	       T1.KWH,
	       T1.BJID,
	       T1.BJH,
	       T1.PCH,
	       T1.SN,
	       T1.ZWMS,
	       T1.YWMS,
	       T2.JLDW,
	       T1.KCSL,
	       T1.DJSL,
	       T1.CGHTID,
	       T1.SHZH,
	       T1.SHZWZ,
	       T1.ZT,
	       T1.BZ,
	       T1.JYDID,
	       T1.HJSM,
	       T1.SPQX,
	       T1.SCRQ,
	       T1.ZZCS,
	       T1.TSN,
	       T1.TSO,
	       T1.HCLY,
	       T1.CFYQ,
	       t1.kccb,
	       t1.grn,
	       t1.csn,
	       t1.cso,
	       T2.CJJH,
	       T2.HCLX,
	       T2.GLJB,
	       T2.ID AS HID,
	       T2.HCJZ AS HHCJZ
		  FROM B_H_001 T1
		  LEFT JOIN D_008 T2
		    ON T1.BJID = T2.ID
		 WHERE t1.zt != 4
		 <if test="dprtcode != null">
             and t1.dprtcode =  #{dprtcode}
         </if>
		 <if test="keyword != null and keyword != ''">
		      and (UPPER(t2.BJH) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.ZWMS) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.YWMS) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.SN) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t1.PCH) like UPPER('%'||#{keyword}||'%')
		    	or UPPER(t2.CJJH) like UPPER('%'||#{keyword}||'%')
		     )             
		 </if>
		 <if test="hclx != null">
             and t2.hclx =  #{hclx}
         </if>
         <if test="paramsMap != null and paramsMap.idList != null and paramsMap.idList != ''">
		     and t1.ID not in
     			 <foreach item="item" index="index" collection="paramsMap.idList" open="(" separator="," close=")">  
          			#{item}  
     			 </foreach>  
	     </if>
		 ORDER BY T1.BJH, T1.SN, T1.PCH
	</select>
	<!-- 根据多个id查询信息 -->
	<delete id="deleteids" >
		delete from b_h_001
		where b_h_001.id in
		<foreach collection="list" item="idList" index="index" open="(" close=")" separator=",">
			#{idList}
		 </foreach>
 	</delete>
 	<insert id="insertMater" parameterType="com.eray.thjw.aerialmaterial.po.MaterialHistory">
	    insert into B_H_001 (ID, DPRTCODE, CKLB, 
	      CKID, CKH, CKMC, KWID, 
	      KWH, BJID, BJH, PCH, 
	      SN, ZWMS, YWMS, JLDW, 
	      KCSL, DJSL, CGHTID, 
	      HTBH_CG, SXHTID, HTBH_SX, 
	      TDDID, TDDH, RKSJ, 
	      RKBMID, RKRID, XKZH, 
	      SHZH, SHZWZ, ZT, BZ, 
	      JYDID, HJSM, SPQX, 
	      SCRQ, XH, GG, ZZCS, 
	      TSN, TSO, HCLY, CFYQ, 
	      BJGZJL, LLKLX, LLKBH, 
	      KZLX, IS_DJ, KCCB,GRN,csn,cso,WHRID,WHSJ)
	    values (#{id,jdbcType=VARCHAR}, #{dprtcode,jdbcType=VARCHAR}, #{cklb,jdbcType=DECIMAL}, 
	      #{ckid,jdbcType=VARCHAR}, #{ckh,jdbcType=VARCHAR}, #{ckmc,jdbcType=VARCHAR}, #{kwid,jdbcType=VARCHAR}, 
	      #{kwh,jdbcType=VARCHAR}, #{bjid,jdbcType=VARCHAR}, #{bjh,jdbcType=VARCHAR}, #{pch,jdbcType=VARCHAR}, 
	      #{sn,jdbcType=VARCHAR}, #{zwms,jdbcType=VARCHAR}, #{ywms,jdbcType=VARCHAR}, #{jldw,jdbcType=VARCHAR}, 
	      #{kcsl,jdbcType=DECIMAL}, #{djsl,jdbcType=DECIMAL}, #{cghtid,jdbcType=VARCHAR}, 
	      #{htbhCg,jdbcType=VARCHAR}, #{sxhtid,jdbcType=VARCHAR}, #{htbhSx,jdbcType=VARCHAR}, 
	      #{tddid,jdbcType=VARCHAR}, #{tddh,jdbcType=VARCHAR}, #{rksj,jdbcType=TIMESTAMP}, 
	      #{rkbmid,jdbcType=VARCHAR}, #{rkrid,jdbcType=VARCHAR}, #{xkzh,jdbcType=VARCHAR}, 
	      #{shzh,jdbcType=VARCHAR}, #{shzwz,jdbcType=VARCHAR}, #{zt,jdbcType=DECIMAL}, #{bz,jdbcType=VARCHAR}, 
	      #{jydid,jdbcType=VARCHAR}, #{hjsm,jdbcType=TIMESTAMP}, #{spqx,jdbcType=TIMESTAMP}, 
	      #{scrq,jdbcType=TIMESTAMP}, #{xh,jdbcType=VARCHAR}, #{gg,jdbcType=VARCHAR}, #{zzcs,jdbcType=VARCHAR}, 
	      #{tsn,jdbcType=VARCHAR}, #{tso,jdbcType=VARCHAR}, #{hcly,jdbcType=VARCHAR}, #{cfyq,jdbcType=VARCHAR}, 
	      #{bjgzjl,jdbcType=VARCHAR}, #{llklx,jdbcType=DECIMAL}, #{llkbh,jdbcType=VARCHAR}, 
	      #{kzlx,jdbcType=DECIMAL}, #{isDj,jdbcType=DECIMAL}, #{kccb,jdbcType=DECIMAL},#{grn,jdbcType=VARCHAR},#{csn,jdbcType=VARCHAR},#{cso,jdbcType=VARCHAR}, #{whrid,jdbcType=VARCHAR},
	      current_timestamp)
	  </insert>
	  <select id="selectCount4exit" parameterType="String" resultType="int">
	  	select count(1) from b_h_001 where id in
	  	<foreach collection="list" item="idList" index="index" open="(" close=")" separator=",">
			#{idList}
		 </foreach>
	  </select>
	  <select id="getStockList" parameterType="String" resultMap="BaseResultMap">
	  	select ID, DPRTCODE, CKLB,CKID,CKH, CKMC, KWID,KWH, BJID, BJH,PCH,SN,KCSL, DJSL, CGHTID,
		       HTBH_CG,SXHTID, HTBH_SX, TDDID, TDDH,RKSJ,RKBMID,RKRID, SHZH,SHZWZ,ZT,BZ,JYDID,
		       HJSM,SPQX,SCRQ,ZZCS,TSN,TSO,HCLY,CFYQ,ZWMS,YWMS,XH
		       from b_h_001
		 where BJID=#{0} and dprtcode=#{1} and sn is not null
	  </select>
	  <!-- 查询库存分布详情 -->
	  <select id="queryInventoryDetailList" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultMap="BaseResultMap">
	  	 
		 SELECT 
		 		A.KWID ID, <!-- KWID -->
		        D009.ID CKID, <!-- 仓库ID -->
		        D009.CKH, <!-- 仓库编号 -->
		        D009.CKMC, <!-- 仓库描述 -->
		        D00901.KWH, <!-- 库位号 -->
		        A.KCSL, <!-- 库存数量  -->
		        A.DJSL, <!-- 冻结数量 -->
		        A.KYSL  <!-- 可用数量      -->
		  FROM 
		 (SELECT H001.KWID,
		       COALESCE(SUM(H001.KCSL), 0) KCSL, <!-- 库存数量  -->
		       COALESCE(SUM(H001.DJSL), 0) DJSL, <!-- 冻结数量 -->
		       COALESCE(SUM(H001.KCSL), 0) - COALESCE(SUM(H001.DJSL), 0) KYSL <!-- 可用数量      -->
		  FROM B_H_001 H001
		 WHERE H001.DPRTCODE = #{dprtcode,jdbcType=VARCHAR}
		   AND H001.ZT = 2
		   <if test="paramsMap != null and paramsMap.ckidList != null and paramsMap.ckidList != ''">
			 	AND H001.CKID IN 
	    			 <foreach item="item" index="index" collection="paramsMap.ckidList" open="(" separator="," close=")">  
	         			#{item}  
	    			 </foreach>  
		   </if>
		   AND H001.BJH = #{bjh,jdbcType=VARCHAR}
		 GROUP BY H001.KWID) A
		 LEFT JOIN D_00901 D00901
		 ON D00901.ID = A.KWID
		 LEFT JOIN D_009 D009
		 ON D009.ID = D00901.MAINID
		 ORDER BY D009.CKH ASC
	  </select>
	  <select id="getCount4ValidationBjAndXlh" resultType="map" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
  		<!-- 仓库 -->
		<foreach collection="paramsMap.lxList" item="item" separator="UNION ALL">
		<if test='item == "1" '>
			select 1 type,id ,'仓库' wz from b_h_001 where dprtcode = #{dprtcode,jdbcType=VARCHAR} and bjh = #{bjh,jdbcType=VARCHAR} and sn = #{sn,jdbcType=VARCHAR}
			</if>
		<!--外场 -->
			<if test='item == "2" '> 
			select 2 type,id ,'外场' wz from b_h_003 where dprtcode = #{dprtcode,jdbcType=VARCHAR} and bjh = #{bjh,jdbcType=VARCHAR} and sn = #{sn,jdbcType=VARCHAR}
			</if>
			<if test='item == "3" '>
		<!--销毁单 -->
			select 3 type,b_h_021.id ,b_h_021.xhdh wz from b_h_02101 
		       left join b_h_021 on b_h_021.dprtcode = #{dprtcode,jdbcType=VARCHAR} and b_h_021.zt in(2,10) and b_h_02101.mainid = b_h_021.id 
		       join b_h_017 on bjh = #{bjh,jdbcType=VARCHAR} and sn = #{sn,jdbcType=VARCHAR} and b_h_02101.kcllid = b_h_017.id
		       </if>
		       <if test='item == "4" '>
				<!--外派借出未归还 -->
				select 4 type,id ,'外派借出未归还' wz from b_h_012 where dprtcode = #{dprtcode,jdbcType=VARCHAR} and kcsl > ghsl and jdlx = 1 and bjh = #{bjh,jdbcType=VARCHAR} and sn = #{sn,jdbcType=VARCHAR} 
		       </if>
		       <if test='item == "5" '>
				<!--外派送修未归还 -->
				select 5 type,id,'外派送修未归还' wz from b_h_012 where dprtcode = #{dprtcode,jdbcType=VARCHAR} and kcsl > ghsl and jdlx = 3 and bjh = #{bjh,jdbcType=VARCHAR} and sn = #{sn,jdbcType=VARCHAR} 
				</if>
				<if test='item == "6" '>
				<!--装机清单生效区装上件 -->
				select 6 type,id,fjzch wz from b_s2_004 where dprtcode = #{dprtcode,jdbcType=VARCHAR} and yxbs = 1 and zjzt = 1 and bjh = #{bjh,jdbcType=VARCHAR} and xlh = #{sn,jdbcType=VARCHAR}
				</if>
		</foreach>	
  	</select>
  	 <select id="getCount4ValidationList" resultType="map" parameterType="list">
  		<foreach collection="list" item="item" separator="UNION ALL">
  		<!-- 仓库 -->
		<foreach collection="item.paramsMap.lxList" item="i" separator="UNION ALL">
		<if test='i == "1" '>
			select 1 type,id,'仓库' wz ,bjh,sn from b_h_001 where dprtcode = #{item.dprtcode,jdbcType=VARCHAR} and bjh = #{item.bjh,jdbcType=VARCHAR} and sn = #{item.sn,jdbcType=VARCHAR}
			</if>
		<!--外场 -->
			<if test='i == "2" '> 
			select 2 type,id ,'外场' wz,bjh,sn from b_h_003 where dprtcode = #{item.dprtcode,jdbcType=VARCHAR} and bjh = #{item.bjh,jdbcType=VARCHAR} and sn = #{item.sn,jdbcType=VARCHAR}
			</if>
			<if test='i == "3" '>
		<!--销毁单 -->
			select 3 type,b_h_021.id ,b_h_021.xhdh wz,b_h_017.bjh,b_h_017.sn from b_h_02101 
		       left join b_h_021 on b_h_021.dprtcode = #{item.dprtcode,jdbcType=VARCHAR} and b_h_021.zt in(2,10) and b_h_02101.mainid = b_h_021.id 
		       join b_h_017 on bjh = #{item.bjh,jdbcType=VARCHAR} and sn = #{item.sn,jdbcType=VARCHAR} and b_h_02101.kcllid = b_h_017.id
		       </if>
		       <if test='i == "4" '>
				<!--外派借出未归还 -->
				select 4 type,id ,'外派借出未归还' wz,bjh,sn from b_h_012 where dprtcode = #{item.dprtcode,jdbcType=VARCHAR} and kcsl > ghsl and jdlx = 1 and bjh = #{item.bjh,jdbcType=VARCHAR} and sn = #{item.sn,jdbcType=VARCHAR} 
		       </if>
		       <if test='i == "5" '>
				<!--外派送修未归还 -->
				select 5 type,id,'外派送修未归还' wz,bjh,sn from b_h_012 where dprtcode = #{item.dprtcode,jdbcType=VARCHAR} and kcsl > ghsl and jdlx = 3 and bjh = #{item.bjh,jdbcType=VARCHAR} and sn = #{item.sn,jdbcType=VARCHAR} 
				</if>
				<if test='i == "6" '>
				<!--装机清单生效区装上件 -->
				select 6 type,id,fjzch wz,bjh ,xlh sn from b_s2_004 where dprtcode = #{item.dprtcode,jdbcType=VARCHAR} and yxbs = 1 and zjzt = 1 and bjh = #{item.bjh,jdbcType=VARCHAR} and xlh = #{item.sn,jdbcType=VARCHAR}
				</if>
		</foreach>	
		
		</foreach>	
  	</select>
  	<select id="queryCount4Validation" parameterType="com.eray.thjw.system.po.SnUniqverTemp" resultType="map">
  		<foreach collection="paramsMap.lxList" item="i" separator="UNION ALL">
		<if test='i == "1" '>
			select 1 type,b_h_001.id,'仓库' wz ,b_h_001.bjh,b_h_001.sn from b_h_001 
			join "T_SN_UNIQVER_TEMP" on b_h_001.dprtcode = "T_SN_UNIQVER_TEMP".dprtcode and b_h_001.bjh = "T_SN_UNIQVER_TEMP".bjh and b_h_001.sn = "T_SN_UNIQVER_TEMP".xlh
			where "T_SN_UNIQVER_TEMP".lsh = #{lsh,jdbcType=VARCHAR}
			</if>
		<!--外场 -->
			<if test='i == "2" '> 
			select 2 type,b_h_003.id ,'外场' wz,b_h_003.bjh,b_h_003.sn from b_h_003 
			join "T_SN_UNIQVER_TEMP" on b_h_003.dprtcode = "T_SN_UNIQVER_TEMP".dprtcode and b_h_003.bjh = "T_SN_UNIQVER_TEMP".bjh and b_h_003.sn = "T_SN_UNIQVER_TEMP".xlh
			where "T_SN_UNIQVER_TEMP".lsh = #{lsh,jdbcType=VARCHAR}
			</if>
			<if test='i == "3" '>
		<!--销毁单 -->
			select 3 type,b_h_021.id ,b_h_021.xhdh wz,b_h_017.bjh,b_h_017.sn from b_h_02101 
		       left join b_h_021 on  b_h_021.zt in(2,10) and b_h_02101.mainid = b_h_021.id 		 
		       join b_h_017 on  b_h_02101.kcllid = b_h_017.id
		       join "T_SN_UNIQVER_TEMP" on b_h_017.dprtcode = "T_SN_UNIQVER_TEMP".dprtcode and b_h_017.bjh = "T_SN_UNIQVER_TEMP".bjh and b_h_017.sn = "T_SN_UNIQVER_TEMP".xlh
		       where "T_SN_UNIQVER_TEMP".lsh = #{lsh,jdbcType=VARCHAR}
		       </if>
		       <if test='i == "4" '>
				<!--外派借出未归还 -->
				select 4 type,b_h_012.id ,'外派借出未归还' wz,b_h_012.bjh,b_h_012.sn from b_h_012 join "T_SN_UNIQVER_TEMP" on b_h_012.dprtcode = "T_SN_UNIQVER_TEMP".dprtcode and b_h_012.bjh = "T_SN_UNIQVER_TEMP".bjh and b_h_012.sn = "T_SN_UNIQVER_TEMP".xlh
				 where b_h_012.kcsl > b_h_012.ghsl and b_h_012.jdlx = 1  and "T_SN_UNIQVER_TEMP".lsh = #{lsh,jdbcType=VARCHAR}
		       </if>
		       <if test='i == "5" '>
				<!--外派送修未归还 -->
				select 5 type,b_h_012.id,'外派送修未归还' wz,b_h_012.bjh,b_h_012.sn from b_h_012 join "T_SN_UNIQVER_TEMP" on b_h_012.dprtcode = "T_SN_UNIQVER_TEMP".dprtcode and b_h_012.bjh = "T_SN_UNIQVER_TEMP".bjh and b_h_012.sn = "T_SN_UNIQVER_TEMP".xlh			
				where  b_h_012.kcsl > b_h_012.ghsl and b_h_012.jdlx = 3 and "T_SN_UNIQVER_TEMP".lsh = #{lsh,jdbcType=VARCHAR}
				</if>
				<if test='i == "6" '>
				<!--装机清单生效区装上件 -->
				select 6 type,b_s2_004.id,b_s2_004.fjzch wz,b_s2_004.bjh ,b_s2_004.xlh sn from b_s2_004 
				join "T_SN_UNIQVER_TEMP" on b_s2_004.dprtcode = "T_SN_UNIQVER_TEMP".dprtcode and b_s2_004.bjh = "T_SN_UNIQVER_TEMP".bjh and b_s2_004.xlh = "T_SN_UNIQVER_TEMP".xlh
				where  b_s2_004.yxbs = 1 and b_s2_004.zjzt = 1  and "T_SN_UNIQVER_TEMP".lsh = #{lsh,jdbcType=VARCHAR}
				</if>
		</foreach>	
  	</select>
  	
  	<select id="queryAllPageToolsList"  resultMap="BaseResultMap">
   	  SELECT t1.ID, t1.DPRTCODE, t1.CKLB, t1.CKID, t1.CKH, t1.CKMC, t1.KWID, t1.KWH, t1.BJID,  t1.PCH, t1.SN,  
	    t1.KCSL, t1.DJSL, t1.CGHTID, t1.HTBH_CG, t1.SXHTID, t1.HTBH_SX, t1.TDDID, t1.TDDH, t1.RKSJ, t1.RKBMID, t1.RKRID, t1.SHZH, 
	    t1.SHZWZ, t1.ZT,t1.BZ, t1.JYDID, t1.HJSM, t1.SPQX, t1.SCRQ,t1.GRN,t1.csn,t1.cso, t1.ZZCS, t1.TSN, t1.TSO, t1.HCLY, t1.CFYQ,
	    t2.hclx,t2.gg,t2.xingh as xh,t1.zwms,t1.ywms,t2.bjh,t2.jldw
          from B_H_001  t1
          join d_008 t2 on t1.bjid=t2.id
          where t2.gljb='3' and hclx in (2,3)
          and  t1.dprtcode= #{dprtcode,jdbcType=VARCHAR}
 		<if test="keyword != null and keyword != ''">
		   AND (UPPER(t2.bjh) LIKE UPPER('%'||#{keyword}||'%')
		     OR   UPPER(t2.zwms)  LIKE UPPER('%'||#{keyword}||'%')
		     OR   UPPER(t2.ywms)  LIKE UPPER('%'||#{keyword}||'%')
		     )
		</if>
	  
  </select>
  
  <!-- 根据id获取uuid短码 -->
  <select id="selectUUIDDMbyId"  resultType="java.lang.String">
   	  SELECT uuiddm from B_H_001 where id = #{id,jdbcType=VARCHAR}
  </select>
  
  <!-- 根据收货单查询库存 -->
  <select id="queryStockByShdid" parameterType="String" resultMap="StockJoinMap">
		select B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       (CASE WHEN D008.JLDW IS NULL THEN B001.JLDW ELSE D008.JLDW END) JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       B001.CGHTID,
		       B001.HTBH_CG,
		       B001.SXHTID,
		       B001.HTBH_SX,
		       B001.TDDID,
		       B001.TDDH,
		       B001.RKSJ,
		       B001.RKBMID,
		       B001.RKRID,
		       B001.SHZH,
		       B001.SHZWZ,
		       B001.ZT,
		       B001.BZ,
		       B001.JYDID,
		       B001.HJSM,
		       B001.SPQX,
		       B001.SCRQ,
		       B001.KCCB,
		       B001.grn,
		       B001.csn,
		       B001.cso,
		       (CASE WHEN D008.XINGH IS NULL THEN B001.XH ELSE D008.XINGH END) XH,
		       (CASE WHEN D008.GG IS NULL THEN B001.GG ELSE D008.GG END) GG,
		       B001.ZZCS,
		       B001.TSN,
		       B001.TSO,
		       B001.HCLY,
		       B001.CFYQ,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.ZWMS     AS HZWMS,
		       D008.YWMS     AS HYWMS,
		       D008.JLDW     AS HJLDW,
		       D008.CJJH     AS HCJJH,
		       D008.HCLX     AS HHCLX,
		       D008.HCLX_EJ  AS HHCLX_EJ,
		       B001.SHDMXID,
		       B001.CQID
		  from B_H_001 B001
		  left join D_008 D008
		    on B001.BJID = D008.ID
           where exists (select 1
            from b_h2_02001
            left join b_h2_0200101
            on b_h2_02001.id = b_h2_0200101.mainid
            where b_h2_02001.mainid = #{shdid,jdbcType=VARCHAR}
            and B001.shdmxid = b_h2_0200101.id) 
              and B001.zt in (1, 2)
	</select>
  
  	<!-- 航材入库上架查询库存 -->
    <select id="queryStockByMaterialStockIn" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultMap="StockReceiptMap">
		SELECT B001.ID,
		       B001.DPRTCODE,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       B001.KCSL,
		       B001.CKH,
		       B001.CKMC,
		       B001.JLDW,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.ZWMS     AS HZWMS,
		       D008.YWMS     AS HYWMS,
		       D008.HCLX     AS HHCLX,
		       D008.HCLX_EJ  AS HHCLX_EJ,
		       B001.SHDMXID,
		       BH020.ID     AS SHD_ID,
		       BH020.SHDH   AS SHD_SHDH,
		       BH020.SHRQ   AS SHD_SHRQ,
		       BH020.SHLX   AS SHD_SHLX,
		       SHR.ID       AS SHRID,
		       SHR.USERNAME AS SHRUSERNAME,
		       SHR.REALNAME AS SHRREALNAME,
		       BH006.ID     AS ZJD_ID,
		       BH006.JYDH   AS ZJD_JYDH,
		       BH006.ZT     AS ZJD_ZT,
		       BH006.JYRQ   AS ZJD_JYRQ,
		       JYR.ID       AS JYRID,
		       JYR.USERNAME AS JYRUSERNAME,
		       JYR.REALNAME AS JYRREALNAME
		  FROM B_H_001 B001
		  LEFT JOIN D_008 D008
		    ON B001.BJID = D008.ID
		  LEFT JOIN B_H2_0200101 BH0200101
		    ON B001.SHDMXID = BH0200101.ID
		  LEFT JOIN B_H2_02001 BH02001
		    ON BH0200101.MAINID = BH02001.ID
		  LEFT JOIN B_H2_020 BH020
		    ON BH02001.MAINID = BH020.ID
		  LEFT JOIN T_USER SHR
		    ON BH020.SHRID = SHR.ID
		  LEFT JOIN B_H_006_NEW BH006
		    ON B001.JYDID = BH006.ID
		  LEFT JOIN T_USER JYR
		    ON BH006.JYRID = JYR.ID
           WHERE B001.ZT = 1
           <if test="paramsMap.hclx != null">
              AND D008.HCLX =  #{paramsMap.hclx,jdbcType=DECIMAL}
           </if>
           <if test="paramsMap.hclxEj != null">
              AND D008.HCLX_EJ =  #{paramsMap.hclxEj,jdbcType=DECIMAL}
           </if>
           <if test="dprtcode != null and dprtcode != ''">
              AND B001.DPRTCODE =  #{dprtcode,jdbcType=VARCHAR}
           </if>
           <if test="ckid != null and ckid != ''">
              AND B001.CKID =  #{ckid,jdbcType=VARCHAR}
           </if>
           <if test="paramsMap.type != null and paramsMap.type == 'material'">
              AND D008.HCLX IN (0, 1, 4, 5, 6)
           </if>
           <if test="paramsMap.type != null and paramsMap.type == 'tool'">
              AND D008.HCLX IN (2, 3)
           </if>
           <!-- 收货日期范围-->
		   <if test="paramsMap != null and paramsMap.shrqBegin != null and paramsMap.shrqBegin != ''">
		   	  AND  BH020.shrq &gt;= TRUNC(TO_DATE(#{paramsMap.shrqBegin}, 'YYYY-MM-DD'))
		   </if>
		   <if test="paramsMap != null and paramsMap.shrqEnd != null and paramsMap.shrqEnd != ''">
		   	  AND  BH020.shrq &lt;= TRUNC(TO_DATE(#{paramsMap.shrqEnd}, 'YYYY-MM-DD'))
		   </if>
		   <!-- 关键字-->
		   <if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
		      AND  (UPPER(B001.BJH) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
		    		UPPER(D008.ZWMS) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
		    	    UPPER(D008.YWMS) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
		    	    UPPER(B001.PCH) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
		    	    UPPER(B001.SN) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
		    	   UPPER(BH020.SHDH) LIKE UPPER('%'||#{paramsMap.keyword}||'%') OR
		    	    UPPER(BH006.JYDH) LIKE UPPER('%'||#{paramsMap.keyword}||'%')
		      )
		   </if>
		   <!-- 仓库权限 -->
		   <choose>   
	    	<when test='paramsMap.userType!=null and paramsMap.userType == "admin"'>                       
	    		AND EXISTS 
	    		( SELECT 1 FROM D_009 D009 WHERE 
	    			B001.CKID = D009.ID
	    		AND B001.DPRTCODE = D009.DPRTCODE
	    		AND D009.ZT = 1
	    		)
	    	</when>
	    	<when test='paramsMap.userType != "admin" and paramsMap.userId!=null and paramsMap.userId != ""'>                       
	    		AND EXISTS 
	    		(SELECT 1 FROM V_ROLE_WH WH WHERE 
	    		   B001.CKID=WH.CK_ID 
	    		   AND WH.USER_ID=#{paramsMap.userId,jdbcType=VARCHAR})
	    	</when>
	   	   </choose>
	</select>
	
	<select id="queryAllByYk" parameterType="com.eray.thjw.aerialmaterial.po.Stock" resultMap="StockReceiptMap">
		select t1.ID,
		       t1.DPRTCODE,
		       t1.CKLB,
		       t1.CKID,
		       t1.CKH,
		       t1.CKMC,
		       t1.KWID,
		       t1.KWH,
		       t1.BJID,
		       t1.BJH,
		       t1.PCH,
		       t1.SN,
		       t1.ZWMS,
		       t1.YWMS,
		       T2.JLDW,
		       t1.KCSL,
		       t1.CGHTID,
		       t1.HTBH_CG,
		       t1.SXHTID,
		       t1.HTBH_SX,
		       t1.TDDID,
		       t1.TDDH,
		       t1.RKSJ,
		       t1.RKBMID,
		       t1.RKRID,
		       t1.SHZH,
		       t1.SHZWZ,
		       t1.ZT,
		       t1.BZ,
		       t1.JYDID,
		       t1.HJSM,
		       t1.SPQX,
		       t1.SCRQ,
		       t1.HCLY,
		       t1.CFYQ,
		       t1.QCZT,
		       t2.hclx,
		       t2.hclx_ej,
		       t2.gljb,
		       nvl(t1.djsl,0) djsl,
		       t3.CQBH,
		       t3.FJZCH CFJZCH,
		       t3.GSMC
		  from b_h_001 t1
		  left join d_008 t2
		    on t1.bjid = t2.id
		  left join d_026 t3
		     on t3.id = t1.cqid
		 where 1=1
		<include refid="stockParam"></include>

   		  	<choose>
			    	<when test='pagination.sort == "auto"'>
			    		 order by bjh 
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		 	</choose>
	</select>
	 <!-- 搜索参数 -->
	<sql id="stockParam">
         <if test="cqid != null and cqid != ''">
             and t1.cqid =  #{cqid}
         </if>
         <if test="paramsMap != null and paramsMap.hclx_ej != null and paramsMap.hclx_ej != ''">
             and t2.hclx_ej =  #{paramsMap.hclx_ej}
         </if>
         <if test="paramsMap != null and paramsMap.hclx != null and paramsMap.hclx != ''">
            and t2.hclx in
    			 <foreach item="item" index="index" collection="paramsMap.hclx" open="(" separator="," close=")">  
         			#{item}  
    			 </foreach>  
      </if> 
        <if test=" ckid != null and ckid != ''">
             and t1.ckid =  #{ckid}
         </if>
        <if test=" kwh != null and kwh != ''">
             and (UPPER(t1.kwh) like UPPER('%'||#{kwh}||'%')) 
         </if>
         <if test="dprtcode != null and dprtcode != ''">
             and t1.dprtcode =  #{dprtcode}
         </if>
         <if test="qczt != null and qczt != ''">
             and t1.qczt =  #{qczt}
         </if>
        <if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
		      and (
		           lower(t1.bjh) like lower('%'||#{paramsMap.keyword}||'%') 
		    	or lower(t1.sn) like lower('%'||#{paramsMap.keyword}||'%')  
		    	or lower(t1.ywms) like lower('%'||#{paramsMap.keyword}||'%')  
		    	or lower(t1.zwms) like lower('%'||#{paramsMap.keyword}||'%')  
		    	or lower(t1.pch) like lower('%'||#{paramsMap.keyword}||'%')  
		    	or lower(t1.UUIDDM) like lower('%'||#{paramsMap.keyword}||'%')  
		     )              <!-- 左右匹配 查询关键字 -->
		  </if>
		  
       <if test="id != null and id != '' " >   
            and  t1.id  = #{id,jdbcType=VARCHAR}
           </if>
	</sql>
	
	<select id="selectByIds" resultMap="BaseResultMap" >
		select 
		   t1.ID,
	       t1.DPRTCODE,
	       t1.CKLB,
	       t1.CKID,
	       t1.CKH,
	       t1.CKMC,
	       t1.KWID,
	       t1.KWH,
	       t1.BJID,
	       t1.BJH,
	       t1.PCH,
	       t1.SN,
	       t1.ZWMS,
	       t1.YWMS,
	       t1.KCSL,
	       t1.CGHTID,
	       t1.HTBH_CG,
	       t1.SXHTID,
	       t1.HTBH_SX,
	       t1.TDDID,
	       t1.TDDH,
	       t1.RKSJ,
	       t1.RKBMID,
	       t1.RKRID,
	       t1.SHZH,
	       t1.SHZWZ,
	       t1.ZT,
	       t1.BZ,
	       t1.JYDID,
	       t1.HJSM,
	       t1.SPQX,
	       t1.SCRQ,
	       t1.HCLY,
	       t1.CFYQ,
	       t2.jldw,
	       t1.gg,
	       t1.xh,
	       t1.cqid,
	       t1.grn,
	       t1.shdmxid,
	       t1.tsn,
	       t1.tso,
	       t1.csn,
	       t1.cso,
	       t1.kccb,
	       t1.biz,
	       t1.jz,
	       t1.jzbz,
	       nvl(t1.djsl,0) djsl
    	from b_h_001 t1
    	left join d_008 t2 on t1.bjid = t2.id
    	where t1.ID in
		<foreach collection="list" item="ids" index="index" open="(" close=")" separator=",">
			#{ids,jdbcType=VARCHAR}
		 </foreach>
 	</select>
	
	<!-- 航材入库上架id查询库存 -->
    <select id="queryStockByMaterialStockInId" parameterType="java.lang.String" resultMap="StockReceiptMap">
		SELECT B001.ID,
		       B001.DPRTCODE,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       B001.KCSL,
		       B001.CKH,
		       B001.CKMC,
		       B001.JLDW,
		       BH032.CB      AS KCCB,
		       BH032.CBBZ    AS BIZ,
		       BH032.JZ,
		       BH032.JZBZ,
		       B001.HCLY,
		       B001.GRN,
		       B001.SCRQ,
		       B001.HJSM,
		       B001.TSN,
		       B001.TSO,
		       B001.CSN,
		       B001.CSO,
		       B001.CFYQ,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.HCLX     AS HHCLX,
		       D008.JLDW     AS HJLDW,
		       B001.SHDMXID,
		       BH020.ID     AS SHD_ID,
		       BH020.SHDH   AS SHD_SHDH,
		       BH020.SHRQ   AS SHD_SHRQ,
		       BH020.SHLX   AS SHD_SHLX,
		       BH020.LYDW   AS SHD_LYDW,
		       SHR.ID       AS SHRID,
		       SHR.USERNAME AS SHRUSERNAME,
		       SHR.REALNAME AS SHRREALNAME,
		       BH006.ID     AS ZJD_ID,
		       BH006.JYDH   AS ZJD_JYDH,
		       BH006.ZT     AS ZJD_ZT,
		       BH006.JYRQ   AS ZJD_JYRQ,
		       JYR.ID       AS JYRID,
		       JYR.USERNAME AS JYRUSERNAME,
		       JYR.REALNAME AS JYRREALNAME
		  FROM B_H_001 B001
		  LEFT JOIN D_008 D008
		    ON B001.BJID = D008.ID
		  LEFT JOIN B_H2_0200101 BH0200101
		    ON B001.SHDMXID = BH0200101.ID
		  LEFT JOIN B_H2_02001 BH02001
		    ON BH0200101.MAINID = BH02001.ID
		  LEFT JOIN B_H2_020 BH020
		    ON BH02001.MAINID = BH020.ID
		  LEFT JOIN T_USER SHR
		    ON BH020.SHRID = SHR.ID
		  LEFT JOIN B_H_006_NEW BH006
		    ON B001.JYDID = BH006.ID
		  LEFT JOIN T_USER JYR
		    ON BH006.JYRID = JYR.ID
		  LEFT JOIN B_H_032 BH032 
	   		ON B001.DPRTCODE = BH032.DPRTCODE 
	   		AND COALESCE(B001.SN, '-')=COALESCE(BH032.XLH,'-') 
	   		AND COALESCE(B001.PCH,'-')=COALESCE(BH032.PCH,'-') 
	   		AND B001.BJH = BH032.BJH
           WHERE B001.ID = #{id,jdbcType=VARCHAR}
	</select>
	
	<!-- 根据id查询 -->
	<select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
		select id, dprtcode, cklb, ckid, ckh, ckmc, kwid, kwh, bjid, bjh, pch, sn, zwms, ywms,
               jldw, kcsl, djsl, cghtid, htbh_cg, sxhtid, htbh_sx, tddid, tddh, rksj, rkbmid,
               rkrid, xkzh, shzh, shzwz, zt, bz, jydid, hjsm, spqx, scrq, xh, gg, zzcs, tsn,
               tso, csn, cso, hcly, cfyq, bjgzjl, llklx, llkbh, kzlx, is_dj, kccb, grn, whrid,
               whsj, biz, cqid, shdmxid, uuiddm, jz, jzbz, qczt
         from b_h_001
           where id = #{id,jdbcType=VARCHAR}
	</select>
	
	<select id="getById" parameterType="String" resultMap="BaseResultMap">
		select B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       (CASE WHEN D008.JLDW IS NULL THEN B001.JLDW ELSE D008.JLDW END) JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       D008.hclx,
		       d026.cqbh
		  from B_H_001 B001
		  left join D_008 D008
		    on B001.BJID = D008.ID
		  left join d_026 d026 on B001.cqid = d026.id
          where B001.ID = #{id,jdbcType=VARCHAR} and B001.DPRTCODE = #{dprtcode,jdbcType=VARCHAR}
	</select>
	
	<select id="getByUuiddm" parameterType="String" resultMap="BaseResultMap">
		select B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       (CASE WHEN D008.JLDW IS NULL THEN B001.JLDW ELSE D008.JLDW END) JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       D008.hclx,
		       d026.cqbh
		  from B_H_001 B001
		  left join D_008 D008
		    on B001.BJID = D008.ID
		  left join d_026 d026 on B001.cqid = d026.id
          where B001.UUIDDM = #{uuiddm,jdbcType=VARCHAR} and B001.DPRTCODE = #{dprtcode,jdbcType=VARCHAR}
	</select>
	<select id="getList4ExistByIdlist" parameterType="list" resultMap="BaseResultMap">
		select  ID, DPRTCODE, CKLB, CKID, CKH, CKMC, KWID, KWH, BJID, BJH, PCH, SN, ZWMS, YWMS, JLDW, 
	    KCSL, DJSL, CGHTID, HTBH_CG, SXHTID, HTBH_SX, TDDID, TDDH, RKSJ, RKBMID, RKRID, XKZH, 
	    SHZH, SHZWZ, ZT, BZ, JYDID, HJSM, SPQX, SCRQ, XH, GG, ZZCS, TSN, TSO, HCLY, CFYQ, 
	    BJGZJL, LLKLX, LLKBH, KZLX, IS_DJ, KCCB, WHRID, WHSJ, GRN, CSN, CSO, BIZ, CQID, SHDMXID, 
	    UUIDDM, JZ, JZBZ
	  from B_H_001 
	    where id in 
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">  
     			#{item}  
			 </foreach>
	</select>
	<update id="update4Djsl" parameterType="list">
		UPDATE B_H_001 H001
   SET DJSL =
       (SELECT SUM(H023.DJSL) FROM B_H_023 H023 WHERE H023.KCID = H001.ID)
 	WHERE H001.ID IN 
 	<foreach item="item" index="index" collection="list" open="(" separator="," close=")">  
    			#{item}  
		 </foreach>
	</update>

	<update id="update4Destroy" parameterType="com.eray.thjw.aerialmaterial.po.Stock">
		UPDATE B_H_001 H001
   SET DJSL =
       (SELECT SUM(H023.DJSL) FROM B_H_023 H023 WHERE H023.KCID = H001.ID),
	kcsl=#{kcsl,jdbcType=DECIMAL},
	whrid = #{whrid,jdbcType=VARCHAR},
	  whsj = sysdate
 WHERE 
 H001.ID = #{id,jdbcType=VARCHAR}
	</update>
	
		<select id="queryjydid" parameterType="String" resultMap="StockJoinMap">
		select B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       B001.ZWMS,
		       B001.YWMS,
		       (CASE WHEN D008.JLDW IS NULL THEN B001.JLDW ELSE D008.JLDW END) JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       B001.CGHTID,
		       B001.HTBH_CG,
		       B001.SXHTID,
		       B001.HTBH_SX,
		       B001.TDDID,
		       B001.TDDH,
		       B001.RKSJ,
		       B001.RKBMID,
		       B001.RKRID,
		       B001.SHZH,
		       B001.SHZWZ,
		       B001.ZT,
		       B001.BZ,
		       B001.JYDID,
		       B001.HJSM,
		       B001.SPQX,
		       B001.SCRQ,
		       B001.KCCB,
		       B001.grn,
		       B001.csn,
		       B001.cso,
		       (CASE WHEN D008.XINGH IS NULL THEN B001.XH ELSE D008.XINGH END) XH,
		       (CASE WHEN D008.GG IS NULL THEN B001.GG ELSE D008.GG END) GG,
		       B001.ZZCS,
		       B001.TSN,
		       B001.TSO,
		       B001.HCLY,
		       B001.CFYQ,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.ZWMS     AS HZWMS,
		       D008.YWMS     AS HYWMS,
		       D008.JLDW     AS HJLDW,
		       D008.CJJH     AS HCJJH,
		       D008.HCLX     AS HHCLX,
		       D008.HCLX_EJ  AS HHCLX_EJ
		  from B_H_001 B001
		  left join D_008 D008
		    on B001.BJID = D008.ID

           where B001.jydid = #{id}
		
	</select>
	
	<!-- 工具/设备借归查询库存 -->
	<select id="queryByToolBorrowReturn" parameterType="map" resultMap="BaseResultMap">
		SELECT B001.ID,
		       B001.DPRTCODE,
		       B001.CKLB,
		       B001.CKID,
		       B001.CKH,
		       B001.CKMC,
		       B001.KWID,
		       B001.KWH,
		       B001.BJID,
		       B001.BJH,
		       B001.PCH,
		       B001.SN,
		       D008.ZWMS,
		       D008.YWMS,
		       D008.JLDW,
		       B001.KCSL,
		       B001.DJSL,
		       B001.CGHTID,
		       B001.HTBH_CG,
		       B001.SXHTID,
		       B001.HTBH_SX,
		       B001.TDDID,
		       B001.TDDH,
		       B001.RKSJ,
		       B001.RKBMID,
		       B001.RKRID,
		       B001.SHZH,
		       B001.SHZWZ,
		       B001.ZT,
		       B001.BZ,
		       B001.JYDID,
		       B001.HJSM,
		       B001.SPQX,
		       B001.SCRQ,
		       (CASE WHEN D008.XINGH IS NULL THEN B001.XH ELSE D008.XINGH END) XH,
		       (CASE WHEN D008.GG IS NULL THEN B001.GG ELSE D008.GG END) GG,
		       B001.GRN,
		       B001.CSN,
		       B001.CSO,
		       B001.ZZCS,
		       B001.TSN,
		       B001.TSO,
		       B001.HCLY,
		       B001.CFYQ,
		       D008.ID       AS HID,
		       D008.BJH      AS HBJH,
		       D008.ZWMS     AS HZWMS,
		       D008.YWMS     AS HYWMS,
		       D008.HCLX     AS HHCLX,
		       D008.HCLX_EJ  AS HHCLX_EJ
		  FROM B_H_001 B001
		  LEFT JOIN D_008 D008
		    ON B001.BJID = D008.ID
           WHERE D008.HCLX IN (2, 3)
           <if test="dprtcode != null and dprtcode != ''">
              AND B001.DPRTCODE =  #{dprtcode,jdbcType=VARCHAR}
           </if>
		   <!-- 关键字-->
		   <if test="keyword != null and keyword != ''">
		      AND  (UPPER(B001.BJH) LIKE UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%') OR
		    	    UPPER(B001.SN) LIKE UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%') OR
		    		UPPER(D008.ZWMS) LIKE UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%') OR
		    	    UPPER(D008.YWMS) LIKE UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%') OR
		    	    UPPER(D008.GG) LIKE UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%') OR
		    	    UPPER(D008.XINGH) LIKE UPPER('%'||#{keyword,jdbcType=VARCHAR}||'%') OR
		    	    UPPER(B001.UUIDDM) = UPPER(#{keyword,jdbcType=VARCHAR})
		      )
		   </if>
	</select>
</mapper>