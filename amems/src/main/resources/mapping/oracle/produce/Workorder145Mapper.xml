<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.eray.thjw.produce.dao.Workorder145Mapper" >
  <resultMap id="BaseResultMap" type="com.eray.thjw.produce.po.Workorder145" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="GDSBID" property="gdsbid" jdbcType="VARCHAR" />
    <result column="DPRTCODE" property="dprtcode" jdbcType="VARCHAR" />
    <result column="WHDWID" property="whdwid" jdbcType="VARCHAR" />
    <result column="WHRID" property="whrid" jdbcType="VARCHAR" />
    <result column="WHSJ" property="whsj" jdbcType="TIMESTAMP" />
    <result column="XFRDWID" property="xfrdwid" jdbcType="VARCHAR" />
    <result column="XFRID" property="xfrid" jdbcType="VARCHAR" />
    <result column="XFSJ" property="xfsj" jdbcType="TIMESTAMP" />
    <result column="WGFKRDWID" property="wgfkrdwid" jdbcType="VARCHAR" />
    <result column="WGFKRID" property="wgfkrid" jdbcType="VARCHAR" />
    <result column="WGFKSJ" property="wgfksj" jdbcType="TIMESTAMP" />
    <result column="GBRID" property="gbrid" jdbcType="VARCHAR" />
    <result column="GBRQ" property="gbrq" jdbcType="TIMESTAMP" />
    <result column="GBYY" property="gbyy" jdbcType="VARCHAR" />
    <result column="ZDBMID" property="zdbmid" jdbcType="VARCHAR" />
    <result column="ZDRID" property="zdrid" jdbcType="VARCHAR" />
    <result column="ZDRQ" property="zdrq" jdbcType="TIMESTAMP" />
    <result column="ZT" property="zt" jdbcType="DECIMAL" />
    <result column="XMBLBS" property="xmblbs" jdbcType="DECIMAL" />
    <result column="WGBS" property="wgbs" jdbcType="DECIMAL" />
    <result column="JKSJID" property="jksjid" jdbcType="VARCHAR" />
    <result column="GBID" property="gbid" jdbcType="VARCHAR" />
    <result column="GKID" property="gkid" jdbcType="VARCHAR" />
    <result column="GKBH" property="gkbh" jdbcType="VARCHAR" />
    <result column="DJBGDID" property="djbgdid" jdbcType="VARCHAR" />
    <result column="GDBH" property="gdbh" jdbcType="VARCHAR" />
    <result column="GDLX" property="gdlx" jdbcType="DECIMAL" />
    <result column="GDBT" property="gdbt" jdbcType="VARCHAR" />
    <result column="LYRWID" property="lyrwid" jdbcType="VARCHAR" />
    <result column="LYRWH" property="lyrwh" jdbcType="VARCHAR" />
    <result column="FJJX" property="fjjx" jdbcType="VARCHAR" />
    <result column="FJZCH" property="fjzch" jdbcType="VARCHAR" />
    <result column="FJXLH" property="fjxlh" jdbcType="VARCHAR" />
    <result column="ZJH" property="zjh" jdbcType="VARCHAR" />
    <result column="BJBS" property="bjbs" jdbcType="DECIMAL" />
    <result column="BGRID" property="bgrid" jdbcType="VARCHAR" />
    <result column="BGR" property="bgr" jdbcType="VARCHAR" />
    <result column="KDRQ" property="kdrq" jdbcType="TIMESTAMP" />
    <result column="JH_KSRQ" property="jhKsrq" jdbcType="TIMESTAMP" />
    <result column="JH_JSRQ" property="jhJsrq" jdbcType="TIMESTAMP" />
    <result column="ZY" property="zy" jdbcType="VARCHAR" />
    <result column="GZLB" property="gzlb" jdbcType="VARCHAR" />
    <result column="JHGS_RS" property="jhgsRs" jdbcType="DECIMAL" />
    <result column="JHGS_XSS" property="jhgsXss" jdbcType="DECIMAL" />
    <result column="JH_ZD" property="jhZd" jdbcType="VARCHAR" />
    <result column="GZZID" property="gzzid" jdbcType="VARCHAR" />
    <result column="YBGS" property="ybgs" jdbcType="VARCHAR" />
    <result column="QXMS" property="qxms" jdbcType="VARCHAR" />
    <result column="JYCLFA" property="jyclfa" jdbcType="VARCHAR" />
    <result column="GZNRFJID" property="gznrfjid" jdbcType="VARCHAR" />
    <result column="WGFKFJID" property="wgfkfjid" jdbcType="VARCHAR" />
    <result column="SJ_KSRQ" property="sjKsrq" jdbcType="TIMESTAMP" />
    <result column="SJ_JSRQ" property="sjJsrq" jdbcType="TIMESTAMP" />
    <result column="SJ_GZZ" property="sjGzz" jdbcType="VARCHAR" />
    <result column="SJ_JCZ" property="sjJcz" jdbcType="VARCHAR" />
    <result column="SJ_GS" property="sjGs" jdbcType="DECIMAL" />
    <result column="SJ_ZD" property="sjZd" jdbcType="VARCHAR" />
    <result column="GZXX" property="gzxx" jdbcType="VARCHAR" />
    <result column="CLCS" property="clcs" jdbcType="VARCHAR" />
    <result column="DQ_GZZID" property="dqGzzid" jdbcType="VARCHAR" />
    <result column="DQ_JDID" property="dqJdid" jdbcType="VARCHAR" />
    <result column="DQ_ZXZT" property="dqZxzt" jdbcType="VARCHAR" />
    <result column="DQ_ZXZZT" property="dqZxzzt" jdbcType="VARCHAR" />
    <result column="DXFBS" property="dxfbs" jdbcType="DECIMAL" />
    <result column="SJ_JCZID" property="sjJczid" jdbcType="VARCHAR" />
    
    <result column="zjhzwms" property="paramsMap.zjhzwms" jdbcType="VARCHAR" /><!-- 章节号中文名称 -->
    <result column="zjhywms" property="paramsMap.zjhywms" jdbcType="VARCHAR" /><!-- 章节号英文名称-->
    <result column="GKBZ" property="paramsMap.gkbz" jdbcType="VARCHAR" /><!-- 工卡备注-->
    <result column="GBRNAME" property="paramsMap.gbrname" jdbcType="VARCHAR" /><!-- 关闭人-->
    <result column="WOATTACHCOUNT" property="paramsMap.woAttachCount" jdbcType="VARCHAR" /><!-- 工单附件数量 -->
    <result column="CARDATTACHCOUNT" property="paramsMap.cardAttachCount" jdbcType="VARCHAR" /><!-- 工卡附件数量 -->
    <result column="CARDGZNRFJID" property="paramsMap.cardGznrfjid" jdbcType="VARCHAR" /><!-- 工卡,工作内容附件id -->
    <result column="CARDFJID" property="paramsMap.cardFjid" jdbcType="VARCHAR" /><!-- 工卡,工作内容附件id -->
    <result column="WHRBH" property="paramsMap.whrbh" jdbcType="VARCHAR" /><!-- 维护人编号 -->
    <result column="WHRXM" property="paramsMap.whrxm" jdbcType="VARCHAR" /><!-- 维护人姓名 -->
    <result column="WGPGBBH" property="paramsMap.gbbh" jdbcType="VARCHAR" /><!-- 工包编号-->
    <result column="KZ_JHGS" property="paramsMap.jhgs" jdbcType="VARCHAR" /><!-- 工包编号-->
   <result column="fjjx" property="paramsMap.fjjx" jdbcType="VARCHAR" /><!-- 飞机机型 -->
   <result column="fdjsl" property="paramsMap.fdjsl" jdbcType="INTEGER" /><!--发动机数量 -->
   <result column="PRINTCOUNT" property="paramsMap.printCount" jdbcType="INTEGER" /><!--发动机数量 -->
    <result column="qy" property="paramsMap.qy" jdbcType="VARCHAR" /><!-- 飞机机型 -->
  </resultMap>
  
  <!-- 配置WO关系 注意：在写对应关系时,id字段需要重命名 -->
  <resultMap type="com.eray.thjw.produce.po.Workorder145" id="WOWithRelMap" extends="BaseResultMap">
   		<!--  配置WO与工作内容附件关系 -->
	    <association property="workContentAttachment" javaType="com.eray.thjw.flightdata.po.Attachment">  
	        <id column="WTA_ID" property="id" jdbcType="VARCHAR" />
		    <result column="WTA_MAINID" property="mainid" jdbcType="VARCHAR" />
		    <result column="WTA_DPRTCODE" property="dprtcode" jdbcType="VARCHAR" />
		    <result column="WTA_YSWJM" property="yswjm" jdbcType="VARCHAR" />
		    <result column="WTA_WBWJM" property="wbwjm" jdbcType="VARCHAR" />
		    <result column="WTA_NBWJM" property="nbwjm" jdbcType="VARCHAR" />
		    <result column="WTA_WJDX" property="wjdx" jdbcType="DECIMAL" />
		    <result column="WTA_CFLJ" property="cflj" jdbcType="VARCHAR" />
		    <result column="WTA_HZM" property="hzm" jdbcType="VARCHAR" />
	    </association>
	    
	    <!-- 配置工卡与章节号关系 -->
	    <association property="fixChapter" javaType="com.eray.thjw.po.FixChapter">
	    	<id column="F_ZJH" property="zjh" jdbcType="VARCHAR"/>
	     	<result column="F_ZWMS" property="zwms" jdbcType="VARCHAR"/>
	        <result column="F_YWMS" property="ywms" jdbcType="VARCHAR"/>
	    </association>
	    
	    <!-- 配置WO与工包关系 -->
	    <association property="workpackage145" javaType="com.eray.thjw.produce.po.Workpackage145">
	    	<id column="WPG_ID" property="id" jdbcType="VARCHAR"/>
	     	<result column="WPG_GBBH" property="gbbh" jdbcType="VARCHAR"/>
	     	<result column="WPG_ZXDW" property="zxdw" jdbcType="VARCHAR"/>
	     	<result column="WPG_WBBS" property="wbbs" jdbcType="INTEGER"/>
	    </association>
	    
	    <!-- 下发人所在单位 -->
	    <association property="xfrDepartment" javaType="com.eray.thjw.po.Department">
	    	<id column="XFRDW_ID" property="id" jdbcType="VARCHAR"/>
	     	<result column="XFRDW_NAME" property="dprtname" jdbcType="VARCHAR"/>
	    </association>
	    
	    <!-- 区域、飞机站位、接近 -->
	    <collection property="coverPlateList" ofType="com.eray.thjw.project2.po.CoverPlate">  
		    <id column="CP_ID" property="id" jdbcType="VARCHAR" />
		    <result column="CP_LX" property="lx" jdbcType="DECIMAL" />
		    <result column="CP_GBID" property="gbid" jdbcType="VARCHAR" />
		    <result column="CP_GBH" property="gbh" jdbcType="VARCHAR" />
		    <association property="coverPlateInformation" javaType="com.eray.thjw.basic.po.CoverPlateInformation">
		    	<id column="CPI_ID" property="id"/>
		     	<result column="CPI_GBBH" property="gbbh"/>
		        <result column="CPI_GBMC" property="gbmc"/>
		    </association>
        </collection>
        <collection property="workers" ofType="com.eray.thjw.produce.po.WorkOrder145Worker">  
		    <id column="WORKERID" property="id" jdbcType="VARCHAR" />
		    <result column="WORKERGZZ" property="gzz" jdbcType="VARCHAR" />
		    <result column="WORKERGZZID" property="gzzid" jdbcType="VARCHAR" />
		</collection>
        <collection property="woIORecordList" ofType="com.eray.thjw.produce.po.Workorder145IORecord">
		    	<id column="RECID" jdbcType="VARCHAR" property="id" />
			    <result column="RECMAINID" jdbcType="VARCHAR" property="mainid" />
			    <result column="RECZT" jdbcType="DECIMAL" property="zt" />
			    <result column="RECWHDWID" jdbcType="VARCHAR" property="whdwid" />
			    <result column="RECWHRID" jdbcType="VARCHAR" property="whrid" />
			    <result column="RECWHSJ" jdbcType="TIMESTAMP" property="whsj" />
			    <result column="RECCX_BS" jdbcType="DECIMAL" property="cxBs" />
			    <result column="RECCX_ZJQDID" jdbcType="VARCHAR" property="cxZjqdid" />
			    <result column="RECCX_SJ" jdbcType="TIMESTAMP" property="cxSj" />
			    <result column="RECCX_BZ" jdbcType="VARCHAR" property="cxBz" />
			    <result column="RECCX_WCKCID" jdbcType="VARCHAR" property="cxWckcid" />
			    <result column="RECCX_KCLVID" jdbcType="VARCHAR" property="cxKclvid" />
			    <result column="RECZS_BS" jdbcType="DECIMAL" property="zsBs" />
			    <result column="RECZRS_ZJQDID" jdbcType="VARCHAR" property="zsZjqdid" />
			    <result column="RECZS_SJ" jdbcType="TIMESTAMP" property="zsSj" />
			    <result column="RECZS_BZ" jdbcType="VARCHAR" property="zsBz" />
			    <result column="RECZS_WCKCID" jdbcType="VARCHAR" property="zsWckcid" />
			    <result column="RECZS_KCLVID" jdbcType="VARCHAR" property="zsKclvid" />
			    <result column="RECBZ" jdbcType="VARCHAR" property="bz" />
			    <result column="RECCX_BJH" property="cxBjh" jdbcType="VARCHAR" />
			    <result column="RECCX_XLH" property="cxXlh" jdbcType="VARCHAR" />
			    <result column="RECCX_PCH" property="cxPch" jdbcType="VARCHAR" />
			    <result column="RECCX_CJSL" property="cxCjsl" jdbcType="DECIMAL" />
			    <result column="RECCX_BJZWMC" property="cxBjzwmc" jdbcType="VARCHAR" />
			    <result column="RECCX_BJYWMC" property="cxBjywmc" jdbcType="VARCHAR" />
			    <result column="RECCX_WZ" property="cxWz" jdbcType="DECIMAL" />
			    <result column="RECZRRID" property="zrrid" jdbcType="VARCHAR" />
			    <result column="RECZRR" property="zrr" jdbcType="VARCHAR" />
			    <association property="zsj" javaType="com.eray.thjw.produce.po.InstallationListTemp">  
			    	<id column="ZSJID" jdbcType="VARCHAR" property="id" />
				    <result column="ZSJDPRTCODE" jdbcType="VARCHAR" property="dprtcode" />
				    <result column="ZSJXGZJQDID" jdbcType="VARCHAR" property="xgzjqdid" />
				    <result column="ZSJJX" jdbcType="VARCHAR" property="jx" />
				    <result column="ZSJFJZCH" jdbcType="VARCHAR" property="fjzch" />
				    <result column="ZSJWZ" jdbcType="DECIMAL" property="wz" />
				    <result column="ZSJCJ" jdbcType="DECIMAL" property="cj" />
				    <result column="ZSJFJDID" jdbcType="VARCHAR" property="fjdid" />
				    <result column="ZSJBJH" jdbcType="VARCHAR" property="bjh" />
				    <result column="ZSJZWMC" jdbcType="VARCHAR" property="zwmc" />
				    <result column="ZSJYWMC" jdbcType="VARCHAR" property="ywmc" />
				    <result column="ZSJCJJH" jdbcType="VARCHAR" property="cjjh" />
				    <result column="ZSJXH" jdbcType="VARCHAR" property="xh" />
				    <result column="ZSJZJH" jdbcType="VARCHAR" property="zjh" />
				    <result column="ZSJJLDW" jdbcType="VARCHAR" property="jldw" />
				    <result column="ZSJXLH" jdbcType="VARCHAR" property="xlh" />
				    <result column="ZSJPCH" jdbcType="VARCHAR" property="pch" />
				    <result column="ZSJZJSL" jdbcType="DECIMAL" property="zjsl" />
				    <result column="ZSJLLKLX" jdbcType="DECIMAL" property="llklx" />
				    <result column="ZSJLLKBH" jdbcType="VARCHAR" property="llkbh" />
				    <result column="ZSJFJZW" jdbcType="VARCHAR" property="fjzw" />
				    <result column="ZSJCHUCRQ" jdbcType="TIMESTAMP" property="chucrq" />
				    <result column="ZSJTSN" jdbcType="VARCHAR" property="tsn" />
				    <result column="ZSJTSO" jdbcType="VARCHAR" property="tso" />
				    <result column="ZSJCSN" jdbcType="DECIMAL" property="csn" />
				    <result column="ZSJCSO" jdbcType="DECIMAL" property="cso" />
				    <result column="ZSJBJGZJL" jdbcType="VARCHAR" property="bjgzjl" />
				    <result column="ZSJBZ" jdbcType="VARCHAR" property="bz" />
				    <result column="ZSJSKBS" jdbcType="DECIMAL" property="skbs" />
				    <result column="ZSJSSBS" jdbcType="DECIMAL" property="ssbs" />
				    <result column="ZSJAZSJ" jdbcType="TIMESTAMP" property="azsj" />
				    <result column="ZSJAZR" jdbcType="VARCHAR" property="azr" />
				    <result column="ZSJAZRID" jdbcType="VARCHAR" property="azrid" />
				    <result column="ZSJAZBZ" jdbcType="VARCHAR" property="azbz" />
				    <result column="ZJHNAME" jdbcType="VARCHAR" property="paramsMap.zjhname" />
				    <association property="parent" javaType="com.eray.thjw.produce.po.InstallationListTemp">
				    	<id column="ZSJPARID" property="id" jdbcType="VARCHAR"/>
					    <result column="ZSJPARWZ" property="wz" jdbcType="DECIMAL" />
					    <result column="ZSJPARCJ" property="cj" jdbcType="DECIMAL" />
					    <result column="ZSJPARBJH" property="bjh" jdbcType="VARCHAR" />
					    <result column="ZSJPARZWMC" property="zwmc" jdbcType="VARCHAR" />
					    <result column="ZSJPARYWMC" property="ywmc" jdbcType="VARCHAR" />
					    <result column="ZSJPARCJJH" property="cjjh" jdbcType="VARCHAR" />
					    <result column="ZSJPARXLH" property="xlh" jdbcType="VARCHAR" />
					    <result column="ZSJPARPCH" property="pch" jdbcType="VARCHAR" />
				    </association>
				    <collection property="initDatas" ofType="com.eray.thjw.produce.po.InstallationListTemp2Init">  
					    <id column="ZSJINITID" property="id" jdbcType="VARCHAR" />
					    <result column="ZSJINITJKLBH" property="jklbh" jdbcType="VARCHAR" />
					    <result column="ZSJINITJKFLBH" property="jkflbh" jdbcType="VARCHAR" />
					    <result column="ZSJINITCSZ" property="csz" jdbcType="VARCHAR" />
				    </collection>
			    </association>
			    <association property="cxj" javaType="com.eray.thjw.produce.po.InstallationListEditable">  
			    	<id column="CXJID" property="id" jdbcType="VARCHAR" />
				    <result column="CXJWZ" property="wz" jdbcType="DECIMAL" />
				    <result column="CXJCJ" property="cj" jdbcType="DECIMAL" />
				    <result column="CXJBJH" property="bjh" jdbcType="VARCHAR" />
				    <result column="CXJZWMC" property="zwmc" jdbcType="VARCHAR" />
				    <result column="CXJYWMC" property="ywmc" jdbcType="VARCHAR" />
				    <result column="CXJXLH" property="xlh" jdbcType="VARCHAR" />
				    <result column="CXJPCH" property="pch" jdbcType="VARCHAR" />
			    </association>
		    </collection>
  </resultMap>
  
  <sql id="Base_Column_List" >
    ID, GDSBID, DPRTCODE, WHDWID, WHRID, WHSJ, XFRDWID, XFRID, XFSJ, WGFKRDWID, WGFKRID, 
    WGFKSJ, GBRID, GBRQ, GBYY, ZDBMID, ZDRID, ZDRQ, ZT, XMBLBS, WGBS, JKSJID, GBID, GKID, 
    GKBH, DJBGDID, GDBH, GDLX, GDBT, LYRWID, LYRWH, FJJX, FJZCH, FJXLH, ZJH, BJBS, BGRID, BGR, KDRQ, 
    JH_KSRQ, JH_JSRQ, ZY, GZLB, JHGS_RS, JHGS_XSS, JH_ZD, GZZID, YBGS, QXMS, JYCLFA, 
    GZNRFJID, WGFKFJID, SJ_KSRQ, SJ_JSRQ, SJ_GZZ, SJ_JCZ, SJ_GS, SJ_ZD, GZXX, CLCS, DQ_GZZID, 
    DQ_JDID, DQ_ZXZT, DQ_ZXZZT, DXFBS, SJ_JCZID
  </sql>
  
  <sql id="WO145_Column_List" >
    B.ID, B.GDSBID, B.DPRTCODE, B.WHDWID, B.WHRID, B.WHSJ, B.XFRDWID, B.XFRID, B.XFSJ, B.WGFKRDWID, B.WGFKRID, 
    B.WGFKSJ, B.GBRID, B.GBRQ, B.GBYY, B.ZDBMID, B.ZDRID, B.ZDRQ, B.ZT, B.XMBLBS, B.WGBS, B.JKSJID, B.GBID, B.GKID, 
    B.GKBH, B.DJBGDID, B.GDBH, B.GDLX, B.GDBT, B.LYRWID, B.LYRWH, B.FJJX, B.FJZCH, B.FJXLH, B.ZJH, B.BJBS, B.BGRID, B.BGR, B.KDRQ, 
    B.JH_KSRQ, B.JH_JSRQ, B.ZY, B.GZLB, B.JHGS_RS, B.JHGS_XSS, B.JH_ZD, B.GZZID, B.YBGS, B.QXMS, B.JYCLFA, 
    B.GZNRFJID, B.WGFKFJID, B.SJ_KSRQ, B.SJ_JSRQ, B.SJ_GZZ, B.SJ_JCZ, B.SJ_GS, B.SJ_ZD, B.GZXX, B.CLCS, B.DQ_GZZID, 
    B.DQ_JDID, B.DQ_ZXZT, B.DQ_ZXZZT, B.DXFBS, B.SJ_JCZID
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from B_S2_014
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  
  <!-- 工单145信息查询 -->
  <select id="queryAllList" parameterType="com.eray.thjw.produce.po.Workorder145" resultMap="BaseResultMap">
  		select   B1.ID, B1.DPRTCODE, B1.GDBH, B1.GDLX, B1.GDBT, B1.LYRWID, B1.LYRWH, B1.FJZCH,B1.GKBH,
      B1.JH_KSRQ, B1.JH_JSRQ, B1.ZT,b2.bz GKBZ
     from B_S2_014 B1 
     left join b_g2_013 b2 on b1.gkid=b2.id
		 where B1.ZT in(${paramsMap.ztList}) AND B1.GDLX in (1,2,3,4,5) AND B1.FJZCH = #{fjzch, jdbcType=VARCHAR} AND B1.DPRTCODE =  #{dprtcode, jdbcType=VARCHAR}
	      <if test="keyword != null and keyword != ''">
		     AND (UPPER(gdbh) LIKE UPPER('%'||#{keyword}||'%')
		     	 )              <!-- 左右匹配 查询关键字 -->
		  </if>
		  <!-- 前台条件：飞机，机型，sql需要全部的范围，以及带上当前记录的机构码 -->
        <choose>                                                                 
	    	<when test='paramsMap.userType!=null and paramsMap.userType == "admin"'>                       
	    		 AND exists 
	    		( SELECT 1 from D_007 where 
	    		B1.FJZCH = FJZCH
	    		AND B1.DPRTCODE = DPRTCODE
	    		AND ZT = 1
	    		)
	    	</when>
	    	<when test='paramsMap.userType != "admin" and paramsMap.userId != null and paramsMap.userId !=""'>                       
	    	</when>
   		 </choose>
	     <choose><!--  进行排序判断，如果默认就是默认字段排序 -->
	    	<when test='pagination.sort == "auto"'>                       
	    		order by zdrq desc
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
		 </choose>
  </select>
  
    <!-- 工种完工注水图 -->
  <select id="queryDiagramList" parameterType="com.eray.thjw.produce.po.Workorder145" resultType="map">
	  	SELECT S2014.GBID RID_, <!-- 工包ID -->
	       TWORKGROUP.GZZMC, <!-- 工作组 -->
	       S2014.DPRTCODE, <!-- 机构代码 -->
	       COALESCE(S2014.NUM_ZJ, 0) NUM_ZJ, <!-- 总计数量 -->
	       COALESCE(S2014.NUM_WC, 0) NUM_WC, <!-- 完成数量 -->
	       ROUND(COALESCE(S2014.NUM_WC, 0) / COALESCE(S2014.NUM_ZJ, 1) * 100, 2) WCL <!-- 完成率（保留两位小数） -->
	  FROM (SELECT S2014.GBID,
	               S2014.DQ_GZZID,
	               S2014.DPRTCODE,
	               COUNT(1) NUM_ZJ,
	               COALESCE(SUM(WGBS), 0) NUM_WC
	          FROM (SELECT S2014.GBID,
	                       S2014.DQ_GZZID,
	                       S2014.DPRTCODE,
	                       CASE
	                         WHEN S2014.ZT IN (9, 10) OR S2014.WGBS = 1 OR
	                              S2014.DQ_ZXZT IN ('Complete', 'Cancel', 'Defer') THEN
	                          1
	                         ELSE
	                          0
	                       END WGBS <!-- 完工标识：0未完工、1完工 -->
	                  FROM B_S2_014 S2014
	                 WHERE 1 = 1
	                   AND S2014.GBID = #{id, jdbcType=VARCHAR}) S2014
	         WHERE 1 = 1
	         GROUP BY S2014.GBID, S2014.DQ_GZZID, S2014.DPRTCODE) S2014
	  JOIN T_WORKGROUP TWORKGROUP
	    ON TWORKGROUP.ID = S2014.DQ_GZZID
	 WHERE 1 = 1
	 ORDER BY TWORKGROUP.GZZDM ASC
  </select>
  
   <!--工种执行进度图 -->
  <select id="queryProgressList" parameterType="com.eray.thjw.produce.po.Workorder145" resultType="map">
		 SELECT T1.RID_, <!-- 工包ID -->
       T1.STAGEID_, <!-- 阶段 -->
        S2014.JDBH,
       T1.ORIGNALDATE_, <!-- STAGE开始时间 -->
       T1.LASTESTDATE_, <!-- STAGE结束时间 -->
       T1.DPRTCODE, <!-- 机构代码 -->
       COALESCE(S2014.NUM_ZJ, 0) NUM_ZJ, <!-- 总计数量 -->
       COALESCE(S2014.NUM_WC, 0) NUM_WC, <!-- 完成数量 -->
       ROUND(COALESCE(S2014.NUM_WC, 0) / COALESCE(S2014.NUM_ZJ, 1) * 100, 2) WCL <!-- 完成率（保留两位小数） -->
  FROM PBS_STAGETRANSACTION T1
   JOIN (SELECT S2014.STAGEID_,
                    S2014.DPRTCODE,
                    COUNT(1) NUM_ZJ,
                    D024.JDBH,
                    COALESCE(SUM(WGBS), 0) NUM_WC
               FROM (SELECT S2014.DQ_JDID STAGEID_,
                            S2014.DPRTCODE,
                            CASE
                              WHEN S2014.ZT IN (9, 10) OR S2014.WGBS = 1 OR
                                   S2014.DQ_ZXZT IN
                                   ('Complete', 'Cancel', 'Defer') THEN
                               1
                              ELSE
                               0
                            END WGBS <!-- 完工标识：0未完工、1完工 -->
                       FROM B_S2_014 S2014
                      WHERE 1 = 1
                        AND S2014.GBID = #{id, jdbcType=VARCHAR}) S2014
                        LEFT JOIN D_024 D024 ON S2014.STAGEID_=D024.ID
              WHERE 1 = 1
             GROUP BY S2014.STAGEID_, S2014.DPRTCODE, D024.JDBH) S2014
    ON T1.DPRTCODE = S2014.DPRTCODE
   AND T1.STAGEID_ = S2014.STAGEID_
   AND T1.RID_ = #{id, jdbcType=VARCHAR}
 WHERE 1 = 1
 ORDER BY T1.STAGEID_ ASC
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from B_S2_014
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.eray.thjw.produce.po.Workorder145" >
    insert into B_S2_014 (ID, GDSBID, DPRTCODE, 
      WHDWID, WHRID, WHSJ, 
      XFRDWID, XFRID, XFSJ, 
      WGFKRDWID, WGFKRID, WGFKSJ, 
      GBRID, GBRQ, GBYY, 
      ZDBMID, ZDRID, ZDRQ, 
      ZT, XMBLBS, WGBS, JKSJID, 
      GBID, GKID, GKBH, DJBGDID, 
      GDBH, GDLX, GDBT, LYRWID, LYRWH,FJJX, 
      FJZCH, FJXLH, ZJH, 
      BJBS, BGRID, BGR, KDRQ, 
      JH_KSRQ, JH_JSRQ, ZY, 
      GZLB, JHGS_RS, JHGS_XSS, 
      JH_ZD, GZZID, YBGS, 
      QXMS, JYCLFA, GZNRFJID, 
      WGFKFJID, SJ_KSRQ, SJ_JSRQ, 
      SJ_GZZ, SJ_JCZ, SJ_GS, 
      SJ_ZD, GZXX, CLCS, DQ_GZZID, 
      DQ_JDID, DQ_ZXZT, DQ_ZXZZT, 
      DXFBS)
    values (#{id,jdbcType=VARCHAR}, #{gdsbid,jdbcType=VARCHAR}, #{dprtcode,jdbcType=VARCHAR}, 
      #{whdwid,jdbcType=VARCHAR}, #{whrid,jdbcType=VARCHAR}, #{whsj,jdbcType=TIMESTAMP}, 
      #{xfrdwid,jdbcType=VARCHAR}, #{xfrid,jdbcType=VARCHAR}, #{xfsj,jdbcType=TIMESTAMP}, 
      #{wgfkrdwid,jdbcType=VARCHAR}, #{wgfkrid,jdbcType=VARCHAR}, #{wgfksj,jdbcType=TIMESTAMP}, 
      #{gbrid,jdbcType=VARCHAR}, #{gbrq,jdbcType=TIMESTAMP}, #{gbyy,jdbcType=VARCHAR}, 
      #{zdbmid,jdbcType=VARCHAR}, #{zdrid,jdbcType=VARCHAR}, #{zdrq,jdbcType=TIMESTAMP}, 
      #{zt,jdbcType=DECIMAL}, #{xmblbs,jdbcType=DECIMAL}, #{wgbs,jdbcType=DECIMAL}, #{jksjid,jdbcType=VARCHAR}, 
      #{gbid,jdbcType=VARCHAR}, #{gkid,jdbcType=VARCHAR}, #{gkbh,jdbcType=VARCHAR}, #{djbgdid,jdbcType=VARCHAR}, 
      #{gdbh,jdbcType=VARCHAR}, #{gdlx,jdbcType=DECIMAL}, #{gdbt,jdbcType=VARCHAR}, #{lyrwid,jdbcType=VARCHAR}, #{lyrwh,jdbcType=VARCHAR},  
      #{fjjx,jdbcType=VARCHAR}, #{fjzch,jdbcType=VARCHAR}, #{fjxlh,jdbcType=VARCHAR}, #{zjh,jdbcType=VARCHAR}, 
      #{bjbs,jdbcType=DECIMAL}, #{bgrid,jdbcType=VARCHAR}, #{bgr,jdbcType=VARCHAR}, #{kdrq,jdbcType=TIMESTAMP}, 
      #{jhKsrq,jdbcType=TIMESTAMP}, #{jhJsrq,jdbcType=TIMESTAMP}, #{zy,jdbcType=VARCHAR}, 
      #{gzlb,jdbcType=VARCHAR}, #{jhgsRs,jdbcType=DECIMAL}, #{jhgsXss,jdbcType=DECIMAL}, 
      #{jhZd,jdbcType=VARCHAR}, #{gzzid,jdbcType=VARCHAR}, #{ybgs,jdbcType=VARCHAR}, 
      #{qxms,jdbcType=VARCHAR}, #{jyclfa,jdbcType=VARCHAR}, #{gznrfjid,jdbcType=VARCHAR}, 
      #{wgfkfjid,jdbcType=VARCHAR}, #{sjKsrq,jdbcType=TIMESTAMP}, #{sjJsrq,jdbcType=TIMESTAMP}, 
      #{sjGzz,jdbcType=VARCHAR}, #{sjJcz,jdbcType=VARCHAR}, #{sjGs,jdbcType=DECIMAL}, 
      #{sjZd,jdbcType=VARCHAR}, #{gzxx,jdbcType=VARCHAR}, #{clcs,jdbcType=VARCHAR}, #{dqGzzid,jdbcType=VARCHAR}, 
      #{dqJdid,jdbcType=VARCHAR}, #{dqZxzt,jdbcType=VARCHAR}, #{dqZxzzt,jdbcType=VARCHAR}, 
      #{dxfbs,jdbcType=DECIMAL})
  </insert>
  <insert id="insertSelective" parameterType="com.eray.thjw.produce.po.Workorder145" >
    insert into B_S2_014
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="gdsbid != null" >
        GDSBID,
      </if>
      <if test="dprtcode != null" >
        DPRTCODE,
      </if>
      <if test="whdwid != null" >
        WHDWID,
      </if>
      <if test="whrid != null" >
        WHRID,
      </if>
      <if test="whsj != null" >
        WHSJ,
      </if>
      <if test="xfrdwid != null" >
        XFRDWID,
      </if>
      <if test="xfrid != null" >
        XFRID,
      </if>
      <if test="xfsj != null" >
        XFSJ,
      </if>
      <if test="wgfkrdwid != null" >
        WGFKRDWID,
      </if>
      <if test="wgfkrid != null" >
        WGFKRID,
      </if>
      <if test="wgfksj != null" >
        WGFKSJ,
      </if>
      <if test="gbrid != null" >
        GBRID,
      </if>
      <if test="gbrq != null" >
        GBRQ,
      </if>
      <if test="gbyy != null" >
        GBYY,
      </if>
      <if test="zdbmid != null" >
        ZDBMID,
      </if>
      <if test="zdrid != null" >
        ZDRID,
      </if>
      <if test="zdrq != null" >
        ZDRQ,
      </if>
      <if test="zt != null" >
        ZT,
      </if>
      <if test="xmblbs != null" >
        XMBLBS,
      </if>
      <if test="wgbs != null" >
        WGBS,
      </if>
      <if test="jksjid != null" >
        JKSJID,
      </if>
      <if test="gbid != null" >
        GBID,
      </if>
      <if test="gkid != null" >
        GKID,
      </if>
      <if test="gkbh != null" >
        GKBH,
      </if>
      <if test="djbgdid != null" >
        DJBGDID,
      </if>
      <if test="gdbh != null" >
        GDBH,
      </if>
      <if test="gdlx != null" >
        GDLX,
      </if>
      <if test="gdbt != null" >
        GDBT,
      </if>
      <if test="fjjx != null" >
        FJJX,
      </if>
      <if test="fjzch != null" >
        FJZCH,
      </if>
      <if test="fjxlh != null" >
        FJXLH,
      </if>
      <if test="zjh != null" >
        ZJH,
      </if>
      <if test="bjbs != null" >
        BJBS,
      </if>
      <if test="bgrid != null" >
        BGRID,
      </if>
      <if test="bgr != null" >
        BGR,
      </if>
      <if test="kdrq != null" >
        KDRQ,
      </if>
      <if test="jhKsrq != null" >
        JH_KSRQ,
      </if>
      <if test="jhJsrq != null" >
        JH_JSRQ,
      </if>
      <if test="zy != null" >
        ZY,
      </if>
      <if test="gzlb != null" >
        GZLB,
      </if>
      <if test="jhgsRs != null" >
        JHGS_RS,
      </if>
      <if test="jhgsXss != null" >
        JHGS_XSS,
      </if>
      <if test="jhZd != null" >
        JH_ZD,
      </if>
      <if test="gzzid != null" >
        GZZID,
      </if>
      <if test="ybgs != null" >
        YBGS,
      </if>
      <if test="qxms != null" >
        QXMS,
      </if>
      <if test="jyclfa != null" >
        JYCLFA,
      </if>
      <if test="gznrfjid != null" >
        GZNRFJID,
      </if>
      <if test="wgfkfjid != null" >
        WGFKFJID,
      </if>
      <if test="sjKsrq != null" >
        SJ_KSRQ,
      </if>
      <if test="sjJsrq != null" >
        SJ_JSRQ,
      </if>
      <if test="sjGzz != null" >
        SJ_GZZ,
      </if>
      <if test="sjJcz != null" >
        SJ_JCZ,
      </if>
      <if test="sjGs != null" >
        SJ_GS,
      </if>
      <if test="sjZd != null" >
        SJ_ZD,
      </if>
      <if test="gzxx != null" >
        GZXX,
      </if>
      <if test="clcs != null" >
        CLCS,
      </if>
      <if test="dqGzzid != null" >
        DQ_GZZID,
      </if>
      <if test="dqJdid != null" >
        DQ_JDID,
      </if>
      <if test="dqZxzt != null" >
        DQ_ZXZT,
      </if>
      <if test="dqZxzzt != null" >
        DQ_ZXZZT,
      </if>
      <if test="dxfbs != null" >
        DXFBS,
      </if>
      <if test="lyrwid != null">
        LYRWID,
      </if>
      <if test="lyrwh != null">
        LYRWH,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="gdsbid != null" >
        #{gdsbid,jdbcType=VARCHAR},
      </if>
      <if test="dprtcode != null" >
        #{dprtcode,jdbcType=VARCHAR},
      </if>
      <if test="whdwid != null" >
        #{whdwid,jdbcType=VARCHAR},
      </if>
      <if test="whrid != null" >
        #{whrid,jdbcType=VARCHAR},
      </if>
      <if test="whsj != null" >
        #{whsj,jdbcType=TIMESTAMP},
      </if>
      <if test="xfrdwid != null" >
        #{xfrdwid,jdbcType=VARCHAR},
      </if>
      <if test="xfrid != null" >
        #{xfrid,jdbcType=VARCHAR},
      </if>
      <if test="xfsj != null" >
        #{xfsj,jdbcType=TIMESTAMP},
      </if>
      <if test="wgfkrdwid != null" >
        #{wgfkrdwid,jdbcType=VARCHAR},
      </if>
      <if test="wgfkrid != null" >
        #{wgfkrid,jdbcType=VARCHAR},
      </if>
      <if test="wgfksj != null" >
        #{wgfksj,jdbcType=TIMESTAMP},
      </if>
      <if test="gbrid != null" >
        #{gbrid,jdbcType=VARCHAR},
      </if>
      <if test="gbrq != null" >
        #{gbrq,jdbcType=TIMESTAMP},
      </if>
      <if test="gbyy != null" >
        #{gbyy,jdbcType=VARCHAR},
      </if>
      <if test="zdbmid != null" >
        #{zdbmid,jdbcType=VARCHAR},
      </if>
      <if test="zdrid != null" >
        #{zdrid,jdbcType=VARCHAR},
      </if>
      <if test="zdrq != null" >
        #{zdrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zt != null" >
        #{zt,jdbcType=DECIMAL},
      </if>
      <if test="xmblbs != null" >
        #{xmblbs,jdbcType=DECIMAL},
      </if>
      <if test="wgbs != null" >
        #{wgbs,jdbcType=DECIMAL},
      </if>
      <if test="jksjid != null" >
        #{jksjid,jdbcType=VARCHAR},
      </if>
      <if test="gbid != null" >
        #{gbid,jdbcType=VARCHAR},
      </if>
      <if test="gkid != null" >
        #{gkid,jdbcType=VARCHAR},
      </if>
      <if test="gkbh != null" >
        #{gkbh,jdbcType=VARCHAR},
      </if>
      <if test="djbgdid != null" >
        #{djbgdid,jdbcType=VARCHAR},
      </if>
      <if test="gdbh != null" >
        #{gdbh,jdbcType=VARCHAR},
      </if>
      <if test="gdlx != null" >
        #{gdlx,jdbcType=DECIMAL},
      </if>
      <if test="gdbt != null" >
        #{gdbt,jdbcType=VARCHAR},
      </if>
      <if test="fjjx != null" >
        #{fjjx,jdbcType=VARCHAR},
      </if>
      <if test="fjzch != null" >
        #{fjzch,jdbcType=VARCHAR},
      </if>
      <if test="fjxlh != null" >
        #{fjxlh,jdbcType=VARCHAR},
      </if>
      <if test="zjh != null" >
        #{zjh,jdbcType=VARCHAR},
      </if>
      <if test="bjbs != null" >
        #{bjbs,jdbcType=DECIMAL},
      </if>
      <if test="bgrid != null" >
        #{bgrid,jdbcType=VARCHAR},
      </if>
      <if test="bgr != null" >
        #{bgr,jdbcType=VARCHAR},
      </if>
      <if test="kdrq != null" >
        #{kdrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jhKsrq != null" >
        #{jhKsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jhJsrq != null" >
        #{jhJsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zy != null" >
        #{zy,jdbcType=VARCHAR},
      </if>
      <if test="gzlb != null" >
        #{gzlb,jdbcType=VARCHAR},
      </if>
      <if test="jhgsRs != null" >
        #{jhgsRs,jdbcType=DECIMAL},
      </if>
      <if test="jhgsXss != null" >
        #{jhgsXss,jdbcType=DECIMAL},
      </if>
      <if test="jhZd != null" >
        #{jhZd,jdbcType=VARCHAR},
      </if>
      <if test="gzzid != null" >
        #{gzzid,jdbcType=VARCHAR},
      </if>
      <if test="ybgs != null" >
        #{ybgs,jdbcType=VARCHAR},
      </if>
      <if test="qxms != null" >
        #{qxms,jdbcType=VARCHAR},
      </if>
      <if test="jyclfa != null" >
        #{jyclfa,jdbcType=VARCHAR},
      </if>
      <if test="gznrfjid != null" >
        #{gznrfjid,jdbcType=VARCHAR},
      </if>
      <if test="wgfkfjid != null" >
        #{wgfkfjid,jdbcType=VARCHAR},
      </if>
      <if test="sjKsrq != null" >
        #{sjKsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="sjJsrq != null" >
        #{sjJsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="sjGzz != null" >
        #{sjGzz,jdbcType=VARCHAR},
      </if>
      <if test="sjJcz != null" >
        #{sjJcz,jdbcType=VARCHAR},
      </if>
      <if test="sjGs != null" >
        #{sjGs,jdbcType=DECIMAL},
      </if>
      <if test="sjZd != null" >
        #{sjZd,jdbcType=VARCHAR},
      </if>
      <if test="gzxx != null" >
        #{gzxx,jdbcType=VARCHAR},
      </if>
      <if test="clcs != null" >
        #{clcs,jdbcType=VARCHAR},
      </if>
      <if test="dqGzzid != null" >
        #{dqGzzid,jdbcType=VARCHAR},
      </if>
      <if test="dqJdid != null" >
        #{dqJdid,jdbcType=VARCHAR},
      </if>
      <if test="dqZxzt != null" >
        #{dqZxzt,jdbcType=VARCHAR},
      </if>
      <if test="dqZxzzt != null" >
        #{dqZxzzt,jdbcType=VARCHAR},
      </if>
      <if test="dxfbs != null" >
        #{dxfbs,jdbcType=DECIMAL},
      </if>
      <if test="lyrwid != null">
        #{lyrwid,jdbcType=VARCHAR},
      </if>
      <if test="lyrwh != null">
        #{lyrwh,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.eray.thjw.produce.po.Workorder145" >
    update B_S2_014
    <set >
      <if test="gdsbid != null" >
        GDSBID = #{gdsbid,jdbcType=VARCHAR},
      </if>
      <if test="dprtcode != null" >
        DPRTCODE = #{dprtcode,jdbcType=VARCHAR},
      </if>
      <if test="whdwid != null" >
        WHDWID = #{whdwid,jdbcType=VARCHAR},
      </if>
      <if test="whrid != null" >
        WHRID = #{whrid,jdbcType=VARCHAR},
      </if>
      <if test="whsj != null" >
        WHSJ = #{whsj,jdbcType=TIMESTAMP},
      </if>
      <if test="xfrdwid != null" >
        XFRDWID = #{xfrdwid,jdbcType=VARCHAR},
      </if>
      <if test="xfrid != null" >
        XFRID = #{xfrid,jdbcType=VARCHAR},
      </if>
      <if test="xfsj != null" >
        XFSJ = #{xfsj,jdbcType=TIMESTAMP},
      </if>
      <if test="wgfkrdwid != null" >
        WGFKRDWID = #{wgfkrdwid,jdbcType=VARCHAR},
      </if>
      <if test="wgfkrid != null" >
        WGFKRID = #{wgfkrid,jdbcType=VARCHAR},
      </if>
      <if test="wgfksj != null" >
        WGFKSJ = #{wgfksj,jdbcType=TIMESTAMP},
      </if>
      <if test="gbrid != null" >
        GBRID = #{gbrid,jdbcType=VARCHAR},
      </if>
      <if test="gbrq != null" >
        GBRQ = #{gbrq,jdbcType=TIMESTAMP},
      </if>
      <if test="gbyy != null" >
        GBYY = #{gbyy,jdbcType=VARCHAR},
      </if>
      <if test="zdbmid != null" >
        ZDBMID = #{zdbmid,jdbcType=VARCHAR},
      </if>
      <if test="zdrid != null" >
        ZDRID = #{zdrid,jdbcType=VARCHAR},
      </if>
      <if test="zdrq != null" >
        ZDRQ = #{zdrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zt != null" >
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
      <if test="xmblbs != null" >
        XMBLBS = #{xmblbs,jdbcType=DECIMAL},
      </if>
      <if test="wgbs != null" >
        WGBS = #{wgbs,jdbcType=DECIMAL},
      </if>
      <if test="jksjid != null" >
        JKSJID = #{jksjid,jdbcType=VARCHAR},
      </if>
      <if test="gbid != null" >
        GBID = #{gbid,jdbcType=VARCHAR},
      </if>
      <if test="gkid != null" >
        GKID = #{gkid,jdbcType=VARCHAR},
      </if>
      <if test="gkbh != null" >
        GKBH = #{gkbh,jdbcType=VARCHAR},
      </if>
      <if test="djbgdid != null" >
        DJBGDID = #{djbgdid,jdbcType=VARCHAR},
      </if>
      <if test="gdbh != null" >
        GDBH = #{gdbh,jdbcType=VARCHAR},
      </if>
      <if test="gdlx != null" >
        GDLX = #{gdlx,jdbcType=DECIMAL},
      </if>
      <if test="gdbt != null" >
        GDBT = #{gdbt,jdbcType=VARCHAR},
      </if>
      <if test="fjjx != null" >
        FJJX = #{fjjx,jdbcType=VARCHAR},
      </if>
      <if test="fjzch != null" >
        FJZCH = #{fjzch,jdbcType=VARCHAR},
      </if>
      <if test="fjxlh != null" >
        FJXLH = #{fjxlh,jdbcType=VARCHAR},
      </if>
      <if test="zjh != null" >
        ZJH = #{zjh,jdbcType=VARCHAR},
      </if>
      <if test="bjbs != null" >
        BJBS = #{bjbs,jdbcType=DECIMAL},
      </if>
      <if test="bgrid != null" >
        BGRID = #{bgrid,jdbcType=VARCHAR},
      </if>
      <if test="bgr != null" >
        BGR = #{bgr,jdbcType=VARCHAR},
      </if>
      <if test="kdrq != null" >
        KDRQ = #{kdrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jhKsrq != null" >
        JH_KSRQ = #{jhKsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="jhJsrq != null" >
        JH_JSRQ = #{jhJsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="zy != null" >
        ZY = #{zy,jdbcType=VARCHAR},
      </if>
      <if test="gzlb != null" >
        GZLB = #{gzlb,jdbcType=VARCHAR},
      </if>
      <if test="jhgsRs != null" >
        JHGS_RS = #{jhgsRs,jdbcType=DECIMAL},
      </if>
      <if test="jhgsXss != null" >
        JHGS_XSS = #{jhgsXss,jdbcType=DECIMAL},
      </if>
      <if test="jhZd != null" >
        JH_ZD = #{jhZd,jdbcType=VARCHAR},
      </if>
      <if test="gzzid != null" >
        GZZID = #{gzzid,jdbcType=VARCHAR},
      </if>
      <if test="ybgs != null" >
        YBGS = #{ybgs,jdbcType=VARCHAR},
      </if>
      <if test="qxms != null" >
        QXMS = #{qxms,jdbcType=VARCHAR},
      </if>
      <if test="jyclfa != null" >
        JYCLFA = #{jyclfa,jdbcType=VARCHAR},
      </if>
      <if test="gznrfjid != null" >
        GZNRFJID = #{gznrfjid,jdbcType=VARCHAR},
      </if>
      <if test="wgfkfjid != null" >
        WGFKFJID = #{wgfkfjid,jdbcType=VARCHAR},
      </if>
      <if test="sjKsrq != null" >
        SJ_KSRQ = #{sjKsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="sjJsrq != null" >
        SJ_JSRQ = #{sjJsrq,jdbcType=TIMESTAMP},
      </if>
      <if test="sjGzz != null" >
        SJ_GZZ = #{sjGzz,jdbcType=VARCHAR},
      </if>
      <if test="sjJcz != null" >
        SJ_JCZ = #{sjJcz,jdbcType=VARCHAR},
      </if>
      <if test="sjGs != null" >
        SJ_GS = #{sjGs,jdbcType=DECIMAL},
      </if>
      <if test="sjZd != null" >
        SJ_ZD = #{sjZd,jdbcType=VARCHAR},
      </if>
      <if test="gzxx != null" >
        GZXX = #{gzxx,jdbcType=VARCHAR},
      </if>
      <if test="clcs != null" >
        CLCS = #{clcs,jdbcType=VARCHAR},
      </if>
      <if test="dqGzzid != null" >
        DQ_GZZID = #{dqGzzid,jdbcType=VARCHAR},
      </if>
      <if test="dqJdid != null" >
        DQ_JDID = #{dqJdid,jdbcType=VARCHAR},
      </if>
      <if test="dqZxzt != null" >
        DQ_ZXZT = #{dqZxzt,jdbcType=VARCHAR},
      </if>
      <if test="dqZxzzt != null" >
        DQ_ZXZZT = #{dqZxzzt,jdbcType=VARCHAR},
      </if>
      <if test="dxfbs != null" >
        DXFBS = #{dxfbs,jdbcType=DECIMAL},
      </if>
      <if test="lyrwid != null">
        LYRWID = #{lyrwid,jdbcType=VARCHAR},
      </if>
      <if test="lyrwh != null">
        LYRWH = #{lyrwh,jdbcType=VARCHAR},
      </if>
      <if test="sjJczid != null">
        sj_jczid = #{sjJczid,jdbcType=VARCHAR},
      </if>
      <!-- Start:不需判空，要清空的字段 -->
		<if test="paramsMap.jhgsRs != null and paramsMap.jhgsRs == 'ND' ">
			JHGS_RS = #{jhgsRs,jdbcType=DECIMAL},
		</if>
		<if test="paramsMap.jhgsXss != null and paramsMap.jhgsXss == 'ND' ">
			JHGS_XSS = #{jhgsXss,jdbcType=DECIMAL},
		</if>
		<if test="paramsMap.kdrq != null and paramsMap.kdrq == 'ND' ">
			KDRQ = #{kdrq,jdbcType=TIMESTAMP}
		</if>
	    <!-- End:不需判空，要清空的字段 -->
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.eray.thjw.produce.po.Workorder145" >
    update B_S2_014
    set GDSBID = #{gdsbid,jdbcType=VARCHAR},
      DPRTCODE = #{dprtcode,jdbcType=VARCHAR},
      WHDWID = #{whdwid,jdbcType=VARCHAR},
      WHRID = #{whrid,jdbcType=VARCHAR},
      WHSJ = #{whsj,jdbcType=TIMESTAMP},
      XFRDWID = #{xfrdwid,jdbcType=VARCHAR},
      XFRID = #{xfrid,jdbcType=VARCHAR},
      XFSJ = #{xfsj,jdbcType=TIMESTAMP},
      WGFKRDWID = #{wgfkrdwid,jdbcType=VARCHAR},
      WGFKRID = #{wgfkrid,jdbcType=VARCHAR},
      WGFKSJ = #{wgfksj,jdbcType=TIMESTAMP},
      GBRID = #{gbrid,jdbcType=VARCHAR},
      GBRQ = #{gbrq,jdbcType=TIMESTAMP},
      GBYY = #{gbyy,jdbcType=VARCHAR},
      ZDBMID = #{zdbmid,jdbcType=VARCHAR},
      ZDRID = #{zdrid,jdbcType=VARCHAR},
      ZDRQ = #{zdrq,jdbcType=TIMESTAMP},
      ZT = #{zt,jdbcType=DECIMAL},
      XMBLBS = #{xmblbs,jdbcType=DECIMAL},
      WGBS = #{wgbs,jdbcType=DECIMAL},
      JKSJID = #{jksjid,jdbcType=VARCHAR},
      GBID = #{gbid,jdbcType=VARCHAR},
      GKID = #{gkid,jdbcType=VARCHAR},
      GKBH = #{gkbh,jdbcType=VARCHAR},
      DJBGDID = #{djbgdid,jdbcType=VARCHAR},
      GDBH = #{gdbh,jdbcType=VARCHAR},
      GDLX = #{gdlx,jdbcType=DECIMAL},
      GDBT = #{gdbt,jdbcType=VARCHAR},
      LYRWID = #{lyrwid,jdbcType=VARCHAR},
      LYRWH = #{lyrwh,jdbcType=VARCHAR},
      FJJX = #{fjjx,jdbcType=VARCHAR},
      FJZCH = #{fjzch,jdbcType=VARCHAR},
      FJXLH = #{fjxlh,jdbcType=VARCHAR},
      ZJH = #{zjh,jdbcType=VARCHAR},
      BJBS = #{bjbs,jdbcType=DECIMAL},
      BGRID = #{bgrid,jdbcType=VARCHAR},
      BGR = #{bgr,jdbcType=VARCHAR},
      KDRQ = #{kdrq,jdbcType=TIMESTAMP},
      JH_KSRQ = #{jhKsrq,jdbcType=TIMESTAMP},
      JH_JSRQ = #{jhJsrq,jdbcType=TIMESTAMP},
      ZY = #{zy,jdbcType=VARCHAR},
      GZLB = #{gzlb,jdbcType=VARCHAR},
      JHGS_RS = #{jhgsRs,jdbcType=DECIMAL},
      JHGS_XSS = #{jhgsXss,jdbcType=DECIMAL},
      JH_ZD = #{jhZd,jdbcType=VARCHAR},
      GZZID = #{gzzid,jdbcType=VARCHAR},
      YBGS = #{ybgs,jdbcType=VARCHAR},
      QXMS = #{qxms,jdbcType=VARCHAR},
      JYCLFA = #{jyclfa,jdbcType=VARCHAR},
      GZNRFJID = #{gznrfjid,jdbcType=VARCHAR},
      WGFKFJID = #{wgfkfjid,jdbcType=VARCHAR},
      SJ_KSRQ = #{sjKsrq,jdbcType=TIMESTAMP},
      SJ_JSRQ = #{sjJsrq,jdbcType=TIMESTAMP},
      SJ_GZZ = #{sjGzz,jdbcType=VARCHAR},
      SJ_JCZ = #{sjJcz,jdbcType=VARCHAR},
      SJ_GS = #{sjGs,jdbcType=DECIMAL},
      SJ_ZD = #{sjZd,jdbcType=VARCHAR},
      GZXX = #{gzxx,jdbcType=VARCHAR},
      CLCS = #{clcs,jdbcType=VARCHAR},
      DQ_GZZID = #{dqGzzid,jdbcType=VARCHAR},
      DQ_JDID = #{dqJdid,jdbcType=VARCHAR},
      DQ_ZXZT = #{dqZxzt,jdbcType=VARCHAR},
      DQ_ZXZZT = #{dqZxzzt,jdbcType=VARCHAR},
      DXFBS = #{dxfbs,jdbcType=DECIMAL}
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  <!-- 查询状态不为9的工包下工单的数量 -->
  <select id="getCountByGbid" parameterType="String" resultType="int">
  	select count(1) from b_s2_014 where gbid= #{gbid,jdbcType=VARCHAR} and zt != 9
  </select>
  <!-- 查询状态为2提交状态下的工包下工单的数量 -->
  <select id="getSubmitCountByGbid" parameterType="String" resultType="int">
  	select count(1) from b_s2_014 where gbid= #{gbid,jdbcType=VARCHAR} and zt = 2
  </select>
  <!-- 工包下发工单 -->
  <update id="update4Issued" parameterType="String">
  		update b_s2_014 
  		set  XFRDWID = #{0,jdbcType=VARCHAR},
      		XFRID = #{1,jdbcType=VARCHAR},
      		XFSJ = sysdate,
      		zt =7,
      		DXFBS = 20
    		where GBID = #{2,jdbcType=VARCHAR} and zt=2
  </update>
  <!-- 验证工包下状态不为9和10的数量 -->
  <select id="getCount4Wp"  parameterType="String" resultType="int">
  	select count(1) from b_s2_014 where gbid=#{gbid,jdbcType=VARCHAR} and zt not in(9,10)
  </select>
  <!-- 获取工包下工单 -->
  <select id="getWorkorderListByGbid" parameterType="String" resultType="map" >
  	select S2014.JH_KSRQ,--计划开始日期
   s2014.jh_jsrq,--计划结束日期
  	s2014.id gdid, --工单id，如果是工单那么就是工单id；如果不是工单那么就是监控数据id
       s2014.gdlx, --工单类型：1维修项目；2EO；3NRC；9FLB
       s2014.gdbh, --工单编号
       s2014.lyrwh,--来源任务号
       s2014.lyrwid,--来源任务id
       s2901.lyid, --维修项目id/EO的id
       s2901.lybh, --维修项目编号/EO编号
       s2014.gzlb, --工作类别
       s2014.gdbt, --任务主题
       s2014.zt, --工单状态：1保存、2提交、7生效（下发）、9关闭、10完成、（为null的不显示值）
       s2014.wgbs, --完工反馈状态：0未完工、1已完工、（为null的不显示值）
       s2014.fjzch, --飞机注册号
       s2014.fjxlh msn, --飞机序列号MSN
       s2901.bjh, --部件号
       s2901.xlh, --部件序列号
       s2904.jhsjsj, --完成时限：监控项目编号1#_#计划值1,监控项目编号2#_#计划值2,监控项目编号3#_#计划值3
       (COALESCE(s2014.jhgs_rs, 0) * COALESCE(s2014.jhgs_xss, 0)) jhgs, --计划工时
       s2014.sj_gs sjgs, --实际工时
       s2014.zjh, --ATA章节号
       d005.zwms zjhzwms, --章节号中文名称
       d005.ywms zjhywms, --章节号英文名称
       s2014.zy, --专业
       s2014.jh_zd, --计划站点
       s2014.sj_zd, --实际站点
       s2014.gkid, --工卡id
       s2014.gkbh, --工卡编号
       g2013.bb gkbb, --工卡版本
       g2013.gkfjid gkfjid,--工卡附件id
       g2013.gznrfjid gkgznrfjid,--工卡工作内容附件id
       s2014.whdwid, --维护人单位id
       department.dprtcode whdwbh, --维护人部门编号
       department.dprtname whdwmc, --维护人部门名称
       s2014.whrid, --维护人id
       tuser.username whrbh, --维护人编号
       tuser.realname whrxm, --维护人姓名
       s2014.whsj, --维护时间
       s2014.dprtcode, --机构代码
       s2014.jksjid, --监控数据id
       s2014.djbgdid, --定检包工单id，与s2008.gdid字段对应：定检包下的工单或者维修项目此字段才有值，其他情况为null
       s2014.gdsbid, --工单识别id，用于定检包展开下级工单使用
       s2014.xmblbs, --项目保留标识
       (select count(1) from d_011 where D_011.mainid=s2014.id and D_011.yxzt=1) as ATTACHCOUNT,--工单附件
       (select count(1) from d_011 where D_011.mainid=s2014.gkid and D_011.yxzt=1) as GKATTACHCOUNT, --工卡附件
       (select count(1) from d_011 where D_011.mainid=g2013.gkfjid and D_011.yxzt=1) as GKFJATTACHCOUNT, --工卡附件
       (select count(1) from d_011 where D_011.mainid=g2013.gznrfjid and D_011.yxzt=1) as GKGZNRATTACHCOUNT --工作内容附件
  from b_s2_014 s2014
  left join b_g2_013 g2013
    on s2014.gkid = g2013.id
  left join b_s2_901 s2901
    on s2901.id = s2014.jksjid
  left join (select t.jksjid, max(t.jhsjsj) jhsjsj
               from (select s2904.jksjid,
                            wm_concat(s2904.jklbh || '#_#' || s2904.jhz) over(PARTITION BY s2904.jksjid order by s2904.jklbh) jhsjsj
                       from b_s2_904 s2904
                      where s2904.zt = 1
                        and s2904.jhz is not null) t
              group by t.jksjid) s2904
    on s2904.jksjid = s2014.jksjid
  left join d_005 d005
    on d005.dprtcode = s2014.dprtcode
   and d005.zjh = s2014.zjh
  left join t_department department
    on department.id = s2014.whdwid
  left join t_user tuser
    on tuser.id = s2014.whrid
 where 1 = 1
   and s2014.gbid = #{searchMap.gbid,jdbcType=VARCHAR}
<if test="searchMap.keyword!=null and searchMap.keywrod!=''">
 	and (      UPPER(s2014.lyrwh) like UPPER('%'||#{searchMap.keyword}||'%')
			OR UPPER(s2014.gdbt) like UPPER('%'||#{searchMap.keyword}||'%')
			OR UPPER(s2901.bjh) like UPPER('%'||#{searchMap.keyword}||'%')
			OR UPPER(s2901.xlh) like UPPER('%'||#{searchMap.keyword}||'%')
			)
 </if>
 <if test="searchMap.gdlx!=null and searchMap.gdlx!=''">
 	and s2014.gdlx in
  	<foreach collection="searchMap.gdlx" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
 </if>
 order by s2014.gdlx, s2014.gdbh desc 	
  </select>
  <select id="getWOList" parameterType="com.eray.thjw.produce.po.Workorder145" resultType="com.eray.thjw.produce.po.Workorder145">
  	 select <include refid="Base_Column_List" />
  from b_s2_014 s2014
 where s2014.dprtcode = #{dprtcode,jdbcType=VARCHAR}
   and s2014.zt in (1, 2)
   and s2014.fjzch =#{fjzch,jdbcType=VARCHAR}
   and s2014.gbid is null	
    <if test="keyword != null and keyword !='' ">
     	and ( UPPER(gdbh) like UPPER('%'||#{keyword}||'%') )  
     </if>
  </select>
  <select id="getCountByztAndGdid" parameterType="List" resultType="int">
  	select count(1) from b_s2_014 
  	where gbid is null and zt in (1,2) and id in
  	<foreach collection="list" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
  </select>
  <update id="updateGbid" parameterType="com.eray.thjw.produce.po.Workorder145">
  		update b_s2_014 set gbid=#{gbid,jdbcType=VARCHAR} 
  		where id in 
  		<foreach collection="paramsMap.idList" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
  </update>
  <!-- 根据id集合获取工单 -->
    <select id="selectByIdList" resultMap="BaseResultMap" parameterType="list" >
    select 
    	<include refid="Base_Column_List" />
    from B_S2_014 
    where ID in
    <foreach collection="list" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
  </select>
  <!-- 下发工单 -->
  <update id="update4IssuedById" parameterType="com.eray.thjw.produce.po.Workorder">
  		update b_s2_014
  		set 
        WHDWID = #{whdwid,jdbcType=VARCHAR},
        WHRID = #{whrid,jdbcType=VARCHAR},
        WHSJ = sysdate,    
        XFRDWID = #{xfrdwid,jdbcType=VARCHAR},   
        XFRID = #{xfrid,jdbcType=VARCHAR},
        XFSJ = sysdate,
        ZT = #{zt,jdbcType=DECIMAL},
        DXFBS = #{dxfbs,jdbcType=DECIMAL}
        where ID in
    	<foreach collection="paramsMap.idList" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
  </update>
  
  
   <!-- 工单145主列表信息查询 -->
  <select id="queryAllPageList" parameterType="com.eray.thjw.produce.po.Workorder145" resultMap="WOWithRelMap">
  		 select
  			  <include refid="WO145_Column_List" />
  			, D005.ZJH AS F_ZJH
        	, D005.ZWMS AS F_ZWMS
        	, D005.YWMS AS F_YWMS
        	, (select count(1) from D_011 where D_011.mainid=B.ID and D_011.yxzt=1) AS WOATTACHCOUNT
		    , (select count(1) from D_011 where D_011.mainid=G2013.id and D_011.yxzt=1) AS CARDATTACHCOUNT
		    ,g2013.gkfjid as CARDFJID --工卡附件ID
		    ,g2013.gznrfjid as CARDGZNRFJID --工卡附件ID
		    , WHR.USERNAME WHRBH
		    , WHR.REALNAME WHRXM
		    , WGP.GBBH WGPGBBH
		    , (COALESCE(B.jhgs_rs, 0) * COALESCE(B.jhgs_xss, 0)) AS KZ_JHGS,
		   (select wm_concat(gbh) from b_g2_995 where ywid = b.id and lx =1) qy
		   , (select count(1) from T_PRINTINFO where ywid = B.id) PRINTCOUNT
  		 from B_S2_014 B
  		 LEFT JOIN D_005 D005 ON B.DPRTCODE = D005.DPRTCODE AND B.ZJH = D005.ZJH
  		 LEFT JOIN B_G2_013 G2013 ON G2013.ID = B.GKID
  		 LEFT JOIN T_USER WHR ON B.WHRID = WHR.ID
  		 LEFT JOIN B_S2_010 WGP ON B.GBID = WGP.ID
		 where 1 = 1
		  <!--id-->
		  <if test="id != null and id != ''">
			and B.ID = #{id}
		  </if>
		 <include refid="WO145_Param"></include>
	     <choose><!--  进行排序判断，如果默认就是默认字段排序 -->
	    	<when test='pagination.sort == "auto"'>                       
	    		order by B.zdrq desc
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
		 </choose>
  </select>
  
  <!-- 工单145信息查询 (弹窗) -->
  <select id="queryAllPageListWin" parameterType="com.eray.thjw.produce.po.Workorder145" resultMap="WOWithRelMap">
  		 select
  			  <include refid="WO145_Column_List" />
  			  ,g2012.wxxmlx gdzlx
		      ,d005.zwms zjhzwms <!-- 章节号中文名称 -->
			  ,d005.ywms zjhywms  <!-- 章节号英文名称 -->
  		 from B_S2_014 B
  		 left join b_g2_012 g2012
		 on g2012.id = B.lyrwid
		 left join d_005 d005 
		    on d005.dprtcode = B.dprtcode
		    and d005.zjh = B.zjh
		    and d005.zt = 1
		 where 1 = 1
		  <if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
			    and (
			    	UPPER(B.GDBH) like UPPER('%'||#{paramsMap.keyword}||'%')
			    	or UPPER(B.GDBT) like UPPER('%'||#{paramsMap.keyword}||'%')
			    )
		  	</if>
		  	<if test="dprtcode != null and dprtcode !=''">
		      	and B.DPRTCODE = #{dprtcode}
		  	</if>
		  	<if test="zy != null and zy !=''">
		      	and B.zy = #{zy}
		  	</if>
		  	<if test="fjzch != null and fjzch !='' and fjzch !='-1'">
		      	and B.fjzch = #{fjzch}
		  	</if>
		  	<if test="fjzch != null and fjzch !='' and fjzch =='-1'">
		      	and B.fjzch is null
		  	</if>
		  	<if test="paramsMap != null and paramsMap.gdlx != null and paramsMap.gdlx != ''">
			    and 
			     (  B.GDLX in
			    	<foreach collection="paramsMap.gdlx" item="gdlx" index="index" open="(" close=")" separator=",">
						#{gdlx}
				 	</foreach>
			     )
			</if>
			<if test="paramsMap != null and paramsMap.gdzt != null and paramsMap.gdzt != ''">
			    and 
			    (   B.ZT in
			    	<foreach collection="paramsMap.gdzt" item="gdzt" index="index" open="(" close=")" separator=",">
						#{gdzt}
				 	</foreach>
			    )
			</if>
		  	<!--id-->
		  	<if test="id != null and id != ''">
			  	and B.ID = #{id}
		  	</if>
		 	<!-- 前台条件：飞机，机型，sql需要全部的范围，以及带上当前记录的机构码 -->
	      <choose>                                                                 
	    	<when test='paramsMap != null and paramsMap.userType!=null and paramsMap.userType == "admin"'>                       
	    		 AND (exists 
	    		( SELECT 1 from D_007 where 
	    			B.fjjx = FJJX
	    		AND B.dprtcode = DPRTCODE
	    		AND zt = 1
	    		)
	    		or b.fjjx is null
	    		)
	    	</when>
	    	<when test='paramsMap != null and paramsMap.userType != "admin" and paramsMap.userId!=null and paramsMap.userId != ""'>                       
	    		 AND (exists 
	    		( SELECT 1 from V_ROLE_JX where 
	    			B.fjjx= FJJX
	    		AND B.dprtcode = DPRTCODE
	    		AND USER_ID = #{paramsMap.userId,jdbcType=VARCHAR}
	    		)
	    		or b.fjjx is null
	    		)
	    	</when>
	   	</choose>
	     <choose><!--  进行排序判断，如果默认就是默认字段排序 -->
	    	<when test='pagination.sort == "auto"'>                       
	    		order by B.gdlx, g2012.wxxmlx desc, B.gdbh
	    	</when>
	    	<otherwise>
			    order by ${pagination.sort} ${pagination.order}
	    	</otherwise>
		 </choose>
  </select>
  
   <!--start:WO145列表查询 start -->
	<sql id="WO145_Param">
		<if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
		    and (
		    	UPPER(B.GDBH) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(B.GDBT) like UPPER('%'||#{paramsMap.keyword}||'%')
		    )
		</if>
		<if test="paramsMap != null and paramsMap.mainkeyword != null and paramsMap.mainkeyword != ''">
		    and (
		           UPPER(WGP.gbbh) like UPPER('%'||#{paramsMap.mainkeyword}||'%')
		    	or UPPER(G2013.gkh) like UPPER('%'||#{paramsMap.mainkeyword}||'%')
		    	or UPPER(B.gdbh) like UPPER('%'||#{paramsMap.mainkeyword}||'%')
		    	or UPPER(B.gdbt) like UPPER('%'||#{paramsMap.mainkeyword}||'%')
		    )
		</if>
		<if test="gdbh != null and gdbh !=''">
		    and B.GDBH = #{gdbh} 
		</if>
		<if test="dprtcode != null and dprtcode !=''">
		    and B.DPRTCODE = #{dprtcode}
		</if>
		<if test='fjzch != null and fjzch !="" and fjzch !="-1" '>
		    and B.fjzch = #{fjzch}
		</if>
		<if test='fjzch != null and fjzch !="" and fjzch =="-1" '>
		    and B.fjzch is null
		</if>
		<if test="zt != null">
		    and B.zt= #{zt}
		</if>
		<if test="wgbs!= null  ">
		    and B.wgbs= #{wgbs}
		</if>
		<if test="gzlb!= null and gzlb !=''">
		    and B.gzlb= #{gzlb}
		</if>
		<if test="djbgdid!= null">
		    and B.djbgdid= #{djbgdid}
		</if>
		<if test="paramsMap != null and paramsMap.zjh != null and paramsMap.zjh != ''">
		    and B.zjh= #{paramsMap.zjh}
		</if>
		<if test="paramsMap != null and paramsMap.gbbh != null and paramsMap.gbbh != ''">
		    and UPPER(WGP.gbbh) like  UPPER('%'||#{paramsMap.gbbh}||'%') 
		</if>
		<if test="paramsMap != null and paramsMap.gbid != null and paramsMap.gbid != ''">
		    and b.gbid = #{paramsMap.gbid}
		</if>
		<if test="paramsMap != null and paramsMap.qy != null and paramsMap.qy != ''">
		    and exists (select 1 from B_G2_995 BG2995 where BG2995.YWLX = 21 and BG2995.lx=1 and BG2995.YWID = B.ID AND BG2995.GBH like ('%'||#{paramsMap.qy, jdbcType=VARCHAR}||'%'))
		</if>
		<if test="paramsMap != null and paramsMap.gdlx != null and paramsMap.gdlx != ''">
		    and 
		     (  B.GDLX in
		    	<foreach collection="paramsMap.gdlx" item="gdlx" index="index" open="(" close=")" separator=",">
					#{gdlx}
			 	</foreach>
		     )
		</if>
		<if test="paramsMap != null and paramsMap.gdzt != null and paramsMap.gdzt != ''">
		    and 
		    (   B.ZT in
		    	<foreach collection="paramsMap.gdzt" item="gdzt" index="index" open="(" close=")" separator=",">
					#{gdzt}
			 	</foreach>
		    )
		</if>
		<!-- Start:前台条件：飞机，机型，sql需要全部的范围，以及带上当前记录的机构码 -->
	    <choose>                                                                 
	    	<when test='paramsMap != null and paramsMap.userType!=null and paramsMap.userType == "admin"'>                       
	    		 AND (exists 
	    		( SELECT 1 from D_007 where 
	    			B.fjjx = FJJX
	    		AND B.dprtcode = DPRTCODE
	    		AND zt = 1
	    		)
	    		or b.fjjx is null
	    		)
	    	</when>
	    	<when test='paramsMap != null and paramsMap.userType != "admin" and paramsMap.userId!=null and paramsMap.userId != ""'>                       
	    		 AND (exists 
	    		( SELECT 1 from V_ROLE_JX where 
	    			B.fjjx= FJJX
	    		AND B.dprtcode = DPRTCODE
	    		AND USER_ID = #{paramsMap.userId,jdbcType=VARCHAR}
	    		)
	    		or b.fjjx is null
	    		)
	    	</when>
	   	</choose>
	   	<!-- End:前台条件：飞机，机型，sql需要全部的范围，以及带上当前记录的机构码 -->
	</sql>
	<!-- end:WO145列表查询 end -->
  
    <!-- 根据参数查询工单信息 -->
    <select id="selectByParam" resultMap="BaseResultMap" parameterType="java.util.Map">
		 select 
		 	<include refid="Base_Column_List"></include>
		 from b_s2_014 B
		 where 1=1 
		 <include refid="WO145_Param"></include>
    </select>
    
    <!-- 根据GDID查询工单信息 -->
   <select id="selectWOById" resultMap="WOWithRelMap"  parameterType="java.lang.String" >
		 select 
		 	<include refid="WO145_Column_List"></include>
		    , WTA.ID AS WTA_ID
		    , WTA.MAINID AS WTA_MAINID
		    , WTA.DPRTCODE AS WTA_DPRTCODE
		    , WTA.YSWJM AS WTA_YSWJM
		    , WTA.WBWJM AS WTA_WBWJM
		    , WTA.NBWJM AS WTA_NBWJM
		    , WTA.WJDX AS WTA_WJDX
		    , WTA.CFLJ AS WTA_CFLJ
		    , WTA.HZM AS WTA_HZM
		    , BG2995.ID AS CP_ID
        	, BG2995.LX AS CP_LX
        	, BG2995.GBID AS CP_GBID
        	, BG2995.GBH AS CP_GBH
        	, BS2901.ID AS MTO_ID
        	, BS2901.BJH AS MTO_BJH
        	, BS2901.XLH AS MTO_XLH
        	, D005.ZJH AS F_ZJH
        	, D005.ZWMS AS F_ZWMS
        	, D005.YWMS AS F_YWMS
        	, WPG.XFDW AS XFRDW_NAME
        	, WPG.ID AS WPG_ID
        	, WPG.GBBH AS WPG_GBBH
        	, WPG.ZXDW AS WPG_ZXDW
        	, WPG.wbbs AS WPG_WBBS
        	, D021.GBMC CPI_GBMC
        	, D007.FJJX FJJX
        	, D007.FDJSL FDJSL
        	, rec.id as recid, rec.mainid as recmainid, rec.zt as reczt, 
        	rec.cx_bs as reccx_bs, rec.cx_zjqdid as reccx_zjqdid, rec.cx_sj as reccx_sj,
	        rec.cx_bz as reccx_bz, rec.cx_wckcid as reccx_wckcid, rec.cx_kclvid as reccx_kclvid,
	        rec.zs_bs as reczs_bs, rec.zs_zjqdid as reczs_zjqdid, rec.zs_sj as reczs_sj,
	        rec.zs_bz as reczs_bz, rec.zs_wckcid as reczs_wckcid, rec.zs_kclvid as reczs_kclvid,
	        rec.cx_bjh as reccx_bjh, rec.cx_xlh as reccx_xlh, rec.cx_pch as reccx_pch, 
	        rec.cx_cjsl as reccx_cjsl, rec.cx_bjzwmc as reccx_bjzwmc, rec.cx_bjywmc as reccx_bjywmc, 
	        rec.cx_wz as reccx_wz, rec.zrrid as reczrrid, rec.zrr as reczrr,
	        worker.id as workerid, worker.gzz as workergzz, worker.gzzid as workergzzid,
	        zsj.id as zsjid, zsj.dprtcode as zsjdprtcode, zsj.xgzjqdid as zsjxgzjqdid, zsj.jx as zsjjx,
	        zsj.fjzch as zsjfjzch, zsj.wz as zsjwz, zsj.cj as zsjcj, zsj.fjdid as zsjfjdid,
	        zsj.bjh as zsjbjh, zsj.zwmc as zsjzwmc, zsj.ywmc as zsjywmc, zsj.cjjh as zsjcjjh,
	        zsj.xh as zsjxh, zsj.zjh as zsjzjh, zsj.jldw as zsjjldw, zsj.xlh as zsjxlh, zsj.pch as zsjpch,
	        zsj.zjsl as zsjzjsl, zsj.llklx as zsjllklx, zsj.llkbh as zsjllkbh, zsj.fjzw as zsjfjzw,
	        zsj.chucrq as zsjchucrq, zsj.tsn as zsjtsn, zsj.tso as zsjtso, zsj.csn as zsjcsn,
	        zsj.cso as zsjcso, zsj.bjgzjl as zsjbjgzjl, zsj.bz as zsjbz, zsj.skbs as zsjskbs,
	        zsj.azsj as zsjazsj,
	        zsjpar.id as zsjparid, zsjpar.bjh as zsjparbjh, zsjpar.zwmc as zsjparzwmc, 
	        zsjpar.ywmc as zsjparywmc, zsjpar.xlh as zsjparxlh, 
	        zsjpar.pch as zsjparpch, zsjpar.wz as zsjparwz, zsjpar.cj as zsjparcj, 
	        zsjinit.id as zsjinitid, zsjinit.mainid as zsjinitmainid, zsjinit.jklbh as zsjinitjklbh,
	        zsjinit.jkflbh as zsjinitjkflbh, zsjinit.csz as zsjinitcsz,
	        cxj.id as cxjid, cxj.bjh as cxjbjh, cxj.xlh as cxjxlh, cxj.ywmc as cxjywmc, 
	        cxj.zwmc as cxjzwmc, cxj.wz as cxjwz,gbr.username||' '||gbr.realname gbrname,
	        case when zsjzjh.zjh is not null then zsjzjh.zjh ||' '||zsjzjh.ywms else null end as zjhname,
	        (select count(1) from T_PRINTINFO where ywid = b.id) PRINTCOUNT
		 from B_S2_014 B
		 LEFT JOIN D_011 WTA ON B.GZNRFJID = WTA.MAINID and WTA.YXZT = 1
		 LEFT JOIN B_G2_995 BG2995 ON BG2995.YWLX = 21 and BG2995.YWID = B.ID
		 LEFT JOIN D_021 D021 ON BG2995.GBID = D021.ID
		 LEFT JOIN B_S2_901 BS2901 ON BS2901.ID = B.JKSJID
		 LEFT JOIN D_005 D005 ON B.DPRTCODE = D005.DPRTCODE AND B.ZJH = D005.ZJH
		 LEFT JOIN B_S2_010 WPG ON WPG.ID = B.GBID
		 LEFT JOIN D_007 D007 ON B.FJZCH=D007.FJZCH AND B.DPRTCODE = D007.DPRTCODE
		 LEFT JOIN B_S2_01401 REC ON B.ID = REC.MAINID AND REC.ZT = 1
		 LEFT JOIN B_S2_01403 WORKER ON B.ID = WORKER.MAINID AND WORKER.ZT = 1
         LEFT JOIN B_S2_002 ZSJ ON REC.ZS_ZJQDID = ZSJ.ID
         LEFT JOIN D_005 ZSJZJH ON ZSJ.DPRTCODE=ZSJZJH.DPRTCODE 
         	AND ZSJ.ZJH = ZSJZJH.ZJH
         LEFT JOIN B_S2_00201 ZSJINIT ON ZSJ.ID = ZSJINIT.MAINID
         LEFT JOIN B_S2_004 ZSJPAR ON ZSJ.FJDID = ZSJPAR.ID
         LEFT JOIN B_S2_004 CXJ ON REC.CX_ZJQDID = CXJ.ID
         LEFT JOIN T_USER GBR ON GBR.ID=B.GBRID 
		 where 1=1 and B.ID = #{id,jdbcType=VARCHAR}
		 ORDER BY BG2995.XC,zsjinit.jkflbh
   </select>
   
   <!-- start 工单航材工具明细 -->
  <select id="getGDHCToolDetail" parameterType="java.util.Map" resultType="java.util.Map">
		  	SELECT G2997.DPRTCODE, --机构代码
       G2997.JH, --部件号
       COALESCE(G2997.XQSL, 0) XQSL, --需求数量
       D008.ZWMS, --部件中文名称
       D008.YWMS, --部件英文名称
       D008.JLDW, --计量单位
       G2997.BJLX, --部件类型：1航材、2工具、3设备
       D008.JHLY, --件号来源
       D008.XINGH, --型号
       D008.HCLX,--航材类型
       D008.HCLX_EJ,--航材二级类型
       COALESCE(H001.KCSL, 0) KCSL, --库存数量
       COALESCE(H001.DJSL, 0) DJSL, --冻结数量
       D017.TDJXX, --替代件信息：替代件号+库存数量+冻结数量+替代件描述
       CASE
         WHEN COALESCE(G2997.XQSL, 0) &gt; COALESCE(H001.KCSL, 0) THEN
          1
         ELSE
          0
       END IS_WARNING --警告标识：0不警告、1警告
  FROM (SELECT G2997.DPRTCODE,
               G2997.BJLX,
               G2997.BJID,
               G2997.JH,
               CASE
                 WHEN G2997.BJLX = 1 THEN
                  SUM(G2997.SL)
                 ELSE
                  MAX(G2997.SL)
               END XQSL
          FROM B_S2_014 S2014
          JOIN B_G2_997 G2997
            ON G2997.ZT = 1
           AND S2014.ID = G2997.YWID
           AND S2014.ID = #{gdid}
         GROUP BY G2997.DPRTCODE, G2997.BJLX, G2997.BJID, G2997.JH) G2997
  LEFT JOIN D_008 D008
    ON D008.DPRTCODE = G2997.DPRTCODE
   AND D008.BJH = G2997.JH
--部件库存信息
  LEFT JOIN (SELECT H001.DPRTCODE,
                    H001.BJH,
                    SUM(H001.KCSL) KCSL,
                    SUM(H001.DJSL) DJSL
               FROM B_H_001 H001
              WHERE H001.DPRTCODE = #{dprtcode}
                AND H001.ZT = 2
                <if test="ckidList!=null and ckidList !='' ">
			   	AND H001.CKID IN 
			   		<foreach collection="ckidList" item="item" index="index" open="("  separator="," close=")" >
			   			#{item}
			   		</foreach>
			   </if>
              GROUP BY H001.DPRTCODE, H001.BJH) H001
    ON H001.DPRTCODE = G2997.DPRTCODE
   AND H001.BJH = G2997.JH
--等效替代件库存信息
  LEFT JOIN (SELECT D017.DPRTCODE,
                    D017.BJH,
                    WM_CONCAT(D017.TDJH || '#_#' || H001.TDJKCSL || '#_#' ||
                              H001.TDJDJSL || '#_#' || D017.TDJMS) TDJXX
               FROM (SELECT D_017.DPRTCODE,
                            D_017.BJH,
                            D_017.TDJH,
                            D_017.TDJMS
                       FROM D_017
                      WHERE D_017.ZT = 1
                     UNION
                     SELECT D_017.DPRTCODE,
                            D_017.TDJH     BJH,
                            D_017.BJH      TDJH,
                            D_017.TDJMS
                       FROM D_017
                      WHERE D_017.KNXBS = 2
                        AND D_017.ZT = 1) D017
               LEFT JOIN (SELECT H001.DPRTCODE,
                                H001.BJH,
                                SUM(H001.KCSL) TDJKCSL,
                                SUM(H001.DJSL) TDJDJSL
                           FROM B_H_001 H001
                          WHERE H001.DPRTCODE = #{dprtcode}
                            AND H001.ZT = 2
                            <if test="ckidList!=null and ckidList !='' ">
						   	AND H001.CKID IN 
						   		<foreach collection="ckidList" item="item" index="index" open="("  separator="," close=")" >
						   			#{item}
						   		</foreach>
						   </if>
                          GROUP BY H001.DPRTCODE, H001.BJH) H001
                 ON H001.DPRTCODE = D017.DPRTCODE
                AND H001.BJH = D017.TDJH
              GROUP BY D017.DPRTCODE, D017.BJH) D017
    ON D017.DPRTCODE = G2997.DPRTCODE
   AND D017.BJH = JH
 ORDER BY IS_WARNING DESC, G2997.BJLX, G2997.JH
  </select>
  <!-- end 工单航材工具明细 -->
  <select id="getWO4ValidationIssued" parameterType="String" resultType="com.eray.thjw.produce.po.Workorder145">
  	select <include refid="Base_Column_List" /> from b_S2_014 where gbid=#{gbid,jdbcType=VARCHAR}   and zt =2
  </select>
  <select id="getCount4Validation" parameterType="String" resultType="int">
    select count(1) from b_S2_014 where dprtcode=#{0,jdbcType=VARCHAR} and gdbh = #{1,jdbcType=VARCHAR}
  </select>
  <update id="updateByGdsbid" parameterType="com.eray.thjw.produce.po.Workorder" >
  		 update B_S2_014
    set 
      WHDWID = #{whdwid,jdbcType=VARCHAR},
      WHRID = #{whrid,jdbcType=VARCHAR},
      WHSJ = sysdate,
      GDBT = #{gdbt,jdbcType=VARCHAR},
      BJBS = #{bjbs,jdbcType=DECIMAL},
      BGRID = #{bgrid,jdbcType=VARCHAR},
      BGR = #{bgr,jdbcType=VARCHAR},
      JH_KSRQ = #{jhKsrq,jdbcType=TIMESTAMP},
      JH_JSRQ = #{jhJsrq,jdbcType=TIMESTAMP},
      GZNRFJID = #{gznrfjid,jdbcType=VARCHAR},
      ZY = #{zy,jdbcType=VARCHAR},
      GZLB = #{gzlb,jdbcType=VARCHAR},
      JHGS_RS = #{jhgsRs,jdbcType=DECIMAL},
      JHGS_XSS = #{jhgsXss,jdbcType=DECIMAL},
      JH_ZD = #{jhZd,jdbcType=VARCHAR},
      YBGS = #{ybgs,jdbcType=VARCHAR},
      QXMS = #{qxms,jdbcType=VARCHAR},
      JYCLFA = #{jyclfa,jdbcType=VARCHAR}
    where gdsbid = #{gdsbid,jdbcType=VARCHAR}
  </update>
   <select id="getByGdsbid" parameterType="String" resultType="com.eray.thjw.produce.po.Workorder145">
  	select <include refid="Base_Column_List" /> from b_s2_014 where gdsbid = #{gdsbid,jdbcType=VARCHAR}
  </select>
  <update id="updateFj" parameterType="String">
    update b_s2_014 
      set fjjx = #{0,jdbcType=VARCHAR},
      fjzch = #{1,jdbcType=VARCHAR},
      fjxlh = #{2,jdbcType=VARCHAR}
     where gbid = #{3,jdbcType=VARCHAR}
  </update>
  
    <select id="queryCount" parameterType="com.eray.thjw.produce.po.Workorder145" resultType="java.lang.Integer">
	SELECT COUNT(1) FROM b_s2_014 
    WHERE GDBH     = #{ gdbh,     jdbcType = VARCHAR }
  	AND   DPRTCODE = #{ dprtcode, jdbcType = VARCHAR }
  </select>
</mapper>