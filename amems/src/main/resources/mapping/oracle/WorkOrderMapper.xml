<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.eray.thjw.dao.WorkOrderMapper" >
  <resultMap id="BaseResultMap" type="com.eray.thjw.po.WorkOrder" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="GDJCID" property="gdjcid" jdbcType="VARCHAR" />
    <result column="GDBH" property="gdbh" jdbcType="VARCHAR" />
    <result column="GCZLID" property="gczlid" jdbcType="VARCHAR" />
    <result column="GCZLZXDXID" property="gczlzxdxid" jdbcType="VARCHAR" />
    <result column="GCZLBH" property="gczlbh" jdbcType="VARCHAR" />
    <result column="ZY" property="zy" jdbcType="VARCHAR" />
    <result column="JHGS_RS" property="jhgsRs" jdbcType="DECIMAL" />
    <result column="JHGS_XSS" property="jhgsXss" jdbcType="DECIMAL" />
    <result column="XFGDYY" property="xfgdyy" jdbcType="VARCHAR" />
    <result column="BZ" property="bz" jdbcType="VARCHAR" />
    <result column="ZDDWID" property="zddwid" jdbcType="VARCHAR" />
    <result column="ZDRID" property="zdrid" jdbcType="VARCHAR" />
    <result column="ZDSJ" property="zdsj" jdbcType="TIMESTAMP" />
    <result column="ZT" property="zt" jdbcType="DECIMAL" />
    <result column="DPRTCODE" property="dprtcode" jdbcType="VARCHAR" />
    <result column="ZDJSRID" property="zdjsrid" jdbcType="VARCHAR" />
    <result column="ZDJSRQ" property="zdjsrq" jdbcType="TIMESTAMP" />
    <result column="ZDJSYY" property="zdjsyy" jdbcType="VARCHAR" />
    <result column="SHBMID" property="shbmid" jdbcType="VARCHAR" />
    <result column="SHYJ" property="shyj" jdbcType="VARCHAR" />
    <result column="SHRID" property="shrid" jdbcType="VARCHAR" />
    <result column="SHSJ" property="shsj" jdbcType="TIMESTAMP" />
    <result column="PFBMID" property="pfbmid" jdbcType="VARCHAR" />
    <result column="PFYJ" property="pfyj" jdbcType="VARCHAR" />
    <result column="PFRID" property="pfrid" jdbcType="VARCHAR" />
    <result column="PFSJ" property="pfsj" jdbcType="TIMESTAMP" />
    <result column="JKBZ" property="jkbz" jdbcType="VARCHAR" />
    <result column="ZHUT" property="zhut" jdbcType="VARCHAR" />
    <result column="ZJH" property="zjh" jdbcType="VARCHAR" />
    <result column="JD" property="jd" jdbcType="VARCHAR" />
    <result column="GLXX" property="glxx" jdbcType="VARCHAR" />
    <result column="IS_XYJSZY" property="isXyjszy" jdbcType="DECIMAL" />
    <result column="TCSJ" property="tcsj" jdbcType="VARCHAR" />
    <result column="REF_JHLY" property="refJhly" jdbcType="VARCHAR" />
     <result column="GDDLX" property="gddlx" jdbcType="DECIMAL" />
     <result column="DJRWDID" property="djrwdid" jdbcType="VARCHAR" />
    <result column="DJGKID" property="djgkid" jdbcType="VARCHAR" />
      <result column="nbxh" property="nbxh" jdbcType="VARCHAR" />
      <result column="gdzlx" property="gdzlx" jdbcType="VARCHAR" />
      <result column="cksc" property="cksc" jdbcType="VARCHAR" />
      <result column="ckgk" property="ckgk" jdbcType="VARCHAR" />
      <result column="gzzw" property="gzzw" jdbcType="VARCHAR" />
      <result column="bcwj" property="bcwj" jdbcType="VARCHAR" />
      <result column="gzdd" property="gzdd" jdbcType="VARCHAR" />
      <result column="GZZID" property="gzzid" jdbcType="VARCHAR" />
      <result column="DISPLAYGZZ" property="displaygzz" jdbcType="VARCHAR" />
      
      <result column="DISPLAYNAME" property="displayname" jdbcType="VARCHAR" />  
      <result column="GKBH" property="gkbh" jdbcType="VARCHAR" />  
      <result column="GlDJXM" property="gldjxm" jdbcType="VARCHAR" /> 
  </resultMap>
  <sql id="Base_Column_List" >
    ID, GDJCID, GDBH, GCZLID, GCZLZXDXID, GCZLBH, ZY, JHGS_RS, JHGS_XSS, XFGDYY, BZ, 
    ZDDWID, ZDRID, ZDSJ, ZT, DPRTCODE, ZDJSRID, ZDJSRQ, ZDJSYY, SHBMID, SHYJ, SHRID, GZZW,GZZID
    SHSJ, PFBMID, PFYJ, PFRID, PFSJ, JKBZ, ZHUT,ZJH,JD,GLXX,IS_XYJSZY,TCSJ,REF_JHLY,DJRWDID,DJGKID
  </sql>
  
  <sql id="Base_Column_List_EO" >
    ID, GDJCID, GDBH, GCZLID, GCZLZXDXID, GCZLBH, ZY, JHGS_RS, JHGS_XSS, XFGDYY, BZ, 
    ZDDWID, ZDRID, ZDSJ, ZT, DPRTCODE, ZDJSRID, ZDJSRQ, ZDJSYY, SHBMID, SHYJ, SHRID, GZZW,GZZID
    SHSJ, PFBMID, PFYJ, PFRID, PFSJ, JKBZ, ZHUT,ZJH,JD,DJGKID
  </sql>
  
   <sql id="Base_Column_List_NON" >
    ID, GDJCID, GDBH,ZY, JHGS_RS, JHGS_XSS, XFGDYY, BZ,ZDDWID, ZDRID, ZDSJ, ZT, DPRTCODE, ZDJSRID, 
    ZDJSRQ, ZDJSYY, SHBMID, SHYJ, SHRID, GZZW,GZZID,SHSJ, PFBMID, PFYJ, PFRID, PFSJ, JKBZ, ZHUT,
    ZJH,JD,GLXX,IS_XYJSZY,TCSJ,REF_JHLY,DJGKID
  </sql>
  
  <sql id="BaseResulParam">
	     where 
		   1=1
		   <!-- 工单id -->
		     <if test="id != null and id != ''">
	            and  b.id = #{id}
	       </if>
   </sql>
  
 <select id="selectByWorkOrder"   resultMap="BaseResultMap" parameterType="com.eray.thjw.po.WorkOrder">
		select CASE #{gddlx} WHEN 1 THEN 1  WHEN 2  THEN 2   WHEN 3  THEN 3   END GDDLX,
		b.ID, b.GDJCID, b.GDBH,b.ZY, b.JHGS_RS, b.JHGS_XSS, b.XFGDYY, b.BZ, b.ZDDWID, b.ZDRID, 
		b.ZDSJ, b.ZT, b.DPRTCODE, b.ZDJSRID, b.ZDJSRQ, b.ZDJSYY, b.SHBMID, b.SHYJ, b.SHRID, b.GZZW,b.GZZID,
        b.SHSJ, b.PFBMID, b.PFYJ, b.PFRID, b.PFSJ, b.JKBZ, b.ZHUT,b.ZJH,b.JD,b.DJGKID,g.gdbh as gkbh,
		a.username,a.realname,c.username as pfusername,c.realname as pfrealname ,d.jdms,e.zwms ,f.username||' '||f.realname as displayname ,t.gzzdm||' '|| t.gzzmc as displaygzz
	   <choose>
	    	<when test="gddlx ==2" >
	              ,b.GDLX,b.GLXX,b.IS_XYJSZY,b.TCSJ,b.REF_JHLY from
	    		  B_G_007 b left join t_user a on b.shrid=a.id left join t_user c on b.pfrid=c.id  left join d_012 d on b.jd=d.id left join d_005 e on b.zjh=e.zjh  AND B.DPRTCODE = E.DPRTCODE 
	    		  left join t_user f on b.zdrid=f.id  left join t_workgroup t on t.id=b.gzzid left join b_g_013 g on b.djgkid=g.id
	    	</when>
	    	<when test="gddlx==1">
	    	     ,g.djbh||' '|| g.gzzt as gldjxm ,b.DJRWDID from 
	    	
	    		  B_G_016  b left join t_user a on b.shrid=a.id left join t_user c on b.pfrid=c.id  left join d_012 d on b.jd=d.id left join d_005 e on b.zjh=e.zjh  AND B.DPRTCODE = E.DPRTCODE 
	    		  left join t_user f on b.zdrid=f.id left join t_workgroup t on t.id=b.gzzid left join b_g_013 g on b.djgkid=g.id
	    	</when>
	    	<otherwise>
	    	     ,b.GCZLID, b.GCZLZXDXID, b.GCZLBH from
			     B_G_010 b left join t_user a on b.shrid=a.id left join t_user c on b.pfrid=c.id  left join d_012 d on b.jd=d.id left join d_005 e on b.zjh=e.zjh  AND B.DPRTCODE = E.DPRTCODE 
			     left join  t_user f on b.zdrid=f.id left join t_workgroup t on t.id=b.gzzid left join b_g_013 g on b.djgkid=g.id
	    	</otherwise>
	    </choose>		
	 <include refid="BaseResulParam"></include>
  </select>
  
  
    <!-- 查询工单参数 -->
	<sql id="workOrderParam">
	   <!-- 工单编号 -->
         <if test="keyword != null and keyword != ''">
		    and (
		           UPPER(A.gdbh) like UPPER('%'||#{keyword}||'%')
		        or UPPER(A.zhut) like UPPER('%'||#{keyword}||'%' )
		        )              <!-- 左右匹配 查询关键字 -->
		  </if>
	     <if  test="gdbh != null and gdbh != ''">
            and  A.gdbh = #{gdbh}
         </if>
          <if test="dprtcode != null and dprtcode != ''">                 
            and A.dprtcode = #{dprtcode}                            <!-- 组织机构 -->
          </if>
		  <if test="jx != null and jx != ''">
		    and C.fjjx = #{jx}                 
		  </if>
		  <if test="zy != null">  
		      <choose>
		    	<when test="zy==''">
		    		and  A.zy is null
		    	</when>
		    	<otherwise>
				    and  A.zy = #{zy}
		    	</otherwise>
			  </choose>	
		  </if>
		  <if test="gddlx != null and gddlx != ''">
		    and A.gddlx = #{gddlx}                 
		  </if>
		  	<if test="gdids != null and gdids!= ''">  
       			 and A.id not in  
       			 <foreach item="item" index="index" collection="gdids" open="("  
           		 separator="," close=")">  
            		#{item}  
       			 </foreach>  
    		</if> 
	</sql>
	
	 <select id="queryAllByDetailEngineeringId" resultMap="BaseResultMap" parameterType="com.eray.thjw.po.WorkOrder">
	 	select  ID, GDJCID, GDBH, GCZLID from b_g_010 where zt not in(8)
	 </select>
	
	
	
    <select id="selectAllWorkOrder" resultMap="BaseResultMap" parameterType="com.eray.thjw.po.WorkOrder">
			select A.id, A.gdjcid, A.gdbh, A.zy, A.gddlx, A.gdlx, A.zhut,A.dprtcode,A.zt
			
			from (select b7.id,b7.gdjcid,b7.gdbh,b7.zy, 2 gddlx, b7.gdlx ,b7.zhut
			,b7.dprtcode,b7.zt from b_g_007 b7 where b7.zt in (3,10)
			
			union all
			
			select b16.id, b16.gdjcid,b16.gdbh,b16.zy,1 as gddlx, 4 as gdlx,b16.zhut
			,b16.dprtcode,b16.zt from b_g_016 b16 where b16.zt in (3,10)
			
			union all
			
			select b10.id,b10.gdjcid,b10.gdbh,b10.zy, 3 as gddlx, 4 as gdlx, b10.zhut
			,b10.dprtcode,b10.zt from b_g_010 b10 where b10.zt in (3,10)
			
			) A join b_g_00604 B on A.gdjcid = B.mainid and B.zt = 1 join d_007 C on
			
			B.fjzch = C.fjzch AND B.dprtcode = C.dprtcode
			<include refid="workOrderParam"></include>
			<choose>                                                                                 <!-- 进行排序判断，如果默认就是默认字段排序 -->
				<when test='pagination.sort == "auto"'>
					order by A.gdbh asc
				</when>
				<otherwise>
					order by A.${pagination.sort} ${pagination.order}
				</otherwise>
			</choose>
  </select>
 	 
 	 <select id="selectCopyList" resultMap="BaseResultMap" parameterType="com.eray.thjw.po.WorkOrder">
			
	select A.lx,A.id, A.gdjcid, A.gdbh, A.zy, A.gddlx, A.gdlx, A.zhut,A.dprtcode,d.zjh ||' '|| d.zwms displayname , A.gzzw,A.gczlid,A.gczlbh,A.gczlzxdxid,A.gzzid,A.zt
      
		      from (select 'GD'as lx,b7.id,b7.gdjcid,b7.gdbh,b7.zy, 2 gddlx, b7.gdlx ,b7.zhut,b7.zjh,b7.gzzw,'' as gczlid,'' as gczlbh,'' as gczlzxdxid
		      ,b7.dprtcode ,b7.gzzid,b7.zt from b_g_007 b7 
		      
		      union all
		      
		      select 'GD'as lx,b16.id, b16.gdjcid,b16.gdbh,b16.zy,1 as gddlx, 4 as gdlx,b16.zhut,b16.zjh,b16.gzzw,'' as gczlid,'' as gczlbh,'' as gczlzxdxid
		      ,b16.dprtcode ,b16.gzzid,b16.zt from b_g_016 b16 
		      
		      union all
		      
		      select 'GD'as lx,b10.id,b10.gdjcid,b10.gdbh,b10.zy, 3 as gddlx, 4 as gdlx, b10.zhut,b10.zjh,b10.gzzw,b10.gczlid,b10.gczlbh,b10.gczlzxdxid
		      ,b10.dprtcode,b10.gzzid,b10.zt from b_g_010 b10 
		      
		      union all
		      
		      select 'GK'as lx, b13.id,b13.gdjcid,b13.gdbh,b13.zy, 10 as gddlx, 5 as gdlx, b13.gzzt zhut,b13.zjh,b13.gzzw,''as gczlid, '' as gczlbh,'' as gczlzxdxid
		      ,b13.dprtcode,b13.gzzid ,b13.zt from b_g_013 b13
		      
		      ) A left join d_005 d on A.zjh=d.zjh and A.dprtcode=d.dprtcode 
			
			where UPPER(A.gdbh) like UPPER('%'||#{keyword}||'%') and A.dprtcode =#{dprtcode,jdbcType=VARCHAR} and A.lx=#{lx,jdbcType=VARCHAR}
			<choose>                                                                                 <!-- 进行排序判断，如果默认就是默认字段排序 -->
				<when test='pagination.sort == "auto"'>
					order by A.gdbh asc
				</when>
				<otherwise>
					order by A.${pagination.sort} ${pagination.order}
				</otherwise>
			</choose>
  </select>

  	<select id="queryGlgdPage" parameterType="com.eray.thjw.po.BaseEntity" resultType="com.eray.thjw.po.WorkOrder">
			select *
			from (
				select b7.id,b7.gdjcid,b7.gdbh,b7.zy, 30+b7.gdlx as gdlx ,b7.zhut ,b7.dprtcode, b7.zdsj from b_g_007 b7 where b7.zt in (1,2,3,5,6)
				union all
				select b16.id,  b16.gdjcid,b16.gdbh,b16.zy, 10 as  gdlx,b16.zhut ,b16.dprtcode, b16.zdsj from b_g_016 b16 where b16.zt in (1,2,3,5,6)
				union all
				select b10.id,b10.gdjcid,b10.gdbh,b10.zy, 20  as  gdlx, b10.zhut ,b10.dprtcode, b10.zdsj from b_g_010 b10 where b10.zt in (1,2,3,5,6)
			) A 
			where A.dprtcode = #{paramsMap.dprtcode, jdbcType=VARCHAR}
				<if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
					and (UPPER(A.gdbh) like UPPER('%'||#{paramsMap.keyword, jdbcType=VARCHAR}||'%')
					   or UPPER(A.zhut) like UPPER('%'||#{paramsMap.keyword, jdbcType=VARCHAR}||'%'))
				</if>
				<if test="paramsMap != null and paramsMap.fjzch != null and paramsMap.fjzch != ''">
					and exists (select 1 from b_g_00604 B where A.gdjcid = B.mainid and B.fjzch=#{paramsMap.fjzch, jdbcType=VARCHAR})
				</if>
				<if test="paramsMap != null and paramsMap.gdlx != null and paramsMap.gdlx != ''">
					and A.gdlx = #{paramsMap.gdlx, jdbcType=VARCHAR}
				</if>
				<if test="paramsMap != null and paramsMap.zy != null">
					<choose>   
				    	<when test='paramsMap.zy == ""'>                       
				    		and A.zy is null
				    	</when>
				    	<otherwise>
						    and A.zy =#{paramsMap.zy}
				    	</otherwise>
		  			 </choose>
				</if>
				
			<choose>    <!--  进行排序判断，如果默认就是默认字段排序 -->
			    	<when test='pagination.sort == "auto"'>                       
			    		order by zdsj desc
			    	</when>
			    	<otherwise>
					    order by ${pagination.sort} ${pagination.order}
			    	</otherwise>
		   </choose>
		
 	 </select>
  
        <!-- 查询工单参数 -->
	<sql id="NonroutineParam">
	   where 
	   1=1  and  A.zt not in(8)
         <if test="paramsMap != null and paramsMap.keyword != null and paramsMap.keyword != ''">
		    and (  UPPER(A.gdbh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.pgdh) like  UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.fjzch) like  UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.bjh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.bjxlh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.zjh) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(E.zwms) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(B.USERNAME) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(B.REALNAME) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.xfgdyy) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	or UPPER(A.zhut) like UPPER('%'||#{paramsMap.keyword}||'%')
		    	) <!-- 左右匹配 查询关键字 -->
		  </if>
		<if test="paramsMap != null and paramsMap.dateBegin != null and paramsMap.dateBegin != ''">
		   and A.ZDSJ &gt;=to_date(#{paramsMap.dateBegin}||' 00:00:00','YYYY-MM-DD HH24:MI:SS') 
		
		</if>
		<if test="paramsMap != null and paramsMap.dateEnd != null and paramsMap.dateEnd != ''">
		  and  A.ZDSJ &lt;=to_date(#{paramsMap.dateEnd}||' 23:59:59','YYYY-MM-DD HH24:MI:SS') 
		
		</if> 
		   <!-- 工单类型 -->
	     <if test="paramsMap != null and paramsMap.gddlx != null  and paramsMap.gddlx != ''">
              and  A.gddlx = #{paramsMap.gddlx}
         </if>
          <if test="paramsMap != null and paramsMap.gdlx != null  and paramsMap.gdlx != ''">
              and  A.gdlx = #{paramsMap.gdlx}
         </if>
         <if test="paramsMap != null and paramsMap.zxfl != null  and paramsMap.zxfl!= ''">
            and  A.zxfl = #{paramsMap.zxfl}
         </if>
         <if test="paramsMap != null and paramsMap.zhuanye != null">
              <choose>
		    	<when test="paramsMap.zhuanye==''">
		    		and  A.zhuanye is null
		    	</when>
		    	<otherwise>
				    and  A.zhuanye = #{paramsMap.zhuanye}
		    	</otherwise>
			  </choose>	
         </if>
          <!-- 前台条件：飞机，机型，sql需要全部的范围，以及带上当前记录的机构码 -->
	     <choose>                                                                 
	    	<when test='paramsMap.userType!=null and paramsMap.userType == "admin"'>                       
	    		 AND exists 
	    		( SELECT 1 from D_007 where 
	    		A.fjzch = FJZCH
	    		AND A.dprtcode = DPRTCODE
	    		AND zt = 1
	    		)
	    	</when>
	    	<when test='paramsMap.userType != "admin" and paramsMap.userId != null and paramsMap.userId !=""'>                       
	    		 AND ( exists 
			    		( SELECT 1 from V_ROLE_JX where 
			    		A.fjzch= FJZCH
			    		AND A.dprtcode = DPRTCODE
			    		AND USER_ID = #{paramsMap.userId,jdbcType=VARCHAR}
			    		)
	    		 or  A.fjzch is NULL OR A.fjzch=''  )
	    	</when>
	   	</choose>
	   	 <if test="paramsMap != null and paramsMap.jd != null  and paramsMap.jd != ''">
            and  A.jd = #{paramsMap.jd}
         </if>
         <if test="paramsMap != null and paramsMap.zt != null  and paramsMap.zt != ''">
            and  A.zt = #{paramsMap.zt} 
         </if>
         <if test="paramsMap != null and paramsMap.dprtcode != null  and paramsMap.dprtcode!= ''">
            and  A.dprtcode = #{paramsMap.dprtcode} 
         </if>
         <if test="id != null and id!= ''">
            and  A.id = #{id} 
         </if>
	</sql>
	
	<!-- 根据工程指令id查询EO工单数据 -->
	<select id="queryByGczlId" resultMap="BaseResultMap" parameterType="java.lang.String" >
		select A.id,A.gczlid,A.gdjcid,A.gddlx,A.gdlx,A.gdbh,A.zdrid,A.zdsj,A.zt,A.dprtcode,A.zhuanye,A.zxfl,A.fjzch,A.bjh,A.bjxlh,A.pgdid,A.pgdh
			,A.xfgdyy,A.zjh,A.jd,A.zdjsyy,A.zdjsrq,A.zdjsrid,B.username,B.realname,C.dprtName,D.jdms
			,E.zwms ,F.username||' '||F.realname displayname,T.gzzdm||' '||gzzmc displaygzz from
		(
			select b10.id,b10.gczlid,b10.gdjcid,4 as gdlx,3 as gddlx,b10.gdbh,
			b10.zdrid,b10.zdsj,b10.zt,b10.dprtcode,b10.zy as zhuanye,b10.xfgdyy,b10.zjh,b10.jd,b10.zdjsyy,
			b10.zdjsrq,b10.zdjsrid,b10.gzzid,
			a.zxfl,a.fjzch,a.bjh,a.bjxlh,t.pgdh,t.pgdid 
			from b_g_010 b10 
			left join b_g_00604 a 
			on b10.gdjcid=a.mainid 
			left join (select zlid,wm_concat(c.pgdh||'@'||c.pgdid) pgdid, wm_concat(c.pgdh) pgdh from b_g_003 c where zlxl=6 group by c.zlid)t 
			on b10.id=t.zlid
		) A 
		left join t_user B 
		on A.zdrid= B.Id 
		left join t_department C 
		on A.dprtcode=C.id 
		left join d_012 D 
		on A.jd=D.Id  
		left join t_workgroup T 
		on T.id=A.gzzid
		left join d_005 E 
		on A.zjh=E.zjh AND A.DPRTCODE = E.DPRTCODE 
		left join t_user F 
		on A.zdjsrid=F.id
		where A.gczlid = #{gczlid} and A.zt not in(8)
		order by A.gdbh DESC
 	 </select>
 	 
 	 <!-- 根据评估单id、工单类型查询非例行工单数据 -->
	<select id="queryByPgdIdAndGdlx" resultMap="BaseResultMap" parameterType="java.lang.String" >
		select A.id,A.gdjcid,A.gddlx,A.gdlx,A.gdbh,A.zdrid,A.zdsj,A.zt,A.dprtcode,A.zhuanye,A.zxfl,A.fjzch,A.bjh,A.bjxlh,A.pgdid,A.pgdh
			,A.xfgdyy,A.zjh,A.jd,A.zdjsyy,A.zdjsrq,A.zdjsrid,B.username,B.realname,C.dprtName,D.jdms
			,E.zwms ,F.username||' '||F.realname displayname,T.gzzdm||' '||gzzmc displaygzz from
		(
			select b7.id,b7.gdjcid,b7.gdlx,2 as gddlx,b7.gdbh,b7.zdrid,b7.zdsj,b7.zt,b7.dprtcode,
			b7.zy as zhuanye,b7.xfgdyy,b7.zjh,b7.jd,b7.zdjsyy,b7.zdjsrq,b7.zdjsrid,b7.gzzid,
			a.zxfl,a.fjzch,a.bjh,a.bjxlh,t.pgdid,t.pgdh
			from b_g_007 b7 
			left join b_g_00604 a 
			on b7.gdjcid=a.mainid 
			left join (select zlid, wm_concat(c.pgdh||'@'||c.pgdid) pgdid ,wm_concat(c.pgdh) pgdh from b_g_003 c where zlxl=4 group by c.zlid)t 
			on b7.id=t.zlid
		) A 
		left join t_user B 
		on A.zdrid= B.Id 
		left join t_department C 
		on A.dprtcode=C.id 
		left join d_012 D 
		on A.jd=D.Id  
		left join t_workgroup T 
		on T.id=A.gzzid
		left join d_005 E 
		on A.zjh=E.zjh AND A.DPRTCODE = E.DPRTCODE 
		left join t_user F 
		on A.zdjsrid=F.id
		where A.id in (select ZLID from B_G_003 where PGDID = #{pgdid} and ZLXL = 4) and A.zt not in(8) and A.gdlx = #{gdlx}
		order by A.gdbh DESC
 	 </select>
 	 
 	 <!-- 根据工程指令id集合查询EO工单数据 -->
	<select id="queryByGczlIdList" resultMap="BaseResultMap" >
		select 
		ID, GDJCID, GDBH, GCZLID, GCZLBH, ZT
    	from B_G_010
    	where ZT != 8 AND GCZLID in
		<foreach collection="list" item="gczlIdList" index="index" open="(" close=")" separator=",">
			#{gczlIdList}
		 </foreach>
		 order by gdbh desc
 	</select>
 	
 	<!-- 根据非例行工单id集合查询非例行工单数据 -->
	<select id="queryByIdList" resultMap="BaseResultMap" >
		select 
		ID, GDLX, GDJCID, GDBH, ZT,
       	(
  		CASE 
     	WHEN GDLX = 2 THEN 4
     	WHEN GDLX = 3 THEN 5
  		END 
  		) GDZLX
    	from B_G_007
    	where ZT != 8 AND GDLX != 1 AND ID in
		<foreach collection="list" item="flxgdIdList" index="index" open="(" close=")" separator=",">
			#{flxgdIdList}
		 </foreach>
		 order by gdbh desc
 	</select>
	
    <select id="selectWorkOrderList" resultMap="BaseResultMap" parameterType="com.eray.thjw.po.WorkOrder">
	select A.id,A.gdjcid,A.gddlx,A.gdlx,A.gdbh,
	A.zdrid,A.zdsj,A.zt,A.dprtcode,A.zhuanye,A.zxfl,A.fjzch,A.bjh,A.bjxlh,A.pgdid,A.pgdh
	,A.xfgdyy,A.zhut
	,A.zjh,A.jd,A.zdjsyy,A.zdjsrq,A.zdjsrid,B.username,B.realname,C.dprtName,D.jdms
	,E.zwms ,F.username||' '||F.realname displayname,T.gzzdm||' '||gzzmc displaygzz from
	(
	<!-- 非例行工单关联执行对象和指令来源 -->
	select b7.id,b7.gdjcid,b7.gdlx,2 as gddlx,b7.gdbh,b7.zdrid,b7.zdsj,b7.zt,b7.dprtcode,
	b7.zy as zhuanye,b7.xfgdyy,b7.zhut,b7.zjh,b7.jd,b7.zdjsyy,b7.zdjsrq,b7.zdjsrid,b7.gzzid,
	a.zxfl,a.fjzch,a.bjh,a.bjxlh,t.pgdid,t.pgdh
	from b_g_007 b7 left join b_g_00604 a on b7.gdjcid=a.mainid left join

	(select zlid, wm_concat(c.pgdh||'@'||c.pgdid) pgdid ,wm_concat(c.pgdh) pgdh from b_g_003 c where zlxl=4 group
	by c.zlid)t on b7.id=t.zlid

	union all

	<!-- 定检工单关联执行对象和指令来源 -->
	select b16.id,b16.gdjcid,4 as gdlx,1 as gddlx,b16.gdbh,
	b16.zdrid,b16.zdsj,b16.zt,b16.dprtcode,b16.zy as zhuanye,b16.xfgdyy,b16.zhut,b16.zjh,b16.jd,b16.zdjsyy,
	b16.zdjsrq,b16.zdjsrid,b16.gzzid,
	a.zxfl,a.fjzch,a.bjh,a.bjxlh,t.pgdid,t.pgdh
	from b_g_016 b16 left join b_g_00604 a on b16.gdjcid=a.mainid left join

	(select zlid,wm_concat(c.pgdh||'@'||c.pgdid) pgdid ,wm_concat(c.pgdh) pgdh  from b_g_003 c where zlxl=5 group
	by c.zlid)t on b16.id=t.zlid

	union all

	<!-- EO工单关联执行对象和指令来源 -->
	select b10.id,b10.gdjcid,4 as gdlx,3 as gddlx,b10.gdbh,
	b10.zdrid,b10.zdsj,b10.zt,b10.dprtcode,b10.zy as zhuanye,b10.xfgdyy,b10.zhut,b10.zjh,b10.jd,b10.zdjsyy,
	b10.zdjsrq,b10.zdjsrid,b10.gzzid,
	a.zxfl,a.fjzch,a.bjh,a.bjxlh,t.pgdh,t.pgdid 
	from b_g_010 b10 left join b_g_00604 a on b10.gdjcid=a.mainid left join

	(select zlid,wm_concat(c.pgdh||'@'||c.pgdid) pgdid, wm_concat(c.pgdh) pgdh from b_g_003 c where zlxl=6 group by
	c.zlid)t on b10.id=t.zlid

	) A left join t_user B on A.zdrid= B.Id left join t_department C on
	A.dprtcode=C.id left join d_012 D on A.jd=D.Id  left join t_workgroup T on T.id=A.gzzid

	left join d_005 E on A.zjh=E.zjh AND A.DPRTCODE = E.DPRTCODE left join t_user F on A.zdjsrid=F.id

	<include refid="NonroutineParam" />

	<choose>                                                                                 <!-- 进行排序判断，如果默认就是默认字段排序 -->
		<when test='pagination.sort == "auto"'>
			order by A.zdsj DESC
		</when>
		<otherwise>
			order by ${pagination.sort} ${pagination.order}
		</otherwise>
	</choose>
  </select>
  
   <!-- 新增工单 -->
	<insert id="insertSelective" parameterType="com.eray.thjw.po.WorkOrder">
		insert into
		<choose>
			<when test="gddlx == 2">
				B_G_007
				<trim prefix="(" suffix=")" suffixOverrides=",">
					<if test="id != null">
						ID,
					</if>
					<if test="gdlx != null">
						GDLX,
					</if>
					<if test="gdjcid != null">
						GDJCID,
					</if>
					<if test="gdbh != null">
						GDBH,
					</if>
					<if test="gczlid != null">
						GCZLID,
					</if>
					<if test="gczlzxdxid != null">
						GCZLZXDXID,
					</if>
					<if test="gczlbh != null">
						GCZLBH,
					</if>
					<if test="zy != null">
						ZY,
					</if>
					<if test="jhgsRs != null">
						JHGS_RS,
					</if>
					<if test="jhgsXss != null">
						JHGS_XSS,
					</if>
					<if test="xfgdyy != null">
						XFGDYY,
					</if>
					<if test="bz != null">
						BZ,
					</if>
					<if test="zddwid != null">
						ZDDWID,
					</if>
					<if test="zdrid != null">
						ZDRID,
					</if>
					ZDSJ,
					<if test="zt != null">
						ZT,
					</if>
					<if test="dprtcode != null">
						DPRTCODE,
					</if>
					<if test="zdjsrid != null">
						ZDJSRID,
					</if>
					<if test="zdjsrq != null">
						ZDJSRQ,
					</if>
					<if test="zdjsyy != null">
						ZDJSYY,
					</if>
					<if test="shbmid != null">
						SHBMID,
					</if>
					<if test="shyj != null">
						SHYJ,
					</if>
					<if test="shrid != null">
						SHRID,
					</if>
					<if test="shsj != null">
						SHSJ,
					</if>
					<if test="pfbmid != null">
						PFBMID,
					</if>
					<if test="pfyj != null">
						PFYJ,
					</if>
					<if test="pfrid != null">
						PFRID,
					</if>
					<if test="pfsj != null">
						PFSJ,
					</if>
					<if test="jkbz != null">
						JKBZ,
					</if>
					<if test="zhut != null">
						ZHUT,
					</if>
					<if test="zjh != null">
						ZJH,
					</if>
					<if test="jd != null">
						JD,
					</if>
					<if test="glxx != null">
						GLXX,
					</if>
					<if test="isXyjszy != null">
						IS_XYJSZY,
					</if>
					<if test="tcsj != null">
						TCSJ,
					</if>
					<if test="refJhly != null">
						REF_JHLY,
					</if>
					<if test="gzzw != null">
						GZZW,
					</if>
					<if test="gzzid != null">
						GZZID,
					</if>
					<if test="djgkid != null">
						DJGKID,
					</if>
				</trim>
				<trim prefix="values (" suffix=")" suffixOverrides=",">
					<if test="id != null">
						#{id,jdbcType=VARCHAR},
					</if>
					<if test="gdlx != null">
						#{gdlx,jdbcType=VARCHAR},
					</if>
					<if test="gdjcid != null">
						#{gdjcid,jdbcType=VARCHAR},
					</if>
					<if test="gdbh != null">
						#{gdbh,jdbcType=VARCHAR},
					</if>
					<if test="gczlid != null">
						#{gczlid,jdbcType=VARCHAR},
					</if>
					<if test="gczlzxdxid != null">
						#{gczlzxdxid,jdbcType=VARCHAR},
					</if>
					<if test="gczlbh != null">
						#{gczlbh,jdbcType=VARCHAR},
					</if>
					<if test="zy != null">
						#{zy,jdbcType=VARCHAR},
					</if>
					<if test="jhgsRs != null">
						#{jhgsRs,jdbcType=DECIMAL},
					</if>
					<if test="jhgsXss != null">
						#{jhgsXss,jdbcType=DECIMAL},
					</if>
					<if test="xfgdyy != null">
						#{xfgdyy,jdbcType=VARCHAR},
					</if>
					<if test="bz != null">
						#{bz,jdbcType=VARCHAR},
					</if>
					<if test="zddwid != null">
						#{zddwid,jdbcType=VARCHAR},
					</if>
					<if test="zdrid != null">
						#{zdrid,jdbcType=VARCHAR},
					</if>
					sysdate,
					<if test="zt != null">
						#{zt,jdbcType=DECIMAL},
					</if>
					<if test="dprtcode != null">
						#{dprtcode,jdbcType=VARCHAR},
					</if>
					<if test="zdjsrid != null">
						#{zdjsrid,jdbcType=VARCHAR},
					</if>
					<if test="zdjsrq != null">
						#{zdjsrq,jdbcType=TIMESTAMP},
					</if>
					<if test="zdjsyy != null">
						#{zdjsyy,jdbcType=VARCHAR},
					</if>
					<if test="shbmid != null">
						#{shbmid,jdbcType=VARCHAR},
					</if>
					<if test="shyj != null">
						#{shyj,jdbcType=VARCHAR},
					</if>
					<if test="shrid != null">
						#{shrid,jdbcType=VARCHAR},
					</if>
					<if test="shsj != null">
						#{shsj,jdbcType=TIMESTAMP},
					</if>
					<if test="pfbmid != null">
						#{pfbmid,jdbcType=VARCHAR},
					</if>
					<if test="pfyj != null">
						#{pfyj,jdbcType=VARCHAR},
					</if>
					<if test="pfrid != null">
						#{pfrid,jdbcType=VARCHAR},
					</if>
					<if test="pfsj != null">
						#{pfsj,jdbcType=TIMESTAMP},
					</if>
					<if test="jkbz != null">
						#{jkbz,jdbcType=VARCHAR},
					</if>
					<if test="zhut != null">
						#{zhut,jdbcType=VARCHAR},
					</if>
					<if test="zjh != null">
						#{zjh,jdbcType=VARCHAR},
					</if>
					<if test="jd != null">
						#{jd,jdbcType=VARCHAR},
					</if>
					<if test="glxx != null">
						#{glxx,jdbcType=VARCHAR},
					</if>
					<if test="isXyjszy != null">
						#{isXyjszy,jdbcType=DECIMAL},
					</if>
					<if test="tcsj != null">
						#{tcsj,jdbcType=TIMESTAMP},
					</if>
					<if test="refJhly != null">
						#{refJhly,jdbcType=VARCHAR},
					</if>
					<if test="gzzw != null">
						#{gzzw,jdbcType=VARCHAR},
					</if>
					<if test="gzzid != null">
						#{gzzid,jdbcType=VARCHAR},
					</if>
					<if test="djgkid != null">
						#{djgkid,jdbcType=VARCHAR},
					</if>
				</trim>
			</when>
			<when test="gddlx == 3">
				B_G_010
				<trim prefix="(" suffix=")" suffixOverrides=",">
					<if test="id != null">
						ID,
					</if>
					<if test="gdjcid != null">
						GDJCID,
					</if>
					<if test="gdbh != null">
						GDBH,
					</if>
					<if test="gczlid != null">
						GCZLID,
					</if>
					<if test="gczlzxdxid != null">
						GCZLZXDXID,
					</if>
					<if test="gczlbh != null">
						GCZLBH,
					</if>
					<if test="zy != null">
						ZY,
					</if>
					<if test="jhgsRs != null">
						JHGS_RS,
					</if>
					<if test="jhgsXss != null">
						JHGS_XSS,
					</if>
					<if test="xfgdyy != null">
						XFGDYY,
					</if>
					<if test="bz != null">
						BZ,
					</if>
					<if test="zddwid != null">
						ZDDWID,
					</if>
					<if test="zdrid != null">
						ZDRID,
					</if>
					ZDSJ,
					<if test="zt != null">
						ZT,
					</if>
					<if test="dprtcode != null">
						DPRTCODE,
					</if>
					<if test="zdjsrid != null">
						ZDJSRID,
					</if>
					<if test="zdjsrq != null">
						ZDJSRQ,
					</if>
					<if test="zdjsyy != null">
						ZDJSYY,
					</if>
					<if test="shbmid != null">
						SHBMID,
					</if>
					<if test="shyj != null">
						SHYJ,
					</if>
					<if test="shrid != null">
						SHRID,
					</if>
					<if test="shsj != null">
						SHSJ,
					</if>
					<if test="pfbmid != null">
						PFBMID,
					</if>
					<if test="pfyj != null">
						PFYJ,
					</if>
					<if test="pfrid != null">
						PFRID,
					</if>
					<if test="pfsj != null">
						PFSJ,
					</if>
					<if test="jkbz != null">
						JKBZ,
					</if>
					<if test="zhut != null">
						ZHUT,
					</if>
					<if test="zjh != null">
						ZJH,
					</if>
					<if test="jd != null">
						JD,
					</if>
					<if test="gzzw != null">
						GZZW,
					</if>
					<if test="gzzid != null">
						GZZID,
					</if>
					<if test="djgkid != null">
						DJGKID,
					</if>
				</trim>
				<trim prefix="values (" suffix=")" suffixOverrides=",">
					<if test="id != null">
						#{id,jdbcType=VARCHAR},
					</if>
					<if test="gdjcid != null">
						#{gdjcid,jdbcType=VARCHAR},
					</if>
					<if test="gdbh != null">
						#{gdbh,jdbcType=VARCHAR},
					</if>
					<if test="gczlid != null">
						#{gczlid,jdbcType=VARCHAR},
					</if>
					<if test="gczlzxdxid != null">
						#{gczlzxdxid,jdbcType=VARCHAR},
					</if>
					<if test="gczlbh != null">
						#{gczlbh,jdbcType=VARCHAR},
					</if>
					<if test="zy != null">
						#{zy,jdbcType=VARCHAR},
					</if>
					<if test="jhgsRs != null">
						#{jhgsRs,jdbcType=DECIMAL},
					</if>
					<if test="jhgsXss != null">
						#{jhgsXss,jdbcType=DECIMAL},
					</if>
					<if test="xfgdyy != null">
						#{xfgdyy,jdbcType=VARCHAR},
					</if>
					<if test="bz != null">
						#{bz,jdbcType=VARCHAR},
					</if>
					<if test="zddwid != null">
						#{zddwid,jdbcType=VARCHAR},
					</if>
					<if test="zdrid != null">
						#{zdrid,jdbcType=VARCHAR},
					</if>
					sysdate,
					<if test="zt != null">
						#{zt,jdbcType=DECIMAL},
					</if>
					<if test="dprtcode != null">
						#{dprtcode,jdbcType=VARCHAR},
					</if>
					<if test="zdjsrid != null">
						#{zdjsrid,jdbcType=VARCHAR},
					</if>
					<if test="zdjsrq != null">
						#{zdjsrq,jdbcType=TIMESTAMP},
					</if>
					<if test="zdjsyy != null">
						#{zdjsyy,jdbcType=VARCHAR},
					</if>
					<if test="shbmid != null">
						#{shbmid,jdbcType=VARCHAR},
					</if>
					<if test="shyj != null">
						#{shyj,jdbcType=VARCHAR},
					</if>
					<if test="shrid != null">
						#{shrid,jdbcType=VARCHAR},
					</if>
					<if test="shsj != null">
						#{shsj,jdbcType=TIMESTAMP},
					</if>
					<if test="pfbmid != null">
						#{pfbmid,jdbcType=VARCHAR},
					</if>
					<if test="pfyj != null">
						#{pfyj,jdbcType=VARCHAR},
					</if>
					<if test="pfrid != null">
						#{pfrid,jdbcType=VARCHAR},
					</if>
					<if test="pfsj != null">
						#{pfsj,jdbcType=TIMESTAMP},
					</if>
					<if test="jkbz != null">
						#{jkbz,jdbcType=VARCHAR},
					</if>
					<if test="zhut != null">
						#{zhut,jdbcType=VARCHAR},
					</if>
					<if test="zjh != null">
						#{zjh,jdbcType=VARCHAR},
					</if>
					<if test="jd != null">
						#{jd,jdbcType=VARCHAR},
					</if>
					<if test="gzzw != null">
						#{gzzw,jdbcType=VARCHAR},
					</if>
					<if test="gzzid != null">
						#{gzzid,jdbcType=VARCHAR},
					</if>
					<if test="djgkid != null">
						#{djgkid,jdbcType=VARCHAR},
					</if>
				</trim>
			</when>
			<otherwise>
				B_G_016
				<trim prefix="(" suffix=")" suffixOverrides=",">
					<if test="id != null">
						ID,
					</if>
					<if test="nbxh != null">
						nbxh,
					</if>
					<if test="gdjcid != null">
						GDJCID,
					</if>
					<if test="gdbh != null">
						GDBH,
					</if>
					<if test="zy != null">
						ZY,
					</if>
					<if test="jhgsRs != null">
						JHGS_RS,
					</if>
					<if test="jhgsXss != null">
						JHGS_XSS,
					</if>
					<if test="xfgdyy != null">
						XFGDYY,
					</if>
					<if test="bz != null">
						BZ,
					</if>
					<if test="zddwid != null">
						ZDDWID,
					</if>
					<if test="zdrid != null">
						ZDRID,
					</if>
					ZDSJ,
					<if test="zt != null">
						ZT,
					</if>
					<if test="dprtcode != null">
						DPRTCODE,
					</if>
					<if test="zdjsrid != null">
						ZDJSRID,
					</if>
					<if test="zdjsrq != null">
						ZDJSRQ,
					</if>
					<if test="zdjsyy != null">
						ZDJSYY,
					</if>
					<if test="shbmid != null">
						SHBMID,
					</if>
					<if test="shyj != null">
						SHYJ,
					</if>
					<if test="shrid != null">
						SHRID,
					</if>
					<if test="shsj != null">
						SHSJ,
					</if>
					<if test="pfbmid != null">
						PFBMID,
					</if>
					<if test="pfyj != null">
						PFYJ,
					</if>
					<if test="pfrid != null">
						PFRID,
					</if>
					<if test="pfsj != null">
						PFSJ,
					</if>
					<if test="jkbz != null">
						JKBZ,
					</if>
					<if test="zhut != null">
						ZHUT,
					</if>
					<if test="zjh != null">
						ZJH,
					</if>
					<if test="jd != null">
						JD,
					</if>
					<if test="djrwdid != null">
						DJRWDID,
					</if>
					<if test="djgkid != null">
						DJGKID,
					</if>
					<if test="cksc != null">
						cksc,
					</if>
					<if test="ckgk != null">
						ckgk,
					</if>
					<if test="gzzw != null">
						gzzw,
					</if>
					<if test="bcwj != null">
						bcwj,
					</if>
					<if test="gzdd != null">
						gzdd,
					</if>
					<if test="gzzid != null">
						gzzid,
					</if>
				</trim>
				<trim prefix="values (" suffix=")" suffixOverrides=",">
					<if test="id != null">
						#{id,jdbcType=VARCHAR},
					</if>
					<if test="nbxh != null">
						#{nbxh,jdbcType=VARCHAR},
					</if>
					<if test="gdjcid != null">
						#{gdjcid,jdbcType=VARCHAR},
					</if>
					<if test="gdbh != null">
						#{gdbh,jdbcType=VARCHAR},
					</if>
					<if test="gczlid != null">
						#{gczlid,jdbcType=VARCHAR},
					</if>
					<if test="gczlzxdxid != null">
						#{gczlzxdxid,jdbcType=VARCHAR},
					</if>
					<if test="gczlbh != null">
						#{gczlbh,jdbcType=VARCHAR},
					</if>
					<if test="zy != null">
						#{zy,jdbcType=VARCHAR},
					</if>
					<if test="jhgsRs != null">
						#{jhgsRs,jdbcType=DECIMAL},
					</if>
					<if test="jhgsXss != null">
						#{jhgsXss,jdbcType=DECIMAL},
					</if>
					<if test="xfgdyy != null">
						#{xfgdyy,jdbcType=VARCHAR},
					</if>
					<if test="bz != null">
						#{bz,jdbcType=VARCHAR},
					</if>
					<if test="zddwid != null">
						#{zddwid,jdbcType=VARCHAR},
					</if>
					<if test="zdrid != null">
						#{zdrid,jdbcType=VARCHAR},
					</if>
					sysdate,
					<if test="zt != null">
						#{zt,jdbcType=DECIMAL},
					</if>
					<if test="dprtcode != null">
						#{dprtcode,jdbcType=VARCHAR},
					</if>
					<if test="zdjsrid != null">
						#{zdjsrid,jdbcType=VARCHAR},
					</if>
					<if test="zdjsrq != null">
						#{zdjsrq,jdbcType=TIMESTAMP},
					</if>
					<if test="zdjsyy != null">
						#{zdjsyy,jdbcType=VARCHAR},
					</if>
					<if test="shbmid != null">
						#{shbmid,jdbcType=VARCHAR},
					</if>
					<if test="shyj != null">
						#{shyj,jdbcType=VARCHAR},
					</if>
					<if test="shrid != null">
						#{shrid,jdbcType=VARCHAR},
					</if>
					<if test="shsj != null">
						#{shsj,jdbcType=TIMESTAMP},
					</if>
					<if test="pfbmid != null">
						#{pfbmid,jdbcType=VARCHAR},
					</if>
					<if test="pfyj != null">
						#{pfyj,jdbcType=VARCHAR},
					</if>
					<if test="pfrid != null">
						#{pfrid,jdbcType=VARCHAR},
					</if>
					<if test="pfsj != null">
						#{pfsj,jdbcType=TIMESTAMP},
					</if>
					<if test="jkbz != null">
						#{jkbz,jdbcType=VARCHAR},
					</if>
					<if test="zhut != null">
						#{zhut,jdbcType=VARCHAR},
					</if>
					<if test="zjh != null">
						#{zjh,jdbcType=VARCHAR},
					</if>
					<if test="jd != null">
						#{jd,jdbcType=VARCHAR},
					</if>
					<if test="djrwdid != null">
						#{djrwdid,jdbcType=VARCHAR},
					</if>
					<if test="djgkid != null">
						#{djgkid,jdbcType=VARCHAR},
					</if>
					<if test="cksc != null">
						#{cksc,jdbcType=VARCHAR},
					</if>
					<if test="ckgk != null">
						#{ckgk,jdbcType=VARCHAR},
					</if>
					<if test="gzzw != null">
						#{gzzw,jdbcType=VARCHAR},
					</if>
					<if test="bcwj != null">
						#{bcwj,jdbcType=VARCHAR},
					</if>
					<if test="gzdd != null">
						#{gzdd,jdbcType=VARCHAR},
					</if>
					<if test="gzzid != null">
						#{gzzid,jdbcType=VARCHAR},
					</if>
				</trim>
			</otherwise>
		</choose>
	</insert>
  
  <!-- 审核 -->
  <update id="updateAudit" parameterType="com.eray.thjw.po.WorkOrder">
    update
        <choose>
	    	<when test="gddlx== 2">
	    		  B_G_007
	    	</when>
	    	<when test="gddlx== 1 ">
	    		  B_G_016
	    	</when>
	    	<otherwise>
			     B_G_010
	    	</otherwise>
		 </choose>	
    <set>
      <if test="shbmid != null">
        shbmid = #{shbmid,jdbcType=VARCHAR},
      </if>
      <if test="shrid != null">
        shrid = #{shrid,jdbcType=VARCHAR},
      </if>
        shsj = sysdate,
      <if test="shyj != null">
        shyj  = #{shyj ,jdbcType=VARCHAR},
      </if>
      <if test="zt != null">
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
    </set>
        where ID = #{id,jdbcType=VARCHAR}
  </update> 
 
<!--   批量审核批准非例行工单 -->
<update id="updateBatchReviewAndApproveNon"  parameterType="com.eray.thjw.po.WorkOrder" >
    update B_G_007
    <set >
      <choose>
    	<when test="czlx== 'review' ">
    		  <if test="shrid != null" >
		        shrid = #{shrid,jdbcType=DECIMAL},
		      </if>
		      <if test="shbmid != null" >
		        shbmid = #{shbmid,jdbcType=DECIMAL},
		      </if>
		      <if test="shyj != null" >
		        shyj = #{shyj,jdbcType=VARCHAR},
		      </if>
		        shsj = sysdate,
		       <if test="zt != null" >
		        zt = #{zt,jdbcType=DECIMAL},
		       </if>
    	</when>
    	<otherwise>
		    <if test="pfrid != null" >
		        pfrid = #{pfrid,jdbcType=DECIMAL},
		      </if>
		      <if test="pfbmid != null" >
		        pfbmid = #{pfbmid,jdbcType=DECIMAL},
		      </if>
		      <if test="pfyj != null" >
		        pfyj = #{pfyj,jdbcType=VARCHAR},
		      </if>
		        pfsj = sysdate,
		   	  <if test="zt != null" >
		        zt = #{zt,jdbcType=DECIMAL},
		      </if>
    	</otherwise>
	  </choose>
    </set>
    where ID in
     <foreach collection="ids" item="id" index="index" open="(" close=")" separator=",">
		#{id}
	 </foreach>
  </update>
  
  <!--   批量审核批准EO工单 -->
<update id="updateBatchReviewAndApproveEO"  parameterType="com.eray.thjw.po.WorkOrder" >
    update B_G_010
    <set >
   	  <choose>
    	<when test="czlx== 'review'">
    		  <if test="shrid != null" >
		        shrid = #{shrid,jdbcType=DECIMAL},
		      </if>
		      <if test="shbmid != null" >
		        shbmid = #{shbmid,jdbcType=DECIMAL},
		      </if>
		      <if test="shyj != null" >
		        shyj = #{shyj,jdbcType=VARCHAR},
		      </if>
		        shsj = sysdate,
		       <if test="zt != null" >
		        zt = #{zt,jdbcType=DECIMAL},
		       </if>
    	</when>
    	<otherwise>
		    <if test="pfrid != null" >
		        pfrid = #{pfrid,jdbcType=DECIMAL},
		      </if>
		      <if test="pfbmid != null" >
		        pfbmid = #{pfbmid,jdbcType=DECIMAL},
		      </if>
		      <if test="pfyj != null" >
		        pfyj = #{pfyj,jdbcType=VARCHAR},
		      </if>
		        pfsj = sysdate,
		   	  <if test="zt != null" >
		        zt = #{zt,jdbcType=DECIMAL},
		      </if>
    	</otherwise>
	  </choose>
    </set>
       where ID in
     <foreach collection="ids" item="id" index="index" open="(" close=")" separator=",">
		#{id}
	 </foreach>
  </update>
  
  <!-- 批准 -->
  <update id="updateReply" parameterType="com.eray.thjw.po.WorkOrder">
    update
        <choose>
	    	<when test="gddlx== 2">
	    		  B_G_007
	    	</when>
	    	<when test="gddlx== 1 ">
	    		  B_G_016
	    	</when>
	    	<otherwise>
			     B_G_010
	    	</otherwise>
		 </choose>	
    <set>
     <if test="pfbmid != null">
        pfbmid = #{pfbmid,jdbcType=VARCHAR},
      </if>
      <if test="pfrid != null">
        pfrid = #{pfrid,jdbcType=VARCHAR},
      </if>
        pfsj = sysdate,
      <if test="pfyj != null">
        pfyj  = #{pfyj ,jdbcType=VARCHAR},
      </if>
      <if test="zt != null">
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
  </set>
        where ID = #{id,jdbcType=VARCHAR}
  </update> 
  
   <!-- 指定结束 -->
  <update id="updateOver" parameterType="com.eray.thjw.po.WorkOrder">
    update
        <choose>
	    	<when test="gddlx== 2">
	    		  B_G_007
	    	</when>
	    	<when test="gddlx== 1 ">
	    		  B_G_016
	    	</when>
	    	<otherwise>
			     B_G_010
	    	</otherwise>
		 </choose>	
    <set>
     <if test="zdjsrid != null">
        zdjsrid = #{zdjsrid,jdbcType=VARCHAR},
      </if>
        zdjsrq = sysdate,
      <if test="zdjsyy != null">
        zdjsyy  = #{zdjsyy ,jdbcType=VARCHAR},
      </if>
      <if test="zt != null">
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
  </set>
        where ID = #{id,jdbcType=VARCHAR}
  </update> 
  
   <!-- 定检任务单指定结束结束所有的工单 -->
  <update id="doEnd" parameterType="com.eray.thjw.po.WorkOrder">
    update B_G_016
    <set>
     <if test="zdjsrid != null">
        zdjsrid = #{zdjsrid,jdbcType=VARCHAR},
      </if>
        zdjsrq = sysdate,
      <if test="zdjsyy != null">
        zdjsyy  = #{zdjsyy ,jdbcType=VARCHAR},
      </if>
      <if test="zt != null">
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
  </set>
        where djrwdid = #{djrwdid,jdbcType=VARCHAR}
  </update> 
  
  <!-- 作废工单 -->
  <update id="updateCancel" parameterType="com.eray.thjw.po.WorkOrder">
    update
        <choose>
	    	<when test="gddlx== 2">
	    		  B_G_007
	    	</when>
	    	<when test="gddlx== 1 ">
	    		  B_G_016
	    	</when>
	    	<otherwise>
			     B_G_010
	    	</otherwise>
		 </choose>	
    <set>
      <if test="zt != null">
        ZT = #{zt,jdbcType=DECIMAL},
      </if>
  </set>
        where ID = #{id,jdbcType=VARCHAR}
  </update> 
  
<!--   修改工单 -->
  
   <update id="updateByPrimaryKeySelective" parameterType="com.eray.thjw.po.WorkOrder" >
    update 
          <choose>
	    	<when test="gddlx== 2">
	    		  B_G_007
	    	</when>
	    	<when test="gddlx== 1 ">
	    		  B_G_016
	    	</when>
	    	<otherwise>
			     B_G_010
	    	</otherwise>
		 </choose>	  
		 <set>
	      <if test="gdlx != null">
	        GDLX=#{gdlx,jdbcType=DECIMAL},
	      </if>
	      <if test="gdjcid != null" >
	        GDJCID=#{gdjcid,jdbcType=VARCHAR},
	      </if>
	      <if test="gdbh != null" >
	        GDBH=#{gdbh,jdbcType=VARCHAR},
	      </if>
	      <if test="gczlid != null" >
	        GCZLID=#{gczlid,jdbcType=VARCHAR},
	      </if>
	      <if test="gczlzxdxid != null" >
	        GCZLZXDXID=#{gczlzxdxid,jdbcType=VARCHAR},
	      </if>
	      <if test="gczlbh != null" >
	        GCZLBH=#{gczlbh,jdbcType=VARCHAR},
	      </if>
	      <if test="zy != null" >
	        ZY=#{zy,jdbcType=VARCHAR},
	      </if>
	      <if test="jhgsRs != null" >
	        JHGS_RS=#{jhgsRs,jdbcType=DECIMAL},
	      </if>
	      <if test="jhgsXss != null" >
	        JHGS_XSS=#{jhgsXss,jdbcType=DECIMAL},
	      </if>
	      <if test="xfgdyy != null" >
	        XFGDYY=#{xfgdyy,jdbcType=VARCHAR},
	      </if>
	      <if test="bz != null" >
	        BZ=#{bz,jdbcType=VARCHAR},
	      </if>
	      <if test="gzzw != null and gzzw != ''" >
	        GZZW=#{gzzw,jdbcType=VARCHAR},
	      </if>
	      <if test="gzzid != null and gzzid != ''" >
	        GZZID=#{gzzid,jdbcType=VARCHAR},
	      </if>
	      <if test="zddwid != null and zddwid != ''" >
	        ZDDWID=#{zddwid,jdbcType=VARCHAR},
	      </if>
	      <if test="zdrid != null and zdrid != ''" >
	        ZDRID=#{zdrid,jdbcType=VARCHAR},
	      </if>
	      <if test="zt != null " >
	        ZT=#{zt,jdbcType=DECIMAL},
	      </if>
<!-- 	      <if test="dprtcode != null and dprtcode != ''" > -->
<!-- 	        DPRTCODE=#{dprtcode,jdbcType=VARCHAR}, -->
<!-- 	      </if> -->
	      <if test="zdjsrid != null and zdjsrid != ''" >
	        ZDJSRID=#{zdjsrid,jdbcType=VARCHAR},
	      </if>
	      <if test="zdjsrq != null and zdjsrq != ''" >
	        ZDJSRQ=#{zdjsrq,jdbcType=VARCHAR},
	      </if>
	      <if test="zdjsyy != null" >
	        ZDJSYY=#{zdjsyy,jdbcType=VARCHAR},
	      </if>
	      <if test="shbmid != null and shbmid != ''" >
	        SHBMID=#{shbmid,jdbcType=VARCHAR},
	      </if>
	      <if test="shyj != null" >
	        SHYJ=#{shyj,jdbcType=VARCHAR},
	      </if>
	      <if test="shrid != null and shrid != ''" >
	        SHRID=#{shrid,jdbcType=VARCHAR},
	      </if>
	      <if test="shsj != null and shsj != ''" >
	        SHSJ=#{shsj,jdbcType=VARCHAR},
	      </if>
	      <if test="pfbmid != null and pfbmid != ''" >
	        PFBMID=#{pfbmid,jdbcType=VARCHAR},
	      </if>
	      <if test="pfyj != null" >
	        PFYJ=#{pfyj,jdbcType=VARCHAR},
	      </if>
	      <if test="pfrid != null and pfrid != ''" >
	        PFRID=#{pfrid,jdbcType=VARCHAR},
	      </if>
	      <if test="pfsj != null" >
	        PFSJ=#{pfsj,jdbcType=VARCHAR},
	      </if>
	      <if test="jkbz != null" >
	        JKBZ=#{jkbz,jdbcType=VARCHAR},
	      </if>
	      <if test="zhut != null" >            
	        ZHUT=#{zhut,jdbcType=VARCHAR},
	      </if>
	      <if test="zjh != null" >
	        ZJH=#{zjh,jdbcType=VARCHAR},
	      </if>
	      <if test="jd != null" >
	        JD=#{jd,jdbcType=VARCHAR},
	      </if>
	      <if test="glxx != null" >
	        GLXX=#{glxx,jdbcType=VARCHAR},
	      </if>
	      <if test="isXyjszy != null" >
	        IS_XYJSZY=#{isXyjszy,jdbcType=DECIMAL},
	      </if>
	       <if test="tcsj != null" >
	        TCSJ=#{tcsj,jdbcType=VARCHAR},
	      </if>
	      <if test="refJhly != null" >
	        REF_JHLY=#{refJhly,jdbcType=VARCHAR},
	      </if>
    </set>
		where ID  = #{id,jdbcType=VARCHAR}
  </update>
  
  
  
  
  
  
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from B_G_010
    where ID = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from B_G_010
    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.eray.thjw.po.WorkOrder" >
    insert into B_G_010 (ID, GDJCID, GDBH, 
      GCZLID, GCZLZXDXID, GCZLBH, 
      ZY, JHGS_RS, JHGS_XSS, 
      XFGDYY, BZ, ZDDWID, 
      ZDRID, ZDSJ, ZT, 
      DPRTCODE, ZDJSRID, ZDJSRQ, 
      ZDJSYY, SHBMID, SHYJ, 
      SHRID, SHSJ, PFBMID, 
      PFYJ, PFRID, PFSJ, 
      JKBZ, ZHUT)
    values (#{id,jdbcType=VARCHAR}, #{gdjcid,jdbcType=VARCHAR}, #{gdbh,jdbcType=VARCHAR}, 
      #{gczlid,jdbcType=VARCHAR}, #{gczlzxdxid,jdbcType=VARCHAR}, #{gczlbh,jdbcType=VARCHAR}, 
      #{zy,jdbcType=VARCHAR}, #{jhgsRs,jdbcType=DECIMAL}, #{jhgsXss,jdbcType=DECIMAL}, 
      #{xfgdyy,jdbcType=VARCHAR}, #{bz,jdbcType=VARCHAR}, #{zddwid,jdbcType=VARCHAR}, 
      #{zdrid,jdbcType=VARCHAR}, #{zdsj,jdbcType=TIMESTAMP}, #{zt,jdbcType=DECIMAL}, 
      #{dprtcode,jdbcType=VARCHAR}, #{zdjsrid,jdbcType=VARCHAR}, #{zdjsrq,jdbcType=TIMESTAMP}, 
      #{zdjsyy,jdbcType=VARCHAR}, #{shbmid,jdbcType=VARCHAR}, #{shyj,jdbcType=VARCHAR}, 
      #{shrid,jdbcType=VARCHAR}, #{shsj,jdbcType=TIMESTAMP}, #{pfbmid,jdbcType=VARCHAR}, 
      #{pfyj,jdbcType=VARCHAR}, #{pfrid,jdbcType=VARCHAR}, #{pfsj,jdbcType=TIMESTAMP}, 
      #{jkbz,jdbcType=VARCHAR}, #{zhut,jdbcType=VARCHAR})
  </insert>
 
 
  
  
  
  
  
  
  
  
  <!-- start sunji -->
	
<select id="queryRelatedJobCardAll" parameterType="com.eray.thjw.po.WorkOrder" resultMap="BaseResultMap">
           
	select A.id, A.gdjcid, A.gdbh, A.zy, A.gdlx, A.gdzlx, A.zhut, A.DPRTCODE
		  from (select b7.id,
		               b7.gdjcid,
		               b7.gdbh,
		               b7.zy,
		               2         gdlx,
		               b7.gdlx   as gdzlx,
		               b7.zhut,
		               b7.DPRTCODE
		          from b_g_007 b7
			         where b7.zt in (3, 9, 10)
			        union all
			        select b16.id,
			               b16.gdjcid,
			               b16.gdbh,
			               b16.zy,
			               1          as gdlx,
			               0          gdzlx,
			               b16.zhut,
			               b16.DPRTCODE
			          from b_g_016 b16
			         where b16.zt in (3, 9, 10)
			        union all
			        select b10.id,
			               b10.gdjcid,
			               b10.gdbh,
			               b10.zy,
			               3          as gdlx,
			               0          gdzlx,
			               b10.zhut,
			               b10.DPRTCODE
			          from b_g_010 b10
			         where b10.zt in (3, 9, 10)) A
					  join b_g_00604 B
					    on A.gdjcid = B.mainid
					   and b.zt = 1
					  join d_007 C
					    on B.fjzch = C.fjzch AND B.dprtcode = C.dprtcode
					 WHERE C.FJJX = #{jx} 
					 <if test="dprtcode != null and dprtcode != ''">
							    and A.dprtcode = #{dprtcode}            
					</if> 
					 <if test="keyword != null and keyword != ''">
							    and (UPPER(A.gdbh) like UPPER('%'||#{keyword}||'%'))              <!-- 左右匹配 查询关键字 -->
					</if>
					 <if test="ids!=null and ids!='' ">  
				       			 and A.id not in  
				       			 <foreach item="item" index="index" collection="ids" open="("  
				           		 separator="," close=")">  
				            		#{item}  
				       			 </foreach>  
				    </if>
					  union all
					        select b13.id,
					               b13.gdjcid,
					               b13.gdbh,
					               b13.zy,
					               5          as gdlx,
					               0          gdzlx,
					               b13.GZZT ZHUT,
					               b13.DPRTCODE
					          from b_g_013 b13
					         where b13.zt in (3, 9, 10) and b13.yxx=1 and b13.jx=#{jx}
							   <if test="dprtcode != null and dprtcode != ''">
							    and b13.dprtcode = #{dprtcode}           
								</if> 
					         <if test="keyword != null and keyword != ''">
							    and (UPPER(b13.gdbh) like UPPER('%'||#{keyword}||'%') )              <!-- 左右匹配 查询关键字 -->
							  </if>
					         <if test="ids!=null and ids!=''">  
				       			 and b13.id not in  
				       			 <foreach item="item" index="index" collection="ids" open="("  
				           		 separator="," close=")">  
				            		#{item}  
				       			 </foreach>  
				    		</if>  

</select>
<select id="selectRealtedJobCardByjx" parameterType="com.eray.thjw.po.WorkOrder" resultMap="BaseResultMap">         
	select A.id, A.gdjcid, A.gdbh, A.zy, A.gdlx, A.gdzlx, A.zhut
		  from (select b7.id,
		               b7.gdjcid,
		               b7.gdbh,
		               b7.zy,
		               2         gdlx,
		               b7.gdlx   as gdzlx,
		               b7.zhut
		          from b_g_007 b7
			         where b7.zt in (3, 9, 10)
			        union all
			        select b16.id,
			               b16.gdjcid,
			               b16.gdbh,
			               b16.zy,
			               1          as gdlx,
			               0          gdzlx,
			               b16.zhut
			          from b_g_016 b16
			         where b16.zt in (3, 9, 10)
			        union all
			        select b10.id,
			               b10.gdjcid,
			               b10.gdbh,
			               b10.zy,
			               3          as gdlx,
			               0          gdzlx,
			               b10.zhut
			          from b_g_010 b10
			         where b10.zt in (3, 9, 10)) A
					  join b_g_00604 B
					    on A.gdjcid = B.mainid
					   and b.zt = 1
					  join d_007 C
					    on B.fjzch = C.fjzch AND B.dprtcode = C.dprtcode
					 WHERE C.FJJX = #{jx} 
					  union all
					        select b13.id,
					               b13.gdjcid,
					               b13.gdbh,
					               b13.zy,
					               4          as gdlx,
					               0          gdzlx,
					               b13.GZZT ZHUT
					          from b_g_013 b13
					         where b13.zt in (3, 9, 10) and b13.jx=#{jx}
</select>

  <!--查询所有-->
	<select id="queryAll" resultMap="BaseResultMap" parameterType="Map">
           select 
          		 		B_G_007.id,
          		 		B_G_007.gdbh,
          		 		B_G_007.zdrid,
          		 		B_G_007.zt,
          		 		B_G_007.dprtcode
					from B_G_007 left join b_g_003 on B_G_007.id=b_g_003.zlid 
					where B_G_007.dprtcode=#{dprtcode,jdbcType=VARCHAR} and B_G_007.zt!=8
					and b_g_003.pgdid in 
				 <foreach collection="ids" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				 </foreach>
  </select>
  		  	<!-- 根据定检项目id集合定检项目信息 -->
	<select id="queryByIdListEo" resultMap="BaseResultMap" >
		select 
		<include refid="Base_Column_List_EO"></include>
    	from B_G_010
    	where ID in
		<foreach collection="list" item="idList" index="index" open="(" close=")" separator=",">
			#{idList}
		 </foreach>
 	</select>
	<select id="queryByIdListNon" resultMap="BaseResultMap" >
		select 
		<include refid="Base_Column_List_NON"></include>
    	from B_G_007
    	where ID in
		<foreach collection="list" item="idList" index="index" open="(" close=")" separator=",">
			#{idList}
		 </foreach>
 	</select>
</mapper>